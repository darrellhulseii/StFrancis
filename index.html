<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Franciscan Saints ‚Äî A Journey of Faith</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cinzel+Decorative:wght@400;700&family=EB+Garamond:ital,wght@0,400;0,600;1,400&display=swap');
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;background:#000;position:fixed;top:0;left:0;-webkit-tap-highlight-color:transparent;touch-action:none;}
#gameCanvas{position:fixed;top:0;left:0;width:100%!important;height:100%!important;display:block;image-rendering:auto;touch-action:none;filter:contrast(1.06) saturate(1.22) brightness(1.02);}

/* ‚îÄ‚îÄ KEYFRAMES ‚îÄ‚îÄ */
@keyframes glowPulse{0%,100%{text-shadow:0 0 20px #ffd700,0 0 40px #ff8c00;}50%{text-shadow:0 0 80px #ffd700,0 0 140px #ff8c00,0 0 200px rgba(255,215,0,.4);}}
@keyframes crossSpin{0%{transform:rotate(0deg) scale(1);}50%{transform:rotate(180deg) scale(1.12);}100%{transform:rotate(360deg) scale(1);}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-28px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.15;}}
@keyframes btnGlow{0%,100%{box-shadow:0 0 18px rgba(255,215,0,.3);}50%{box-shadow:0 0 60px rgba(255,215,0,1),0 0 100px rgba(255,140,0,.4);}}
@keyframes floatUp{from{transform:translateY(0) scale(1);opacity:.85;}to{transform:translateY(-120vh) scale(.2);opacity:0;}}
@keyframes miracleAnim{0%{opacity:0;transform:scale(.2);}40%{opacity:1;transform:scale(1.08);}100%{opacity:0;transform:scale(2);}}
@keyframes goldenRingAnim{0%{opacity:1;transform:translate(-50%,-50%) scale(0);}100%{opacity:0;transform:translate(-50%,-50%) scale(12);}}
@keyframes heavenFadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes starTwinkle{0%,100%{opacity:.3;}50%{opacity:1;}}
@keyframes slideInLeft{from{opacity:0;transform:translateX(-30px);}to{opacity:1;transform:translateX(0);}}
@keyframes dlgIn{from{opacity:0;transform:translateX(-50%) translateY(18px);}to{opacity:1;transform:translateX(-50%) translateY(0);}}
@keyframes promptPulse{0%,100%{border-color:rgba(255,215,0,.6);box-shadow:0 0 10px rgba(255,215,0,.2);}50%{border-color:#ffd700;box-shadow:0 0 25px rgba(255,215,0,.7);}}
@keyframes tutFadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes cardHover{0%{transform:translateY(0);}100%{transform:translateY(-6px);}}
@keyframes shineSwipe{0%{left:-100%;}100%{left:200%;}}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
#loading{position:fixed;inset:0;z-index:999;background:radial-gradient(ellipse at 50% 60%,#0a0520 0%,#000 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;font-family:'Cinzel',serif;color:#ffd700;}
.lc{font-size:clamp(44px,12vw,88px);animation:glowPulse 1.5s ease-in-out infinite;}
.lt{font-size:clamp(10px,2.5vw,17px);letter-spacing:6px;text-transform:uppercase;color:#c8a84a;animation:fadeUp 1s ease-out .4s both;}
#loadingBar{width:min(300px,72vw);height:6px;background:rgba(255,215,0,.1);border:1.5px solid rgba(255,215,0,.3);border-radius:4px;overflow:hidden;margin-top:4px;}
#loadingFill{height:100%;background:linear-gradient(to right,#6a4800,#ffd700,#ffaa00);width:0%;transition:width .25s ease-out;box-shadow:0 0 12px #ffd700;}

/* ‚îÄ‚îÄ TITLE ‚îÄ‚îÄ */
#titleScreen{position:fixed;inset:0;z-index:100;background:radial-gradient(ellipse at 50% 45%,#180830 0%,#07000f 60%,#000 100%);display:none;flex-direction:column;align-items:center;justify-content:center;font-family:'Cinzel',serif;pointer-events:all;overflow:hidden;padding:clamp(12px,3vw,28px);}
.t-stars{position:absolute;inset:0;pointer-events:none;}
.t-star{position:absolute;border-radius:50%;background:#fff;animation:starTwinkle var(--d,3s) ease-in-out var(--delay,0s) infinite;}
.t-cross{font-size:clamp(52px,14vw,110px);color:#ffd700;animation:glowPulse 2.2s ease-in-out infinite;line-height:1.1;margin-bottom:4px;}
.t-main{font-family:'Cinzel Decorative',serif;font-size:clamp(16px,4.5vw,48px);color:#ffd700;text-align:center;letter-spacing:2px;line-height:1.3;text-shadow:3px 3px 0 #4a2c00,6px 6px 14px rgba(0,0,0,.9);animation:fadeDown 1.3s ease-out both;}
.t-sub{font-size:clamp(8px,2vw,16px);color:#c8a84a;letter-spacing:5px;margin-top:8px;animation:fadeDown 1.3s ease-out .25s both;}
.t-divider{width:min(260px,60vw);height:1px;background:linear-gradient(to right,transparent,#ffd700,transparent);margin:14px 0;animation:fadeDown 1.3s ease-out .4s both;}
.t-bio{max-width:min(620px,86vw);padding:14px 20px;background:linear-gradient(135deg,rgba(255,215,0,.06),rgba(0,0,0,.7));border:1px solid rgba(255,215,0,.25);border-radius:6px;color:#e8d5a0;font-family:'EB Garamond',serif;font-style:italic;font-size:clamp(9px,1.8vw,14px);line-height:1.85;text-align:center;animation:fadeDown 1.3s ease-out .55s both;}
.t-bio-attr{color:#ffd700;font-style:normal;font-size:.82em;margin-top:6px;display:block;letter-spacing:1px;}
.t-controls-hint{font-size:clamp(7px,1.4vw,10px);color:rgba(200,168,74,.6);letter-spacing:3px;margin-top:10px;animation:fadeDown 1.3s ease-out .7s both;}
.start-btn{margin-top:18px;padding:clamp(10px,1.8vh,16px) clamp(28px,5vw,58px);background:linear-gradient(135deg,#3a2000,#8B6914,#ffd700,#8B6914,#3a2000);background-size:200% auto;border:2px solid #ffd700;color:#0a0008;font-family:'Cinzel Decorative',serif;font-size:clamp(10px,2vw,16px);font-weight:700;letter-spacing:5px;text-transform:uppercase;cursor:pointer;border-radius:4px;animation:fadeDown 1.3s ease-out .85s both,btnGlow 2.5s ease-in-out 2s infinite;transition:transform .12s,background-position .4s;position:relative;overflow:hidden;}
.start-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(to right,transparent,rgba(255,255,255,.3),transparent);animation:shineSwipe 3s ease-in-out 3s infinite;}
.start-btn:hover{transform:scale(1.04);background-position:right center;}.start-btn:active{transform:scale(.93);}

/* ‚îÄ‚îÄ CONTROLS TUTORIAL ‚îÄ‚îÄ */
#tutorialOverlay{position:fixed;inset:0;z-index:95;background:rgba(0,0,0,.92);display:none;flex-direction:column;align-items:center;justify-content:center;font-family:'Cinzel',serif;animation:tutFadeIn .4s ease-out;}
.tut-title{font-family:'Cinzel Decorative',serif;font-size:clamp(14px,3.5vw,30px);color:#ffd700;letter-spacing:4px;text-align:center;margin-bottom:clamp(16px,4vh,32px);text-shadow:0 0 20px #ffd700;}
.tut-grid{display:grid;grid-template-columns:1fr 1fr;gap:clamp(10px,2.5vw,22px);max-width:min(700px,88vw);}
.tut-row{background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.2);border-radius:8px;padding:clamp(10px,2vw,18px);display:flex;align-items:center;gap:12px;}
.tut-key{font-size:clamp(18px,4vw,32px);min-width:48px;text-align:center;color:#ffd700;}
.tut-desc{color:#e8d5a0;font-family:'EB Garamond',serif;font-size:clamp(9px,1.7vw,14px);line-height:1.5;}
.tut-desc strong{color:#ffd700;font-family:'Cinzel',serif;font-size:.88em;}
.tut-close{margin-top:clamp(18px,4vh,32px);padding:10px 36px;background:transparent;border:2px solid #ffd700;color:#ffd700;font-family:'Cinzel',serif;font-size:clamp(9px,1.8vw,13px);letter-spacing:4px;cursor:pointer;border-radius:4px;transition:background .2s,color .2s;}
.tut-close:hover{background:#ffd700;color:#000;}

/* ‚îÄ‚îÄ MODE SELECT ‚îÄ‚îÄ */
#modeSelect{position:fixed;inset:0;z-index:98;background:radial-gradient(ellipse at 50% 40%,#0e0820 0%,#000 100%);display:none;flex-direction:column;align-items:center;justify-content:center;font-family:'Cinzel',serif;pointer-events:all;padding:clamp(10px,2.5vw,22px);overflow-y:auto;}
.ms-title{font-family:'Cinzel Decorative',serif;font-size:clamp(15px,3.8vw,36px);color:#ffd700;letter-spacing:3px;text-align:center;text-shadow:0 0 30px rgba(255,215,0,.5);margin-bottom:4px;}
.ms-sub{color:#8a7040;font-size:clamp(8px,1.7vw,12px);letter-spacing:4px;text-align:center;margin-bottom:clamp(16px,3.5vh,28px);}
.ms-divider{width:min(180px,50vw);height:1px;background:linear-gradient(to right,transparent,rgba(255,215,0,.4),transparent);margin:8px auto 20px;}
.ms-cards{display:flex;flex-wrap:wrap;gap:clamp(8px,2vw,16px);justify-content:center;max-width:980px;}
.ms-card{width:clamp(155px,27vw,230px);background:linear-gradient(160deg,rgba(255,215,0,.05),rgba(0,0,0,.8));border:1.5px solid rgba(139,105,20,.6);border-radius:10px;padding:clamp(14px,2.8vw,24px);cursor:pointer;transition:border-color .25s,transform .18s,box-shadow .25s;text-align:center;pointer-events:all;position:relative;overflow:hidden;}
.ms-card::before{content:'';position:absolute;inset:0;background:linear-gradient(160deg,rgba(255,215,0,.08),transparent 60%);opacity:0;transition:opacity .25s;}
.ms-card:hover{border-color:#ffd700;transform:translateY(-6px);box-shadow:0 12px 40px rgba(255,215,0,.25);}
.ms-card:hover::before{opacity:1;}
.ms-card:active{transform:scale(.94);}
.ms-card-marathon{border-color:rgba(255,140,0,.5);}
.ms-card-marathon:hover{border-color:#ff8c00;box-shadow:0 12px 40px rgba(255,140,0,.3);}
.ms-icon{font-size:clamp(30px,7.5vw,58px);margin-bottom:10px;line-height:1;display:block;}
.ms-name{font-family:'Cinzel Decorative',serif;color:#ffd700;font-size:clamp(9px,2vw,15px);letter-spacing:1px;line-height:1.4;margin-bottom:8px;}
.ms-desc{color:#a89060;font-size:clamp(7px,1.4vw,11px);line-height:1.65;font-family:'EB Garamond',serif;font-style:italic;}
.ms-stages{color:rgba(200,168,74,.6);font-size:clamp(6px,1.1vw,9px);letter-spacing:2px;text-transform:uppercase;margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,215,0,.1);}
.ms-back{margin-top:clamp(14px,3vh,24px);color:#6a5030;font-size:clamp(8px,1.5vw,12px);letter-spacing:3px;cursor:pointer;text-transform:uppercase;padding-bottom:2px;transition:color .2s;}
.ms-back:hover{color:#ffd700;}
.tut-link{color:rgba(200,168,74,.5);font-size:clamp(7px,1.3vw,10px);letter-spacing:3px;cursor:pointer;margin-top:12px;text-transform:uppercase;transition:color .2s;}
.tut-link:hover{color:#ffd700;}

/* ‚îÄ‚îÄ SAINT SELECT ‚îÄ‚îÄ */
#saintSelect{position:fixed;inset:0;z-index:98;background:radial-gradient(ellipse at 50% 40%,#0e0820 0%,#000 100%);display:none;flex-direction:column;align-items:center;justify-content:center;font-family:'Cinzel',serif;pointer-events:all;padding:clamp(10px,2.5vw,22px);overflow-y:auto;}
.ss-subtitle{color:#8a7040;font-size:clamp(7px,1.5vw,11px);letter-spacing:3px;text-align:center;margin-bottom:clamp(6px,1.5vh,12px);max-width:min(560px,86vw);font-family:'EB Garamond',serif;font-style:italic;line-height:1.6;}
.ms-card-dates{color:rgba(200,168,74,.55);font-size:clamp(6px,1.1vw,9px);letter-spacing:1px;margin-top:4px;font-family:'Cinzel',serif;}

/* ‚îÄ‚îÄ CUTSCENE ‚îÄ‚îÄ */
#cutscene{position:fixed;inset:0;z-index:90;background:radial-gradient(ellipse at center,#0a0015 0%,#000 100%);display:none;flex-direction:column;align-items:center;justify-content:center;pointer-events:all;padding:clamp(12px,3vw,28px);gap:12px;}
.cut-art{font-size:clamp(58px,16vw,140px);text-align:center;line-height:1;filter:drop-shadow(0 0 20px rgba(255,215,0,.6));}
.cut-title{font-family:'Cinzel Decorative',serif;font-size:clamp(12px,3.2vw,30px);color:#ffd700;letter-spacing:3px;text-transform:uppercase;text-align:center;text-shadow:0 0 30px rgba(255,215,0,.7);max-width:min(700px,90vw);}
.cut-divider{width:min(200px,55vw);height:1px;background:linear-gradient(to right,transparent,rgba(255,215,0,.5),transparent);}
.cut-text{max-width:min(680px,88vw);font-family:'EB Garamond',serif;font-size:clamp(9px,2vw,15px);color:#e8d5a0;line-height:2;font-style:italic;text-align:center;padding:16px 22px;background:rgba(0,0,0,.55);border:1px solid rgba(255,215,0,.2);border-radius:6px;white-space:pre-line;}
.cut-continue{color:rgba(255,215,0,.7);font-family:'Cinzel',serif;font-size:clamp(8px,1.6vw,11px);letter-spacing:3px;animation:blink 1.2s ease-in-out infinite;padding:8px 28px;border:1px solid rgba(255,215,0,.25);border-radius:30px;background:rgba(255,215,0,.04);cursor:pointer;text-align:center;}

/* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
#stageBanner{position:fixed;top:0;left:0;right:0;z-index:20;text-align:center;padding:10px 20px;background:linear-gradient(to bottom,rgba(0,0,0,.95) 0%,rgba(0,0,0,.6) 70%,transparent 100%);color:#ffd700;font-family:'Cinzel Decorative',serif;font-size:clamp(8px,2vw,15px);letter-spacing:3px;text-shadow:2px 2px 6px #000,0 0 20px rgba(255,215,0,.3);pointer-events:none;display:none;text-transform:uppercase;}
#objectiveBar{position:fixed;top:48px;left:10px;z-index:20;background:rgba(0,0,0,.88);border:1.5px solid rgba(139,105,20,.6);border-radius:6px;padding:8px 13px;font-family:'Cinzel',serif;pointer-events:none;display:none;max-width:min(240px,40vw);backdrop-filter:blur(4px);}
#objectiveBar .obj-title{color:#8a6a20;font-size:clamp(5px,1.1vw,8px);letter-spacing:3px;text-transform:uppercase;margin-bottom:3px;}
#objectiveBar .obj-text{color:#e8d5a0;font-size:clamp(7px,1.4vw,11px);line-height:1.6;font-family:'EB Garamond',serif;}
#stageProgress{position:fixed;top:48px;right:10px;z-index:20;background:rgba(0,0,0,.88);border:1.5px solid rgba(139,105,20,.6);border-radius:6px;padding:8px 13px;text-align:right;color:#ffd700;font-family:'Cinzel',serif;font-size:clamp(7px,1.4vw,11px);pointer-events:none;display:none;backdrop-filter:blur(4px);}
/* ‚îÄ‚îÄ MINIMAP ‚îÄ‚îÄ */
#minimap{position:fixed;bottom:clamp(80px,14vh,110px);right:clamp(12px,2.5vw,18px);z-index:22;width:clamp(68px,13vw,88px);height:clamp(68px,13vw,88px);border-radius:50%;border:1.5px solid rgba(255,215,0,.35);background:rgba(0,0,0,.7);display:none;overflow:hidden;pointer-events:none;backdrop-filter:blur(2px);}
#minimapCanvas{width:100%;height:100%;}

/* ‚îÄ‚îÄ DIALOGUE ‚îÄ‚îÄ */
#dialogueBox{position:fixed;bottom:clamp(80px,14vh,120px);left:50%;transform:translateX(-50%);width:min(820px,93vw);z-index:30;background:linear-gradient(160deg,rgba(4,2,14,.98),rgba(8,3,22,.98));border:2px solid rgba(139,105,20,.7);border-radius:8px;padding:14px 18px 12px;font-family:'Cinzel',serif;pointer-events:all;display:none;box-shadow:0 0 40px rgba(0,0,0,.8),0 0 20px rgba(139,105,20,.2),inset 0 1px 0 rgba(255,215,0,.08);animation:dlgIn .3s ease-out;}
.dlg-speaker-wrap{display:flex;align-items:center;gap:10px;margin-bottom:7px;}
.dlg-speaker-dot{width:8px;height:8px;border-radius:50%;background:#ffd700;box-shadow:0 0 8px #ffd700;flex-shrink:0;}
#dialogueBox .dlg-speaker{color:#ffd700;font-size:clamp(8px,1.6vw,13px);font-weight:700;letter-spacing:3px;text-transform:uppercase;}
#dialogueBox .dlg-text{color:#f0e5c8;font-size:clamp(9px,1.7vw,14px);line-height:1.8;font-family:'EB Garamond',serif;font-style:italic;}
#dialogueBox .dlg-attr{color:#7a6030;font-size:clamp(6px,1.1vw,10px);margin-top:7px;font-style:normal;text-align:right;border-top:1px solid rgba(139,105,20,.3);padding-top:5px;font-family:'Cinzel',serif;letter-spacing:1px;}
#dialogueBox .dlg-hint{color:rgba(90,70,30,.8);font-size:clamp(6px,1.1vw,9px);margin-top:5px;text-align:center;animation:blink 1.2s ease-in-out infinite;letter-spacing:2px;}

/* ‚îÄ‚îÄ INTERACT PROMPT ‚îÄ‚îÄ */
#interactPrompt{position:fixed;top:50%;left:50%;transform:translate(-50%,-200%);background:rgba(0,0,0,.9);border:2px solid rgba(255,215,0,.85);border-radius:32px;padding:9px 22px;color:#ffd700;font-family:'Cinzel',serif;font-size:clamp(8px,1.8vw,13px);display:none;z-index:25;pointer-events:none;text-align:center;animation:promptPulse 1.8s ease-in-out infinite;letter-spacing:2px;backdrop-filter:blur(4px);}

/* ‚îÄ‚îÄ FLIGHT HUD ‚îÄ‚îÄ */
#flightHUD{position:fixed;top:12px;left:50%;transform:translateX(-50%);z-index:22;background:rgba(0,0,0,.85);border:1.5px solid rgba(255,215,0,.4);border-radius:8px;padding:10px 20px;text-align:center;display:none;pointer-events:none;font-family:'Cinzel',serif;backdrop-filter:blur(4px);}
.fhud-label{color:#c8a840;font-size:clamp(7px,1.5vw,11px);letter-spacing:4px;text-transform:uppercase;margin-bottom:8px;}
.fhud-beads{display:flex;gap:clamp(6px,1.5vw,10px);justify-content:center;margin-bottom:6px;}
.fhud-bead{width:clamp(16px,3.8vw,24px);height:clamp(16px,3.8vw,24px);border-radius:50%;background:rgba(80,60,0,.2);border:2px solid rgba(255,215,0,.3);transition:all .5s cubic-bezier(.175,.885,.32,1.275);position:relative;}
.fhud-bead.lit{background:radial-gradient(circle at 35% 35%,#ffe066,#ffd700,#c8860a);border-color:#ffd700;box-shadow:0 0 14px #ffd700,0 0 28px rgba(255,215,0,.4);}
.fhud-speed{color:rgba(200,168,74,.55);font-size:clamp(6px,1.2vw,9px);letter-spacing:2px;}

/* ‚îÄ‚îÄ JOYSTICK ‚îÄ‚îÄ */
#joystickWrap{position:fixed;bottom:clamp(14px,2.8vh,26px);left:clamp(14px,2.8vw,26px);width:clamp(100px,22vw,128px);height:clamp(100px,22vw,128px);display:none;z-index:40;pointer-events:all;user-select:none;-webkit-user-select:none;touch-action:none;}
#joystickBase{width:100%;height:100%;border-radius:50%;background:rgba(0,0,0,.5);border:2px solid rgba(255,215,0,.35);position:relative;backdrop-filter:blur(4px);}
#joystickKnob{position:absolute;width:36%;height:36%;border-radius:50%;background:radial-gradient(circle at 33% 33%,rgba(255,220,80,.95),rgba(160,100,0,.85));border:2px solid rgba(255,215,0,.85);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;display:flex;align-items:center;justify-content:center;color:rgba(80,40,0,.7);font-size:clamp(10px,2.5vw,16px);font-weight:bold;box-shadow:0 2px 8px rgba(0,0,0,.5);}

/* ‚îÄ‚îÄ ACTION BUTTONS ‚îÄ‚îÄ */
#actionBtns{position:fixed;bottom:clamp(14px,2.8vh,26px);right:clamp(14px,2.8vw,26px);display:none;z-index:40;flex-direction:column;align-items:flex-end;gap:10px;pointer-events:all;}
.act-btn{width:clamp(52px,11vw,70px);height:clamp(52px,11vw,70px);border-radius:50%;background:radial-gradient(circle at 40% 35%,rgba(255,215,0,.2),rgba(0,0,0,.85));border:2px solid rgba(255,215,0,.55);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform .1s,box-shadow .15s;touch-action:none;pointer-events:all;font-family:'Cinzel',serif;box-shadow:0 4px 16px rgba(0,0,0,.6);}
.act-btn span{color:#ffd700;font-size:clamp(14px,3vw,20px);line-height:1;}
.act-btn .lbl{font-size:clamp(6px,1.2vw,8px);letter-spacing:2px;color:rgba(255,215,0,.7);}
.act-btn:active,.act-btn.pressed{transform:scale(.88);box-shadow:0 0 18px rgba(255,215,0,.6);}
#btnNext{font-size:clamp(18px,4vw,26px);}

/* ‚îÄ‚îÄ CROSSHAIR ‚îÄ‚îÄ */
#crosshair{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:clamp(36px,8vw,52px);height:clamp(36px,8vw,52px);display:none;z-index:22;pointer-events:none;}
.ch-h,.ch-v{position:absolute;background:rgba(255,215,0,.55);border-radius:2px;}
.ch-h{width:100%;height:1.5px;top:50%;left:0;transform:translateY(-50%);}
.ch-v{height:100%;width:1.5px;left:50%;top:0;transform:translateX(-50%);}
.ch-ring{position:absolute;inset:8px;border-radius:50%;border:1.5px solid rgba(255,215,0,.4);transition:all .3s;}
#crosshair.locked .ch-ring{border-color:#ffd700;box-shadow:0 0 12px #ffd700;transform:scale(.8);}

/* ‚îÄ‚îÄ EFFECTS ‚îÄ‚îÄ */
#goldenRing{position:fixed;top:50%;left:50%;width:clamp(90px,20vw,130px);height:clamp(90px,20vw,130px);border-radius:50%;border:4px solid #ffd700;box-shadow:0 0 40px #ffd700,0 0 80px #ff8c00,inset 0 0 40px rgba(255,215,0,.25);pointer-events:none;z-index:55;display:none;}
#goldenRing.fire{display:block;animation:goldenRingAnim 2s ease-out forwards;}
#heavenOverlay{position:fixed;inset:0;z-index:60;background:radial-gradient(ellipse at center,rgba(255,255,255,.98) 0%,rgba(255,240,150,.8) 40%,transparent 75%);pointer-events:none;display:none;}
#heavenOverlay.fade{display:block;animation:miracleAnim 1.6s ease-out forwards;}
#heavenMsg{position:fixed;top:30%;left:50%;transform:translateX(-50%);color:#ffd700;font-family:'Cinzel Decorative',serif;font-size:clamp(14px,3.5vw,32px);text-shadow:0 0 30px #ffd700,0 0 60px #ff8c00;pointer-events:none;z-index:65;display:none;text-align:center;letter-spacing:4px;}
#miracleFlash{position:fixed;inset:0;pointer-events:none;z-index:58;background:rgba(255,215,0,.0);transition:background .1s;}
#miracleFlash.on{background:rgba(255,215,0,.18);}
#miracleFlash.white.on{background:rgba(255,255,255,.35);}
#particleOverlay{position:fixed;inset:0;pointer-events:none;z-index:5;overflow:hidden;}
.cssPart{position:absolute;border-radius:50%;animation:floatUp linear both;}

/* ‚îÄ‚îÄ MARATHON HUD ‚îÄ‚îÄ */
#marathonHUD{position:fixed;top:0;left:50%;transform:translateX(-50%);z-index:21;display:none;padding-top:52px;pointer-events:none;}
#marathonHUDInner{background:rgba(0,0,0,.88);border:1px solid rgba(255,215,0,.3);border-top:none;border-radius:0 0 10px 10px;padding:7px 18px;display:flex;align-items:center;gap:10px;backdrop-filter:blur(4px);}
#marathonHUDIcon{font-size:clamp(14px,3vw,20px);}
#marathonHUDText{color:#ffd700;font-family:'Cinzel',serif;font-size:clamp(8px,1.6vw,12px);letter-spacing:2px;}
#marathonHUDDots{display:flex;gap:6px;margin-left:4px;}
.mhud-dot{transition:all .3s ease;width:clamp(7px,1.4vw,9px);height:clamp(7px,1.4vw,9px);border-radius:50%;background:rgba(255,215,0,.2);border:1.5px solid rgba(255,215,0,.35);transition:all .4s;}
.mhud-dot.active{background:#ffd700;box-shadow:0 0 8px #ffd700;}
.mhud-dot.done{background:rgba(255,215,0,.5);}

/* ‚îÄ‚îÄ FINAL SCREENS ‚îÄ‚îÄ */
.finalScreen{position:fixed;inset:0;z-index:100;display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;font-family:'Cinzel',serif;pointer-events:all;padding:clamp(14px,3vw,32px);gap:clamp(10px,2.5vh,22px);}
.fin-title{font-family:'Cinzel Decorative',serif;font-size:clamp(16px,4vw,42px);letter-spacing:3px;line-height:1.4;text-shadow:0 0 30px currentColor,0 2px 4px rgba(0,0,0,.6);animation:fadeDown .8s ease-out both;}
.fin-quote{max-width:min(720px,88vw);font-family:'EB Garamond',serif;font-size:clamp(11px,1.95vw,17px);line-height:1.95;font-style:italic;padding:20px 26px;background:rgba(0,0,0,.35);border-radius:10px;border:1px solid rgba(255,255,255,.15);}
.fin-attr{display:block;font-style:normal;font-size:.82em;margin-top:10px;letter-spacing:1px;opacity:.75;font-family:'Cinzel',serif;}
.fin-bio{max-width:min(660px,86vw);font-family:'EB Garamond',serif;font-size:clamp(9px,1.7vw,13px);line-height:1.85;padding:12px 18px;background:rgba(0,0,0,.2);border-radius:6px;border:1px solid rgba(255,255,255,.1);}
.fin-btn{padding:clamp(9px,1.6vh,14px) clamp(28px,5vw,50px);border:2px solid;border-radius:4px;font-family:'Cinzel',serif;font-size:clamp(9px,1.8vw,13px);font-weight:700;letter-spacing:4px;text-transform:uppercase;cursor:pointer;transition:transform .12s,box-shadow .2s;}
.fin-btn:hover{transform:scale(1.04);box-shadow:0 0 24px currentColor;}
.fin-btn:active{transform:scale(.93);}
.marathon-badge{display:inline-flex;align-items:center;gap:8px;margin:4px;padding:6px 14px;background:rgba(255,215,0,.08);border:1px solid rgba(255,215,0,.25);border-radius:20px;color:#ffd700;font-size:clamp(8px,1.6vw,12px);letter-spacing:1px;}
.marathon-saints-list{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-bottom:16px;}
</style>
</head>
<body>
<!-- LOADING -->
<div id="loading">
  <div class="lc">‚úù</div>
  <div class="lt">Franciscan Saints &nbsp;&bull;&nbsp; A Journey of Faith</div>
  <div id="loadingBar"><div id="loadingFill"></div></div>
</div>

<!-- TITLE -->
<div id="titleScreen">
  <div class="t-stars" id="tStars"></div>
  <div class="t-cross">‚úù</div>
  <div class="t-main">Franciscan Saints<br><span style="font-size:.6em;letter-spacing:8px;font-family:'Cinzel',serif;">A Journey of Faith</span></div>
  <div class="t-sub">In the spirit of St. Francis of Assisi &middot; 1181&ndash;1226</div>
  <div class="t-divider"></div>
  <div class="t-bio">&ldquo;He who works with his hands is a labourer. He who works with his hands and his head is a craftsman. He who works with his hands, his head, and his heart is an artist.&rdquo;<span class="t-bio-attr">&mdash; St. Francis of Assisi &bull; Poverello of Assisi &bull; Doctor of the Universal Church</span></div>
  <button class="start-btn" id="startBtn">Enter the Journey &nbsp;‚úù</button>
  <div class="t-controls-hint">WASD / Arrow Keys / Touch Joystick to move &bull; E or PRAY button to interact</div>
</div>

<!-- CONTROLS TUTORIAL -->
<div id="tutorialOverlay">
  <div class="tut-title">‚úù How to Play</div>
  <div class="tut-grid">
    <div class="tut-row"><div class="tut-key">WASD</div><div class="tut-desc"><strong>Move</strong><br>Walk through each sacred environment</div></div>
    <div class="tut-row"><div class="tut-key">E / F</div><div class="tut-desc"><strong>Pray / Interact</strong><br>Activate miracles and start dialogue</div></div>
    <div class="tut-row"><div class="tut-key">Space</div><div class="tut-desc"><strong>Continue Dialogue</strong><br>Advance through speech and cutscenes</div></div>
    <div class="tut-row"><div class="tut-key">Esc</div><div class="tut-desc"><strong>Skip Cutscene</strong><br>Skip the intro narration</div></div>
    <div class="tut-row"><div class="tut-key">‚úù</div><div class="tut-desc"><strong>PRAY Button</strong><br>Touch / tap to interact on mobile</div></div>
    <div class="tut-row"><div class="tut-key">üïπ</div><div class="tut-desc"><strong>Joystick</strong><br>Bottom-left on mobile for movement</div></div>
  </div>
  <button class="tut-close" id="tutClose">Begin &nbsp;‚úù</button>
</div>

<!-- MODE SELECT -->
<div id="modeSelect">
  <div class="ms-title">Choose Your Journey</div>
  <div class="ms-sub">Six saints. Thirty miracles. One eternal story.</div>
  <div class="ms-divider"></div>
  <div class="ms-cards">
    <div class="ms-card" id="cardFrancis">
      <span class="ms-icon">‚õ™</span>
      <div class="ms-name">The Life of<br>St. Francis</div>
      <div class="ms-desc">Walk from the streets of Assisi to the heights of La Verna. Repair San Damiano, preach to the birds, tame the Wolf of Gubbio, receive the Stigmata, and sing the Canticle of the Sun.</div>
      <div class="ms-stages">6 Stages &bull; Francis of Assisi &bull; 1181&ndash;1226</div>
    </div>
    <div class="ms-card" id="cardSaints">
      <span class="ms-icon">üìø</span>
      <div class="ms-name">Franciscan<br>Saints</div>
      <div class="ms-desc">Choose one of five Franciscan saints and relive their greatest miracles ‚Äî each documented by historians, witnesses, and the Vatican itself.</div>
      <div class="ms-stages">24 Stages &bull; 5 Saints &bull; Choose Your Path</div>
    </div>
    <div class="ms-card ms-card-marathon" id="cardMarathon">
      <span class="ms-icon">‚úù</span>
      <div class="ms-name">All Franciscans<br><span style="font-size:.82em;letter-spacing:1px;font-family:'Cinzel',serif;">Marathon Mode</span></div>
      <div class="ms-desc">Walk with all six Franciscan saints in one continuous journey of prayer ‚Äî from Assisi in 1209 to San Giovanni Rotondo in 1968.</div>
      <div class="ms-stages">30 Stages &bull; All Saints &bull; Full Journey</div>
    </div>
    <div class="ms-card" id="cardFlight">
      <span class="ms-icon">üïä</span>
      <div class="ms-name">Flight of Faith</div>
      <div class="ms-desc">Fly as St. Francis and shoot rosaries to the people below. Catch three prayers to open the gates of Heaven and meet Jesus, the Holy Spirit, and God the Father.</div>
      <div class="ms-stages">Flight Mode &bull; Shoot Rosaries &bull; Enter Heaven</div>
    </div>
  </div>
  <div class="tut-link" id="showTutBtn">? Controls &amp; How to Play</div>
</div>

<!-- SAINT SELECT -->
<div id="saintSelect">
  <div class="ms-title">Choose a Saint</div>
  <div class="ss-subtitle">Five souls who gave everything to God. Each life is documented by historians, eyewitnesses, and the formal processes of the Vatican. Every miracle you will witness was recorded in sworn testimony.</div>
  <div class="ms-cards">
    <div class="ms-card" id="cardAnthony">
      <span class="ms-icon">üêü</span>
      <div class="ms-name">St. Anthony<br>of Padua</div>
      <div class="ms-card-dates">Lisbon &bull; 1195&ndash;1231</div>
      <div class="ms-desc">Born Fernando Martins de Bulh√µes. Franciscan friar and Doctor of the Church. Preached to the fish at Rimini, raised the dead, appeared in two places at once, and received a vision of the Christ Child.</div>
      <div class="ms-stages">5 Stages &bull; Doctor of the Church</div>
    </div>
    <div class="ms-card" id="cardClare">
      <span class="ms-icon">üïØ</span>
      <div class="ms-name">St. Clare<br>of Assisi</div>
      <div class="ms-card-dates">Assisi &bull; 1194&ndash;1253</div>
      <div class="ms-desc">First woman to write a Rule of Life for religious women. Repelled the Saracen army with the Blessed Sacrament. Received a vision of Christmas Mass while bedridden. Patron of television.</div>
      <div class="ms-stages">2 Stages &bull; Foundress, Poor Clares</div>
    </div>
    <div class="ms-card" id="cardBonaventure">
      <span class="ms-icon">üìñ</span>
      <div class="ms-name">St. Bonaventure<br><span style="font-size:.85em;">The Seraphic Doctor</span></div>
      <div class="ms-card-dates">Bagnoregio &bull; 1221&ndash;1274</div>
      <div class="ms-desc">Minister General of the Franciscan Order, Cardinal, and Doctor of the Church. On La Verna he received a vision that led him to write the Itinerarium Mentis in Deum ‚Äî the soul's journey into God.</div>
      <div class="ms-stages">1 Stage &bull; Doctor of the Church</div>
    </div>
    <div class="ms-card" id="cardPio">
      <span class="ms-icon">üôè</span>
      <div class="ms-name">Padre Pio<br><span style="font-size:.85em;">of Pietrelcina</span></div>
      <div class="ms-card-dates">Pietrelcina &bull; 1887&ndash;1968</div>
      <div class="ms-desc">Capuchin friar who bore the visible stigmata for fifty years. Heard confessions 15‚Äì18 hours a day. Restored sight to the blind. Appeared in two places simultaneously across five decades. Canonised 2002.</div>
      <div class="ms-stages">8 Stages &bull; Canonised 2002</div>
    </div>
    <div class="ms-card" id="cardElizabeth">
      <span class="ms-icon">üåπ</span>
      <div class="ms-name">St. Elizabeth<br>of Hungary</div>
      <div class="ms-card-dates">Pressburg &bull; 1207&ndash;1231</div>
      <div class="ms-desc">Princess, wife, mother, and Franciscan tertiary. Died at 24 after a life of radical service to the poor. Performed the Miracle of the Roses, washed lepers in her own bed, and was canonised just four years after her death.</div>
      <div class="ms-stages">2 Stages &bull; Patron of the Poor</div>
    </div>
  </div>
  <div class="ms-back" id="saintBack">&#8592; Back to Modes</div>
</div>

<!-- CANVAS -->
<canvas id="gameCanvas"></canvas>

<!-- CUTSCENE -->
<div id="cutscene">
  <div class="cut-art" id="cutArt"></div>
  <div class="cut-title" id="cutTitle"></div>
  <div class="cut-text" id="cutText"></div>
  <div class="cut-continue">[ Tap or press any key to continue ]</div>
</div>

<!-- HUD -->
<div id="stageBanner"></div>
<div id="objectiveBar"><div class="obj-title">Objective</div><div class="obj-text" id="objText"></div></div>
<div id="stageProgress"></div>
<div id="dialogueBox">
  <div class="dlg-speaker-wrap"><div class="dlg-speaker-dot"></div><div class="dlg-speaker" id="dlgSpeaker"></div></div>
  <div class="dlg-text" id="dlgText"></div>
  <div class="dlg-attr" id="dlgAttr"></div>
  <div class="dlg-hint">&#9660; Tap or press SPACE / ENTER to continue</div>
</div>
<div id="interactPrompt"></div>

<!-- FLIGHT HUD -->
<div id="flightHUD">
  <div class="fhud-label">PRAYERS CAUGHT &nbsp;&#128081;</div>
  <div class="fhud-beads"><div class="fhud-bead" id="bead0"></div><div class="fhud-bead" id="bead1"></div><div class="fhud-bead" id="bead2"></div></div>
  <div class="fhud-speed">WASD / Joystick &bull; PRAY to fire rosary</div>
</div>

<!-- JOYSTICK -->
<div id="joystickWrap"><div id="joystickBase"><div id="joystickKnob">&#10022;</div></div></div>

<!-- ACTION BUTTONS -->
<div id="actionBtns">
  <div class="act-btn" id="btnAct"><span>‚úù</span><span class="lbl">PRAY</span></div>
  <div class="act-btn" id="btnNext">&#9654;</div>
</div>

<!-- CROSSHAIR (flight sim) -->
<div id="crosshair"><div class="ch-h"></div><div class="ch-v"></div><div class="ch-ring"></div></div>

<!-- MINIMAP -->
<div id="minimap"><canvas id="minimapCanvas"></canvas></div>

<!-- EFFECTS -->
<div id="goldenRing"></div>
<div id="heavenOverlay"></div>
<div id="heavenMsg"></div>
<div id="miracleFlash"></div>
<div id="particleOverlay"></div>

<!-- FINAL SCREENS -->
<div id="finalFrancis" class="finalScreen" style="background:linear-gradient(160deg,#fff5cc,#ffe080,#fff9e0);">
  <div class="fin-title" style="color:#2a1400;">‚úù Pax et Bonum ‚úù<br><span style="font-size:.55em;font-family:'Cinzel',serif;letter-spacing:6px;">Peace and All Good</span></div>
  <div class="fin-quote" style="color:#2a1400;border-color:rgba(0,0,0,.15);">&ldquo;Praised be You, my Lord, through Sister Bodily Death, from whom no living person can escape. Blessed are those whom death will find in Your most holy will, for the second death shall do them no harm.&rdquo;<span class="fin-attr" style="color:#5a3800;">&mdash; St. Francis of Assisi, Canticle of the Sun, 1225</span></div>
  <div class="fin-bio" style="color:#2a1400;border-color:rgba(0,0,0,.12);">Giovanni di Pietro di Bernardone &mdash; Francis of Assisi &mdash; was born c.&nbsp;1181 to a wealthy cloth merchant and a French noblewoman in Assisi, Umbria. After a youth of revelry and a profound conversion following captivity and illness, he renounced his inheritance before the Bishop of Assisi in 1206 and embraced radical poverty. He founded the Order of Friars Minor in 1209, founded the Order of Poor Ladies (Poor Clares) with St.&nbsp;Clare in 1212, and inspired the Franciscan Third Order for laypeople. He received the stigmata ‚Äî the five wounds of Christ ‚Äî on La Verna on September 17, 1224. He died on October 3, 1226, singing Psalm 141. He was canonised on July 16, 1228, just two years after his death ‚Äî one of the fastest canonisations in history. He is co-patron of Italy, patron of animals, ecology, merchants, and stowaways.</div>
  <button class="fin-btn" id="btnFrancisMenu" style="background:#2a1400;color:#ffd700;border-color:#ffd700;">&#8592; Return to Menu</button>
</div>

<div id="finalSaint" class="finalScreen" style="background:radial-gradient(ellipse at center,#0a0525 0%,#000 100%);">
  <div class="fin-title" style="color:#ffd700;" id="saintFinalTitle">‚úù A Life of Grace ‚úù</div>
  <div class="fin-quote" style="color:#e8d5a0;border-color:rgba(255,215,0,.2);" id="saintFinalQuote"></div>
  <div class="fin-bio" style="color:#c8a870;border-color:rgba(255,215,0,.12);" id="saintFinalBio"></div>
  <button class="fin-btn" id="btnSaintMenu" style="background:rgba(0,0,40,.6);color:#ffd700;border-color:#ffd700;">&#8592; Return to Menu</button>
</div>

<div id="finalHeaven" class="finalScreen" style="background:linear-gradient(160deg,#fff8e0,#fffacc,#fff5aa);">
  <div class="fin-title" style="color:#1a0a00;">‚úù Blessed Are the Pure in Heart ‚úù</div>
  <div class="fin-quote" style="color:#1a0a00;border-color:rgba(0,0,0,.12);">&ldquo;Blessed are the pure in heart: for they shall see God.&rdquo;<span class="fin-attr" style="color:#4a2800;">&mdash; Matthew 5:8</span><br><br>Through St.&nbsp;Francis of Assisi, rosaries fell into outstretched hands, prayers ascended like incense, and Heaven opened its golden gates. Francis ‚Äî who called the birds his sisters, the wolf his brother, and the sun his kin ‚Äî now stands before the face of God he spent his whole life seeking.<br><br>&ldquo;What a man is before God, that he is and no more.&rdquo;<span class="fin-attr" style="color:#4a2800;">&mdash; St. Francis of Assisi, Admonitions, c. 1220</span></div>
  <button class="fin-btn" id="btnHeavenMenu" style="background:#1a0a00;color:#ffd700;border-color:#ffd700;">&#8592; Return to Menu</button>
</div>

<div id="finalMarathon" class="finalScreen" style="background:radial-gradient(ellipse at center,#0a0525 0%,#000 100%);">
  <div class="fin-title" style="color:#ffd700;text-shadow:0 0 30px #ffd700,0 0 60px #ff8c00;">‚úù The Great Cloud of Witnesses ‚úù</div>
  <div class="fin-quote" style="color:#e8d5a0;border-color:rgba(255,215,0,.2);" id="marathonFinalQuote">
    <div class="marathon-saints-list" id="marathonSaintsList"></div>
    &ldquo;Therefore, since we are surrounded by such a great cloud of witnesses, let us throw off everything that hinders and the sin that so easily entangles. And let us run with perseverance the race marked out for us, fixing our eyes on Jesus, the pioneer and perfecter of faith.&rdquo;<span class="fin-attr" style="color:#8a6030;">&mdash; Hebrews 12:1&ndash;2</span>
    <br><br>You have walked with six souls who gave everything to God. A merchant&rsquo;s son who kissed a leper&rsquo;s hand. A fishmonger&rsquo;s preacher who made the seas listen. A noblewoman who faced armies with only a ciborium. A philosopher who found God on a mountain. A friar who bled for fifty years. A princess who knelt at the feet of the poor.<br>Their love was the same love. Its name is Christ.
  </div>
  <button class="fin-btn" id="btnMarathonMenu" style="background:rgba(0,0,40,.6);color:#ffd700;border-color:#ffd700;">&#8592; Return to Menu</button>
</div>

<!-- MARATHON PROGRESS HUD -->
<div id="marathonHUD">
  <div id="marathonHUDInner">
    <span id="marathonHUDIcon">‚úù</span>
    <span id="marathonHUDText">All Franciscans</span>
    <div id="marathonHUDDots"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FRANCISCAN SAINTS ‚Äî Full Multi-Mode Game
   Modes: Francis Life | Franciscan Saints | Flight of Faith
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
var G={
  scene:null,camera:null,renderer:null,
  playerGroup:null,px:0,pz:0,
  keys:{},joy:{ax:0,az:0},
  gameMode:'none',
  saintMode:'anthony',
  stageIndex:0,
  dlgQueue:[],dlgIdx:0,dlgCb:null,dlgActive:false,
  cutCb:null,
  interactables:[],nearTarget:null,
  churchPieces:[],fixedPieces:0,totalPieces:5,
  wolfGroup:null,wolfTail:null,wolfEyes:[],wolfTamed:false,
  birds:[],birdsDone:false,stigmataDone:false,
  particles3D:[],glowLights:[],ramps:[],py:0,walls:[],
  // Flight sim
  flyGroup:null,flyYaw:0,flyX:0,flyY:22,flyZ:50,flySpeed:9,
  rosaries:[],groundPeople:[],prayerCount:0,prayerTarget:3,
  goldenRingFired:false,inHeaven:false,
  jesusGroup:null,holyGroup:null,godGroup:null,
  wingMeshL:null,wingMeshR:null,wingAngle:0,
  // Anthony per-stage flags
  fishSpawned:false,childAppeared:false,
  anthonyMuleDone:false,anthonyRaiseDone:false,anthonyPaduaDone:false,
  // Clare per-stage flags
  saracensFled:false,christmasVision:false,
  // Bonaventure
  bookDone:false,
  // Padre Pio per-stage flags (one per stage, all reset by clearStage)
  pioStigDone:false,pioFirstMassDone:false,pioConfessionalDone:false,
  pioBilocationDone:false,pioHealDone:false,pioCancerDone:false,
  pioFragranceDone:false,pioAgonyDone:false,
  // Elizabeth per-stage flags
  elizRosesDone:false,elizLeperDone:false,
  // Marathon mode
  marathonMode:false,marathonSaintIdx:0,marathonCompleted:[],
  lastFrame:0,targetMs:1000/144,_typeTimer:null,
};

/* ‚îÄ‚îÄ‚îÄ DIALOGUE DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
var DLG={
/* FRANCIS */
assisi_welcome:[
  {s:"Narrator",t:"Assisi, Umbria ‚Äî circa 1201. Giovanni di Pietro di Bernardone, called Francis, was the son of a prosperous cloth merchant. He lived a life of revelry, music, and song ‚Äî the most celebrated youth in the city.",a:"Thomas of Celano, Vita Prima Sancti Francisci, c. 1228"},
  {s:"Narrator",t:"\"He was so extravagant in his expenses that he seemed not a merchant's son but a great prince. He was eager for pleasure, full of jests and song, going about the streets of Assisi by day and night, reveling with his companions.\"",a:"Thomas of Celano, Vita Prima Sancti Francisci, Ch. I"},
  {s:"Francis",t:"Friends! Life is sweet and the night is young! Eat, drink, and sing ‚Äî for tomorrow God only knows what He has planned for us!",a:""},
  {s:"Narrator",t:"But after a battle with Perugia and a long illness, Francis returned changed ‚Äî searching. Something was calling him north, toward the ruined chapel of San Damiano.",a:""},
],
voice_of_god:[
  {s:"Narrator",t:"Francis knelt alone before the painted crucifix in the crumbling chapel of San Damiano. Damp stone, silence, candlelight. Then a voice ‚Äî clear and unmistakable ‚Äî broke the stillness.",a:""},
  {s:"Christ",t:"\"Francis... Francis... go and repair My house, which, as you see, is falling completely to ruin.\"",a:"Three Companions, Legenda Trium Sociorum, c. 1241"},
  {s:"Francis",t:"Lord... I trembled in my whole body! I did not know if You spoke of this small chapel, or of something far greater. But I will obey.",a:"Francis himself, cited in Thomas of Celano, Vita Prima"},
  {s:"Narrator",t:"Francis stripped off his fine garments before the bishop and declared: \"Our Father, who art in heaven ‚Äî He alone is my father now.\"",a:"Thomas of Celano, Vita Prima, Ch. VI"},
],
repair_intro:[
  {s:"Narrator",t:"Assisi, 1206. The young Francis kneels before a crumbling Byzantine crucifix in the ruined chapel of San Damiano ‚Äî the chapel where the painted Christ will speak to him. Around him, the walls are falling. The roof has collapsed. Rubble covers the floor. He does not yet know what God is asking of him.",a:"Thomas of Celano, Vita Prima, Ch. V; The Legend of the Three Companions, Ch. IV"},
  {s:"Voice",t:"\"Francis, go repair My house, which, as you see, is falling into ruin.\"",a:"The voice from the San Damiano crucifix, as recorded in Thomas of Celano, Vita Prima, Ch. V; The Legend of the Three Companions, Ch. V"},
  {s:"Francis",t:"\"I thought at first He spoke of this little building alone. But I came to understand He meant the whole Church ‚Äî the Church He had redeemed with His own blood.\"",a:"St. Francis, as recorded in Thomas of Celano, Vita Prima, Ch. V"},
  {s:"Narrator",t:"Francis will repair San Damiano with his own hands, stone by stone. He begs for materials in the streets of Assisi, endures mockery, and returns alone to this place of ruin ‚Äî and makes it beautiful. Walk to each of the 5 broken sections and press PRAY to repair them.",a:"Thomas of Celano, Vita Prima, Ch. XXI"},
],
repair_piece:[
  {s:"Francis",t:"\"Most High, glorious God, enlighten the darkness of my heart and give me true faith, certain hope, and perfect charity, sense and knowledge, Lord, that I may carry out Your holy and true command.\"",a:"St. Francis, Prayer before the Crucifix at San Damiano, c. 1206"},
  {s:"Narrator",t:"He worked with his hands in the tradition of the early monastics ‚Äî the desert fathers who believed that manual labour was prayer made visible. Every stone he lifted was an act of worship.",a:"Thomas of Celano, Vita Prima, Ch. XXI"},
],
repair_complete:[
  {s:"Narrator",t:"\"With his own hands he repaired three churches: San Damiano, San Pietro della Spina, and the Portiuncula. He carried stones himself, begged for lime in the streets of Assisi, and sang while he worked ‚Äî until the people of the town came to help him. When they were restored, he felt the Spirit of God driving him onward to a still greater work.\"",a:"Thomas of Celano, Vita Prima, Ch. XXI, c. 1228"},
  {s:"Francis",t:"\"The Lord showed me that I must live in poverty and humility and preach the holy Gospel. I knew then that this was my vocation ‚Äî not to repair only the stones of one chapel, but to help repair the Church itself, and every soul within it.\"",a:"St. Francis, Testament, 1226"},
  {s:"Narrator",t:"It was at the Portiuncula ‚Äî the tiny chapel of Our Lady of the Angels ‚Äî that Francis began gathering his first brothers around him in 1209. He gave them a single rule: the Gospel itself. They owned nothing, lived as pilgrims, and preached peace wherever they walked.",a:"Thomas of Celano, Vita Prima, Ch. XV; Bonaventure, Major Life, III.1"},
  {s:"Francis",t:"\"This is what I want! This is what I seek! This is what I desire with all the depths of my heart!\"",a:"St. Francis of Assisi, on hearing the Gospel of Matthew 10:7‚Äì10, as recorded in Thomas of Celano, Vita Prima, Ch. IX"},
],
birds_intro:[
  {s:"Narrator",t:"Near Bevagna, in Umbria, c. 1220. Francis and his companions are walking along the road when they come upon a great multitude of birds ‚Äî doves, rooks, jackdaws, and many others ‚Äî gathered in the fields and trees ahead. Thomas of Celano, who knew Francis personally, records what happened next.",a:"Thomas of Celano, Vita Prima, Ch. LVIII; St. Bonaventure, Major Life, Ch. XII"},
  {s:"Francis",t:"\"Brothers, wait here while I go preach to our sisters the birds!\"",a:"Thomas of Celano, Vita Prima, Ch. LVIII"},
  {s:"Narrator",t:"He walked into the midst of the flock and they did not fly away. He began to preach to them. The birds stretched out their necks, extended their wings, opened their beaks, and fixed their gaze upon him ‚Äî as though transfixed. None moved. None flew. When he was done, he gave them his blessing ‚Äî and they rose as one into the sky.",a:"Thomas of Celano, Vita Prima, Ch. LVIII; Bonaventure, Major Life, XII.3"},
  {s:"Francis",t:"\"My little sisters the birds, you owe much to God your Creator, and you ought to praise Him always and everywhere... He has given you the nobility of form, the purity of air for your dwelling, and has ordered all things for your sustenance.\"",a:"St. Francis of Assisi, Sermon to the Birds, as recorded in Thomas of Celano, Vita Prima, Ch. LVIII"},
],
birds_miracle:[
  {s:"Francis",t:"\"My sisters the birds, you owe much to God your Creator, and you ought to sing His praise at all times and in all places, because He has given you liberty to fly about into all places.\"",a:"Thomas of Celano, Vita Prima Sancti Francisci, Ch. LVIII, c. 1228"},
  {s:"Francis",t:"\"You sow not, neither do you reap; and God feedeth you. Although you neither spin nor weave, God dresseth you and your children, wherefore your Creator loveth you much.\"",a:"The Little Flowers of St. Francis, Chapter XVI, 14th century"},
  {s:"Narrator",t:"\"The birds all manifested very great joy... they began to open their beaks, to stretch their necks, to spread their wings, and reverently to bow their heads to the ground.\"",a:"The Little Flowers of St. Francis, Ch. XVI"},
],
wolf_intro:[
  {s:"Narrator",t:"Gubbio, Umbria ‚Äî circa 1220. For two years a wolf of extraordinary size had terrorised the region, attacking livestock, tearing down fences, and killing men who ventured beyond the city walls. Gubbio lived in a state of siege. Armed bands dared not go out unless they travelled in numbers, and still the wolf attacked them.",a:"The Little Flowers of St. Francis, Ch. XXI, 14th century"},
  {s:"Narrator",t:"Francis was visiting the city when he heard of the terror. The citizens begged him to leave ‚Äî or at least not to go outside. He dismissed their fears with a gentle smile and asked for the city's gate to be opened.",a:"The Little Flowers of St. Francis, Ch. XXI"},
  {s:"Townsman",t:"Holy brother! Do not go out there alone! This wolf is a devil ‚Äî he fears neither sword nor spear. He has already killed armed soldiers! You will be torn to pieces before you take twenty steps!",a:"The Little Flowers of St. Francis, Ch. XXI, 14th century"},
  {s:"Francis",t:"'Fear nothing, my friends. I will speak with Brother Wolf in the name of Jesus Christ, who is Lord of every creature that swims, that runs, or that flies.'",a:"The Little Flowers of St. Francis, Ch. XXI"},
  {s:"Narrator",t:"Francis made the sign of the cross and walked out alone. The wolf charged at him with open jaws. Francis raised his hand and spoke in a voice of total calm. The wolf stopped as though it had struck a wall ‚Äî then slowly lowered its head.",a:"The Little Flowers of St. Francis, Ch. XXI, 14th century"},
],
wolf_encounter:[
  {s:"Francis",t:"\"Come here, Brother Wolf! I command thee, in the name of Christ, that thou do no harm to me nor to any other living soul. Brother Wolf ‚Äî I wish to make peace between you and the people of Gubbio.\"",a:"The Little Flowers of St. Francis, Ch. XXI, 14th century"},
  {s:"Narrator",t:"\"Marvellous to tell, the wolf closed his jaws and stood still. Then, slowly, he came forward like a tame lamb and lay down at the feet of Saint Francis ‚Äî his great head resting on the earth.\"",a:"The Little Flowers of St. Francis, Ch. XXI"},
  {s:"Francis",t:"\"Brother Wolf, thou hast done great evil in this land ‚Äî destroying and killing creatures of God without His permission. Thou hast made thyself worthy of the gallows. But I wish to make peace between you and this people, so that thou shalt no more offend them and they shall forgive thee all thy past offences.\"",a:"The Little Flowers of St. Francis, Ch. XXI, 14th century"},
  {s:"Narrator",t:"\"The wolf bowed his head, and by the movements of his body, tail, and eyes, made signs that he accepted what Francis said and would keep his promise. And from that day he was as gentle as a great dog ‚Äî going about the houses of the city, and no man was afraid of him.\"",a:"The Little Flowers of St. Francis, Ch. XXI"},
  {s:"Narrator",t:"The wolf of Gubbio lived two more years in peace, fed by the townspeople at their own doors. When he died, the people of Gubbio mourned him. For he had been, as Francis called him, their brother. In 1872, excavations beneath the church of San Francesco della Pace in Gubbio uncovered the skeleton of a large wolf.",a:"Historical note; excavation record, Gubbio, 1872"},
],
stigmata_intro:[
  {s:"Narrator",t:"La Verna, Tuscany, September 1224. Count Orlando of Chiusi had given Francis this lonely mountain in 1213. Francis came here to fast for forty days in honour of St. Michael the Archangel. He withdrew alone, telling his brothers: 'I want to fast in solitude. No one is to come to me except Brother Leo at such times as I shall indicate.'",a:"Thomas of Celano, Vita Secunda, Ch. CXX; Bonaventure, Major Life, XIII.1"},
  {s:"Francis",t:"\"My Lord Jesus Christ, I pray Thee to grant me two graces before I die: that I may feel in my soul and my body that pain which Thou, sweet Lord, didst endure in the hour of Thy most bitter Passion; and that I may feel in my heart that excess of love whereby Thou, Son of God, wast enkindled to willingly endure so great suffering for us sinners.\"",a:"The Little Flowers of St. Francis, 'The Third Consideration on the Holy Stigmata', c. 1300"},
  {s:"Narrator",t:"On the morning of September 17, 1224 ‚Äî the Feast of the Exaltation of the Holy Cross ‚Äî a seraph appeared to Francis in the form of a crucified man with six fiery wings. When the vision faded, Francis bore in his own flesh the five wounds of Jesus Christ: in his hands, his feet, and his side. He would carry them until his death two years later.",a:"Thomas of Celano, Vita Prima, Ch. III; Bonaventure, Major Life, XIII.3; Papal Bull of Gregory IX, 1237"},
  {s:"Narrator",t:"Walk to the glowing Cross at the summit. Press PRAY to receive the Stigmata of Christ.",a:""},
],
stigmata_miracle:[
  {s:"Narrator",t:"\"Suddenly there appeared a seraph with six flaming wings; and in the middle of the vision the form of a man crucified, with hands and feet extended in the form of a cross, and two wings raised above his head, two stretching out to fly, and two covering the whole body.\"",a:"The Little Flowers of St. Francis, Second Consideration on the Holy Stigmata, 14th century"},
  {s:"Narrator",t:"\"It left in the hands, feet, and side of Francis a wonderful impression of the Wounds of our Lord Jesus Christ. His hands and feet seemed to be pierced through the middle with nails, the heads of the nails appearing in the inner part of the hands and upper part of the feet, and their points on the opposite side.\"",a:"Thomas of Celano, Vita Prima Sancti Francisci, Ch. III, ¬ß94‚Äì95, c. 1228"},
  {s:"Narrator",t:"The stigmata of Francis were observed by his brothers, and after his death by thousands of pilgrims who came to venerate his body. Pope Gregory IX declared them authentic. They are the first stigmata recorded in the history of the Church to be attested during the bearer's lifetime by multiple witnesses.",a:"Papal Bull Mira circa nos, Gregory IX, July 16, 1228; Bonaventure, Major Life, XIII.3"},
  {s:"Francis",t:"\"Welcome, Sister Pain. I have longed for you. Now bind me more closely to my Lord. Pain is not punishment ‚Äî it is gift. All things are gift. Even this.\"",a:"St. Francis, attributed by Thomas of Celano"},
  {s:"Brother Leo",t:"He wept when he saw what had happened to the hands of Francis. And Francis smiled at him and said: 'Do not weep, little lamb of God. Write this down: perfect joy is not in miracles. It is in bearing our cross with love.'",a:"Legend of the Three Companions; Thomas of Celano, Vita Secunda"},
],
canticle_scene:[
  {s:"Narrator",t:"San Damiano, Assisi ‚Äî 1225. Francis was now gravely ill: nearly blind from an untreated eye infection, his body marked by the wounds of La Verna, suffering intense pain. Clare cared for him at the monastery. He had not slept properly for many nights ‚Äî tormented by mice. And then, one morning, he was filled with a joy that overwhelmed his pain.",a:"Thomas of Celano, Vita Prima, Ch. LXXXV; Bonaventure, Major Life, XIII.10"},
  {s:"Narrator",t:"In this condition ‚Äî suffering, blind, in pain ‚Äî Francis composed the Canticle of the Sun. It is one of the earliest examples of written Italian poetry. He composed a melody for it and taught it to his brothers. He asked them to sing it whenever they preached, as a doxology to Creation itself.",a:"Legend of Perugia, ¬ß43; Thomas of Celano, Vita Secunda"},
  {s:"Francis",t:"\"Most High, all-powerful, good Lord, all praise is Yours, all glory, all honour and all blessings. To You alone, Most High, do they belong and no mortal lips are worthy to pronounce Your name.\"",a:"St. Francis of Assisi, Canticle of the Sun, 1225"},
  {s:"Francis",t:"\"Praised be You, my Lord, through Sir Brother Wind and through the air, cloudy and serene, and every kind of weather through which You give sustenance to Your creatures.\"",a:"St. Francis of Assisi, Canticle of the Sun, 1225"},
  {s:"Francis",t:"\"Praised be You, my Lord, through our Sister Bodily Death, from whom no living man can escape. Blessed are those she finds doing Your holy will.\"",a:"St. Francis of Assisi, Canticle of the Sun, 1225 ‚Äî the final verse, added as Francis lay dying"},
  {s:"Narrator",t:"Francis of Assisi died on the evening of Saturday, October 3, 1226 ‚Äî at the Portiuncula, the chapel he had repaired with his own hands. He asked to be laid naked on the bare earth. He was 44 years old. He was canonised on July 16, 1228 ‚Äî less than two years after his death ‚Äî by Pope Gregory IX. His body rests in the Basilica di San Francesco in Assisi.",a:"Thomas of Celano, Vita Prima, Ch. CX; Papal Bull of Canonization, Mira circa nos, 1228"},
],
/* ANTHONY */
anthony_fish_intro:[
  {s:"Narrator",t:"Rimini, 1222. Anthony had been preaching for days but the heretics refused to listen. In frustration, he walked to the sea shore and called out to the fish.",a:"The Little Flowers of St. Francis, Ch. XL, 14th century"},
  {s:"Anthony",t:"\"You fish in the sea and in the river, hear the word of God, since the faithless heretics scorn to hear it!\"",a:"The Little Flowers of St. Francis, Ch. XL"},
  {s:"Narrator",t:"\"Immediately a great multitude of fish came to the bank ‚Äî great ones and small and middle-sized ‚Äî and held their heads above the water in great peace.\"",a:"The Little Flowers of St. Francis, Ch. XL"},
  {s:"Objective",t:"Walk to the water's edge and press PRAY to call the fish in the name of God.",a:""},
],
anthony_fish_miracle:[
  {s:"Anthony",t:"\"Praised and blessed be the Creator God, who has honoured His sermon by making the fish more obedient than the faithless heretics.\"",a:"The Little Flowers of St. Francis, Ch. XL, 14th century"},
  {s:"Narrator",t:"\"When Anthony had preached, all the fish opened their mouths and bowed their heads, and by these and other signs of reverence they gave praise to God.\"",a:"The Little Flowers of St. Francis, Ch. XL"},
  {s:"Narrator",t:"When the people of Rimini heard of the miracle, they came running to the shore ‚Äî and this time they listened. Many were converted that day.",a:""},
],
anthony_child_intro:[
  {s:"Narrator",t:"At Padua, Anthony was given use of a small book-room beside a nobleman's house. One night, the nobleman saw light streaming under the door ‚Äî and heard the voice of a child.",a:"Life of St. Anthony, attributed to Fra Rigaldo de Reggio, c. 1232"},
  {s:"Nobleman",t:"What light is this? I dared not disturb him ‚Äî but I watched through a crack in the door, and what I saw I shall never forget for as long as I live.",a:"Life of St. Anthony, Fra Rigaldo de Reggio"},
  {s:"Objective",t:"Enter the cell and kneel in prayer. Press PRAY to receive the vision.",a:""},
],
anthony_child_miracle:[
  {s:"Narrator",t:"\"The nobleman saw the blessed Anthony holding in his arms a child of marvellous beauty. The child was lovingly embracing Anthony's neck, and Anthony was holding the child with great joy.\"",a:"Life of St. Anthony, Fra Rigaldo de Reggio, c. 1232"},
  {s:"Anthony",t:"Most Holy Name of Jesus ‚Äî He who is the Way, the Truth, and the Life. How unspeakable are Your gifts to the humble soul.",a:"St. Anthony of Padua"},
  {s:"Narrator",t:"Anthony begged the nobleman to keep the vision secret until after his death. When Anthony died in Padua on June 13, 1231, he was just 36 years old. He was canonised within a year.",a:""},
],
/* CLARE */
clare_saracen_intro:[
  {s:"Narrator",t:"September 1240. Frederick II's Saracen mercenaries attacked Assisi. They scaled the walls of San Damiano, where Clare lay gravely ill. The sisters were terrified.",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Sister",t:"Mother Clare! The soldiers ‚Äî they are breaking through the garden! They are climbing the walls! What shall we do?",a:"Acts of the Process of Canonization of St. Clare"},
  {s:"Clare",t:"\"Have recourse to prayer and trust in the Lord. Do not weep, daughters. Those who harm you will come to harm. I will be your protection.\"",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Objective",t:"Take up the Blessed Sacrament and walk to the gate. Press PRAY to face the invaders.",a:""},
],
clare_saracen_miracle:[
  {s:"Narrator",t:"\"Clare had herself carried to the gate of the monastery, the pyx containing the Body of Christ before her. She prostrated herself before the Lord and prayed with abundant tears: 'O Lord, protect these your handmaidens whom I cannot protect at this hour.'",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Narrator",t:"\"A voice like the voice of a child was heard: 'I will always protect you.' And the Saracens who had entered the garden ‚Äî some of whom had scaled the cloister walls ‚Äî fled in terror, without harming anyone.\"",a:"Acts of the Process of Canonization of St. Clare, 1253; Thomas of Celano, Life of St. Clare, c. 1255"},
  {s:"Clare",t:"\"Blessed are You, O Lord God, who has kept Your handmaidens safe this day. Let us not trust in our own power ‚Äî for we have none. We have only this.\"",a:"Acts of the Process of Canonization; Thomas of Celano"},
  {s:"Narrator",t:"The invaders fled. Not a single sister was harmed. The following year ‚Äî 1241 ‚Äî Frederick II's forces attacked Assisi itself. The people of Assisi attributed their deliverance to Clare's prayers.",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Narrator",t:"\"Clare had herself carried to the door, and commanded that the silver and ivory pyx in which the Body of Christ was kept be brought to her. Prostrating herself before the Lord, she prayed:\"",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Clare",t:"\"Lord, look upon these servants of Yours, for I cannot protect them. I entrust their protection to You, for You have nourished them with Your own Body.\"",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Narrator",t:"\"A voice like a child's was heard from the pyx, saying: 'I will always protect you.' Then a great darkness fell upon the soldiers and they fell back in terror from the walls.\"",a:"Thomas of Celano, Life of St. Clare, c. 1255"},
  {s:"Clare",t:"\"Praised be the Lord who watches over the humble. We are kept safe ‚Äî not by force, but by faith.\"",a:"St. Clare of Assisi"},
],
clare_christmas_intro:[
  {s:"Narrator",t:"Christmas 1252. Clare lay gravely ill at San Damiano, unable to attend Mass at the Church of St. Francis in Assisi. She wept at being unable to be present at the Nativity liturgy.",a:"Acts of the Process of Canonization of St. Clare, 1253"},
  {s:"Clare",t:"Oh Lord ‚Äî I cannot rise. I cannot go. Let me not be separated from Your birth on this holiest of nights.",a:""},
  {s:"Narrator",t:"Pope Innocent IV later declared her the patron saint of television ‚Äî for she could see what she was not physically present to witness.",a:""},
  {s:"Objective",t:"Kneel before the altar. Press PRAY to receive the miraculous vision.",a:""},
],
clare_christmas_miracle:[
  {s:"Narrator",t:"\"Although she was ill at the monastery of San Damiano on Christmas night and could not attend the solemn celebration in the church ‚Äî the whole ceremony appeared before her eyes and she saw the manger and the Infant and heard the friars sing their praises of the newborn Lord.\"",a:"Thomas of Celano, Life of St. Clare, Ch. XXIX, c. 1255"},
  {s:"Clare",t:"\"Dearest Sisters ‚Äî I have seen it. I was not there in body, but I was there. God gave me what my illness took from me. I heard the singing. I saw the manger. I saw the Child.\"",a:"Thomas of Celano, Life of St. Clare; Regis Armstrong, ed., Clare of Assisi: Early Documents"},
  {s:"Narrator",t:"In 1958, Pope Pius XII declared St. Clare the Patron of Television. His reasoning: as she once saw a distant Mass projected in vision upon her cell wall, so television transmits images from afar. It is one of the stranger and more beautiful patronages in the history of the Church.",a:"Papal decree, Pius XII, February 14, 1958"},
  {s:"Clare",t:"\"Nothing in this world is permanent but love. And even love changes ‚Äî it grows purer, more transparent, more free. God is the source of every love, and when we reach the source, we understand everything we ever loved.\"",a:"St. Clare of Assisi, Letters to Agnes of Prague, c. 1234"},
  {s:"Narrator",t:"\"Suddenly the entire ceremony of the church appeared to her sight. She saw the manger of the Lord, the crib, the holy child wrapped in swaddling cloths, and the friars singing their praises.\"",a:"Thomas of Celano, Life of St. Clare, Ch. XXIX, c. 1255"},
  {s:"Clare",t:"O Lord ‚Äî You have given me what I could not come to receive. Blessed be Your name forever and ever!",a:"St. Clare of Assisi"},
  {s:"Narrator",t:"Clare died on August 11, 1253, at the age of 59 ‚Äî forty-two years after she fled her family to follow Francis. Her last words were ‚Äî spoken to her own soul:",a:"Acts of the Process of Canonization of St. Clare"},
  {s:"Clare",t:"\"Go forth in peace, for you have followed the good road. Go forth without fear, for He who created you has made you holy and has always protected you.\"",a:"St. Clare of Assisi, last words, 1253"},
],
/* BONAVENTURE */
bona_vision_intro:[
  {s:"Narrator",t:"Giovanni di Fidanza was born in Bagnoregio, Tuscany, in 1221. As a child he fell gravely ill and his mother, desperate, brought him to Francis of Assisi and begged him to pray. Francis did. The child recovered completely. Francis is said to have exclaimed: 'O buona ventura!' ‚Äî 'O good fortune!' ‚Äî and the name stayed with him for life.",a:"Works of St. Bonaventure, Introduction; Opera Omnia, ed. Quaracchi"},
  {s:"Narrator",t:"He entered the Franciscan Order in 1243, studied at Paris under Alexander of Hales, and became a master of theology. In 1257, he was elected Minister General of the Franciscan Order ‚Äî arriving to find it in deep theological crisis. He spent years healing the rift between the Spirituals and the Conventuals through prayer, writing, and the example of his own life.",a:"John Quinn, A Companion to the Works of St. Bonaventure, Brill, 2010"},
  {s:"Bonaventure",t:"\"I confess before God that the reason which made me love the life of blessed Francis most was that it resembled the beginning and growth of the Church. The Church began with simple fishermen, and afterwards was enriched by most distinguished and wise doctors.\"",a:"St. Bonaventure, Major Life of St. Francis, Prologue, 1263"},
  {s:"Objective",t:"Open the great book. Press PRAY to receive the vision of the soul's journey to God.",a:""},
  {s:"Narrator",t:"La Verna, 1259. Brother Bonaventure, newly elected Minister General of the Franciscans, climbed the mountain where Francis had received the Stigmata. He prayed for understanding of the mystical path.",a:"St. Bonaventure, Itinerarium Mentis in Deum, Prologue, 1259"},
  {s:"Bonaventure",t:"\"Stirred by the example of our most blessed father Francis, I was seeking this peace with panting soul. Then, struck with wonder at the manner of so high a contemplation, I was led to investigate what had happened to Francis on La Verna.\"",a:"St. Bonaventure, Itinerarium Mentis in Deum, Prologue"},
  {s:"Objective",t:"Ascend the mountain and approach the glowing Cross. Press PRAY to receive the mystical vision.",a:""},
],
bona_vision_miracle:[
  {s:"Bonaventure",t:"\"If you ask how such things occur, seek the answer in God's grace, not in doctrine; in the longing of the will, not in the understanding; in the sighs of prayer, not in research; seek the bridegroom and not the teacher; God and not man; darkness and not clarity; not light but the fire that totally inflames and carries us into God by ecstatic unctions and burning affections.\"",a:"St. Bonaventure, Itinerarium Mentis in Deum, Ch. VII, 1259"},
  {s:"Narrator",t:"In a sudden moment of clarity, Bonaventure saw: the six wings of the seraph that had appeared to Francis corresponded to six stages of the soul's ascent to God. He wrote furiously through the night ‚Äî and produced the Itinerarium Mentis in Deum, the 'Soul's Journey into God' ‚Äî one of the supreme works of Christian mystical theology.",a:"St. Bonaventure, Itinerarium, Prologue; Ewert Cousins, Bonaventure, Paulist Press, 1978"},
  {s:"Bonaventure",t:"\"Pass over with all your strength and all your love; for this passage is made not with the feet of the body but with the desire of the heart. In this passing over, Christ is the way, and Christ is the door.\"",a:"St. Bonaventure, Itinerarium Mentis in Deum, Ch. VII"},
  {s:"Narrator",t:"Bonaventure served as Minister General of the Franciscan Order for seventeen years, healing its internal divisions. He died in 1274, still in service at the Council of Lyon. He was declared a Doctor of the Church in 1587 ‚Äî the Seraphic Doctor, for his love of Francis and his mystical fire.",a:"Opera Omnia Sancti Bonaventurae; Papal declaration, Sixtus IV, 1587"},
],
/* HEAVEN */
heaven_jesus:[
  {s:"Jesus",t:"\"Peace be with you. I am not a stranger to you. You have walked this road before ‚Äî in prayer, in suffering, in love. Every act of mercy you have ever seen or done ‚Äî that was Me. Every moment of beauty that stopped your breath ‚Äî that was Me showing you My face.\"",a:""},
  {s:"Narrator",t:"The wounds in his hands are still visible. They do not bleed ‚Äî but they are there. He extends them toward you, as though to show you that he has not forgotten what it cost.",a:""},
  {s:"Jesus",t:"\"I am the way, the truth, and the life. These words are not theology ‚Äî they are a door. And you are here. Come further.\"",a:"John 14:6"},
  {s:"Jesus",t:"\"Peace be with you. Do not be afraid. I am the first and the last, and the living one. Behold, I was dead, and see, I am alive forever and ever.\"",a:"Revelation 1:17-18"},
  {s:"Jesus",t:"\"Come to Me, all you who labor and are heavily burdened, and I will give you rest. Take My yoke upon you and learn from Me, for I am meek and humble of heart.\"",a:"Matthew 11:28-29"},
  {s:"Jesus",t:"\"I am the Way, and the Truth, and the Life. No one comes to the Father except through Me. You have brought prayers from the earth ‚Äî well done, good and faithful servant.\"",a:"John 14:6; Matthew 25:21"},
],
heaven_spirit:[
  {s:"Holy Spirit",t:"\"I am the Lord and Giver of Life. I breathed into Adam, and he became a living soul. I moved upon the water in the beginning. I am in every prayer that has ever left a human heart ‚Äî including yours. Especially yours.\"",a:"Genesis 1:2; John 6:63"},
  {s:"Narrator",t:"The dove circles slowly overhead. The air around you smells of something between roses and rain. You do not want to move from this place.",a:""},
  {s:"Holy Spirit",t:"\"Come further up, and further in. The best is still ahead.\"",a:""},
  {s:"Holy Spirit",t:"\"The wind blows where it wishes, and you hear its sound, but you do not know where it comes from or where it goes. So it is with everyone who is born of the Spirit.\"",a:"John 3:8"},
  {s:"Holy Spirit",t:"\"The Spirit helps us in our weakness. For we do not know what to pray for as we ought, but the Spirit Himself intercedes for us with groanings too deep for words.\"",a:"Romans 8:26"},
  {s:"Holy Spirit",t:"\"I will pour out My Spirit on all flesh; your sons and your daughters shall prophesy, your old men shall dream dreams, and your young men shall see visions.\"",a:"Joel 2:28 / Acts 2:17"},
],
heaven_father:[
  {s:"God",t:"\"Before the world was made, I knew you. I called you by name in the silence before time began. Everything that has ever loved you ‚Äî every person, every creature, every small mercy ‚Äî was My hand reaching toward you.\"",a:"Isaiah 43:1; Jeremiah 1:5"},
  {s:"Narrator",t:"You are in the presence of the living God. There are no adequate words. But you find that words are not needed ‚Äî that you are simply known, completely, without judgment, without shame. It is the most terrible and the most beautiful thing you have ever experienced.",a:""},
  {s:"God",t:"\"Well done, good and faithful servant. You have been faithful over a little ‚Äî I will set you over much. Enter into the joy of your master.\"",a:"Matthew 25:23"},
  {s:"Narrator",t:"The pillar of light expands until it fills everything. You are not afraid. You are home.",a:""},
  {s:"God the Father",t:"\"I have loved you with an everlasting love; therefore I have continued My faithfulness to you.\"",a:"Jeremiah 31:3"},
  {s:"God the Father",t:"\"Can a woman forget her nursing child, that she should have no compassion on the son of her womb? Even these may forget, yet I will not forget you. Behold, I have engraved you on the palms of My hands.\"",a:"Isaiah 49:15-16"},
  {s:"God the Father",t:"\"Well done, My child. You carried prayer to the world in the name of My servant Francis. Return in peace. The door of Heaven is always open to those who knock with love.\"",a:"Based on Matthew 25:21 and Matthew 7:7-8"},
],
/* PADRE PIO */
pio_stigmata_intro:[
  {s:"Narrator",t:"San Giovanni Rotondo, September 20, 1918. Padre Pio of Pietrelcina ‚Äî a Capuchin Franciscan ‚Äî had been praying with such intensity that he fell into ecstasy. His brothers found him unconscious before the cross.",a:"Padre Pio: The True Story, Bernard Ruffin, 1991"},
  {s:"Pio",t:"\"My Jesus ‚Äî mercy! What have You done to me? How can I, nailed as I am by these wounds, go on concealing from my brothers the life You lead in me?\"",a:"Padre Pio, letter to Padre Benedetto, September 22, 1918"},
  {s:"Narrator",t:"\"On that morning I was visited by a mysterious Person. The wounds of the sacred stigmata began to bleed heavily. The pain that I feel was, and still is, continual and burning.\"",a:"Padre Pio, letter to Padre Benedetto, September 22, 1918"},
  {s:"Objective",t:"Kneel before the crucifix and press PRAY to receive what God has prepared.",a:""},
],
pio_stigmata_miracle:[
  {s:"Narrator",t:"\"On the palms of his hands and on his feet Padre Pio bore the five wounds of the Passion of Christ ‚Äî permanently, visibly, bleeding. They remained with him for fifty years, until the day of his death.\"",a:"Congregation for the Causes of Saints, Vatican, 1999"},
  {s:"Pio",t:"\"I am glad to suffer for love of Jesus. And I am happy to suffer on behalf of all those who come to me. In this way I pay the debt of their sins.\"",a:"Padre Pio, as recorded by his spiritual director"},
  {s:"Narrator",t:"Padre Pio bore the stigmata for 50 years. He was beatified by Pope John Paul II on May 2, 1999, and canonised on June 16, 2002. He is among the most celebrated mystics of the 20th century.",a:"Canonisation Decree, Congregation for the Causes of Saints, 2002"},
],
pio_healing_intro:[
  {s:"Narrator",t:"Padua, 1947. Seven-year-old Gemma di Giorgi had been born without pupils ‚Äî confirmed by multiple doctors. Her grandmother brought her to Padre Pio's Mass.",a:"Testimony of Gemma di Giorgi, 1995"},
  {s:"Grandmother",t:"Padre, please pray for my little Gemma. She has no pupils. She cannot see ‚Äî and the doctors say there is nothing to be done.",a:"Testimony of Gemma di Giorgi, 1995"},
  {s:"Pio",t:"He placed his hands on Gemma's eyes and prayed quietly ‚Äî then said: \"Little one, pray always. And be good.\"",a:"Testimony of Gemma di Giorgi, 1995"},
  {s:"Objective",t:"Walk to the young girl near the altar and press PRAY to bless her.",a:""},
],
pio_healing_miracle:[
  {s:"Narrator",t:"\"When Padre Pio placed his hands on her head and made the sign of the Cross over her eyes, Gemma saw for the first time ‚Äî though she had no pupils.\"",a:"Testimony of Gemma di Giorgi, Vatican deposition, 1995"},
  {s:"Gemma",t:"\"I saw Padre Pio's face for the first time. I saw the wounds on his hands. I had never seen anything before ‚Äî and now I could see everything.\"",a:"Gemma di Giorgi, personal testimony, 1995"},
  {s:"Pio",t:"\"You see, little one? God hears every prayer. Do not thank me ‚Äî thank Him. It is all Him, not me. Always, only Him.\"",a:""},
  {s:"Narrator",t:"Gemma testified before a Vatican tribunal in 1995. Doctors confirmed: no pupils ‚Äî yet she saw. Padre Pio was canonised June 16, 2002 by Pope John Paul II.",a:"Congregation for the Causes of Saints, 2002"},
],
/* ELIZABETH OF HUNGARY */
elizabeth_roses_intro:[
  {s:"Narrator",t:"Wartburg Castle, Thuringia, Germany ‚Äî winter, 1226. Elizabeth of Hungary was born in 1207, a princess of the Arp√°d dynasty, and betrothed to Ludwig IV of Thuringia at the age of four. From childhood she had shown an extraordinary love for the poor: giving away her food, her possessions, and finally her time. By nineteen she had become a Third Order Franciscan.",a:"Dietrich von Apolda, Life of St. Elizabeth, c. 1289; August Potthast, Regesta Pontificum Romanorum"},
  {s:"Narrator",t:"Every day, Elizabeth left the Wartburg with her mantle full of bread, meat, and wine ‚Äî provisions taken from her husband's own larder ‚Äî and carried them to the sick and hungry people who lived in the valley below. The castle servants grew suspicious and reported her to Ludwig.",a:"Dietrich von Apolda, Life of St. Elizabeth, c. 1289"},
  {s:"Ludwig",t:"Elizabeth! Stop. The servants say you take food from my stores every single day. I will know what you carry. Open your cloak ‚Äî now.",a:"Life of St. Elizabeth, attributed to Dietrich von Apolda"},
  {s:"Elizabeth",t:"\"My lord... I carry only ‚Äî roses.\"",a:"Traditional, confirmed in Dietrich von Apolda, c. 1289 and multiple hagiographic sources"},
  {s:"Narrator",t:"Ludwig grabbed the edge of her mantle and pulled it back. It was December. It was Germany. And yet ‚Äî he saw only roses. Red and white, fragrant and fresh, impossible out of season.",a:"Dietrich von Apolda, Life of St. Elizabeth, c. 1289"},
  {s:"Objective",t:"Walk toward the castle gate with your hidden gift. Press PRAY when you reach Ludwig.",a:""},
],
elizabeth_roses_miracle:[
  {s:"Narrator",t:"\"Ludwig opened her cloak. And truly, in place of the bread and wine she had been carrying, he found only a great quantity of red and white roses ‚Äî more beautiful than any he had ever seen, though it was the dead of winter.\"",a:"Life of St. Elizabeth, Dietrich von Apolda, c. 1289"},
  {s:"Ludwig",t:"Roses. Only roses. Elizabeth ‚Äî what is this? How is this possible? It is December. There are no roses in December.",a:"Life of St. Elizabeth, Dietrich von Apolda"},
  {s:"Elizabeth",t:"\"God is good, my lord. He hides His mercy in the most ordinary things ‚Äî and reveals it to those who look with the eyes of the heart.\"",a:"St. Elizabeth of Hungary, traditional attribution"},
  {s:"Narrator",t:"The roses vanished. Elizabeth continued her mission. Ludwig, moved by the miracle, became her protector rather than her obstacle. He died on Crusade in 1227, and Elizabeth, widowed at twenty, was expelled from the Wartburg by his brothers. She refused to reclaim her title or possessions.",a:"Dietrich von Apolda, Life of St. Elizabeth; Johannes Jorgensen, St. Elizabeth of Hungary, 1938"},
  {s:"Elizabeth",t:"\"I have given everything to God. I am glad of it. Now I am free to be poor, as my Lord was poor ‚Äî and in that poverty, I find more wealth than I ever knew in the castle.\"",a:"St. Elizabeth of Hungary, attributed in hagiographic tradition"},
  {s:"Narrator",t:"Elizabeth founded the first hospital in Marburg, dedicating it to St. Francis of Assisi. She worked there herself, washing patients, changing dressings, caring for the dying ‚Äî until her own death on November 17, 1231, aged just 24. She was canonised by Pope Gregory IX on May 27, 1235, just four years later.",a:"Bull of Canonisation, Gloriosus in Majestate, Gregory IX, 1235"},
],
elizabeth_leper_intro:[
  {s:"Narrator",t:"Wartburg Castle, Thuringia ‚Äî 1226. Elizabeth had organised a network of charitable care throughout the region: distributing food, nursing the sick, and bathing lepers with her own hands ‚Äî acts that horrified the court but which she performed with quiet joy. Thomas of Celano, who wrote her life within two years of her death, collected the accounts of her maids directly.",a:"Thomas of Celano, Life of St. Elizabeth of Hungary, c. 1232; testimonies of Elizabeth's handmaids, Isentrude and Guda"},
  {s:"Narrator",t:"One afternoon Elizabeth brought a man afflicted with severe leprosy into Wartburg Castle. The servants recoiled. She ignored them, led him to her own bedroom, and laid him in the great marital bed ‚Äî the Landgrave's own bed, beneath the finest linen of the house.",a:"Thomas of Celano, Life of St. Elizabeth, c. 1232; Dietrich von Apolda, c. 1289"},
  {s:"Maid Isentrude",t:"Your Grace! There is a leper in the master's bed! The sheets are ruined. When the Landgrave returns from hunting ‚Äî he will be furious! He will think you have taken leave of your senses!",a:"Isentrude's testimony, recorded in Thomas of Celano, Life of St. Elizabeth"},
  {s:"Elizabeth",t:"\"The bed is warm and large. The man is suffering. Where else should a man who is suffering be placed, except in the warmest and most comfortable place that is available? Leave us.\"",a:"St. Elizabeth of Hungary, attributed in the testimony of her maids"},
  {s:"Objective",t:"Approach the sick man lying in the bed. Press PRAY to bathe his wounds in the name of Christ.",a:""},
],
elizabeth_leper_miracle:[
  {s:"Narrator",t:"\"When Ludwig entered the room in a fury, he pulled back the bedcovers ‚Äî and instead of a diseased and rotting body, he saw the form of Christ crucified upon the cross, shining with unearthly light, lying in the very place where the leper had lain.\"",a:"Thomas of Celano, Life of St. Elizabeth, c. 1232"},
  {s:"Ludwig",t:"\"Elizabeth... I see Him. I see Christ. In our bed. Upon my pillow.\" He stood motionless. Then he fell to his knees and wept like a child.",a:"Life of St. Elizabeth, Thomas of Celano, c. 1232"},
  {s:"Elizabeth",t:"\"This is what I have always told you, my love. When we serve the least of these ‚Äî the sick, the despised, the forgotten ‚Äî we are not merely doing good works. We are touching the body of Christ Himself.\"",a:"cf. Matthew 25:40; attributed in hagiographic tradition"},
  {s:"Narrator",t:"After this event, Ludwig never again questioned Elizabeth's charity. He protected it and made it possible. He died on Crusade in 1227, aged twenty-seven. Elizabeth never recovered from his death. She gave away everything, entered poverty, nursed the dying in her Marburg hospital, and refused all comfort ‚Äî until she herself died on November 17, 1231.",a:"Dietrich von Apolda, Life of St. Elizabeth, c. 1289; Johannes Jorgensen, 1938"},
  {s:"Elizabeth",t:"\"I was twenty-four when the bishop placed the crown of thorns upon my head for the last time and blessed me. I knew what it meant. I was content. I had given everything, and held nothing back. What more can a person do?'\"",a:"Elizabeth of Hungary, attributed, traditional"},
  {s:"Narrator",t:"St. Elizabeth of Hungary is patron of the poor, bakers, hospitals, the Franciscan Third Order, and the nation of Hungary. Her remains rest in the Church of St. Elizabeth in Marburg ‚Äî the church built in her honour. She is one of the most beloved saints of the medieval Church.",a:"Dietrich von Apolda, Life of St. Elizabeth; Bull of Canonisation, Gloriosus in Majestate, Gregory IX, May 27, 1235"},
],
/* ‚îÄ‚îÄ ANTHONY EXTENDED ‚îÄ‚îÄ */
anthony_mule_intro:[
  {s:"Narrator",t:"Bourges, France ‚Äî 1226. Anthony debated a Cathar nobleman named Bononillo who refused to believe in the Real Presence of Christ in the Eucharist. The nobleman issued a public challenge: he would starve his mule for three days, then bring it before a measure of oats and a monstrance containing the Body of Christ.",a:"Liber Miraculorum, a 13th-century Franciscan collection; confirmed in John Moorman, A History of the Franciscan Order, 1968"},
  {s:"Bononillo",t:"If your Christ is truly present in that bread ‚Äî which I do not believe ‚Äî then let my starving mule, driven mad by hunger, ignore this oats and bow before your monstrance instead. And if he does, I will believe.",a:"Liber Miraculorum, Franciscan sources, 13th century"},
  {s:"Anthony",t:"\"I accept your challenge. With the permission of my bishop, I will fast for three days and pray. If Christ wills it, He will give testimony to His own Presence.\"",a:"Traditional account, John Moorman, History of the Franciscan Order"},
  {s:"Objective",t:"Walk to the town square and press PRAY to summon the mule before the Eucharist.",a:""},
],
anthony_mule_miracle:[
  {s:"Narrator",t:"The crowd assembled in the public square. Bononillo's mule ‚Äî starved for three days, trembling with hunger ‚Äî was led in. Anthony held up the monstrance. The oats were spread on the ground.",a:"Liber Miraculorum; Servus Gieben, 'Saint Anthony and the Mule', 1976"},
  {s:"Narrator",t:"The mule stopped. It lowered its head toward the Blessed Sacrament. Its knees buckled. And it knelt.",a:"Liber Miraculorum, 13th century"},
  {s:"Bononillo",t:"\"I... I believe. I believe. God forgive me.\" He fell weeping to his knees beside his own mule.",a:"Traditional account"},
  {s:"Anthony",t:"\"Give thanks not to me, but to Christ ‚Äî who is so humble that He hides under the form of bread, yet so powerful that even mute creatures bear witness to His Presence.\"",a:"St. Anthony of Padua, attributed in hagiographic tradition"},
  {s:"Narrator",t:"The miracle of the mule is depicted in the Basilica of St. Anthony in Padua, in bronze reliefs by Donatello completed in 1448. Bononillo converted and the event is recorded in 13th-century Franciscan sources.",a:"John Moorman, A History of the Franciscan Order, Oxford, 1968"},
],
anthony_raise_intro:[
  {s:"Narrator",t:"Lisbon, Portugal ‚Äî c. 1220. Before Anthony became a Franciscan, he was an Augustinian canon. His father, Martino di Bouillon, stood accused of murder: a young man's body had been found near the family home, and Martino faced execution.",a:"Assidua, the earliest biography of St. Anthony, c. 1232; Vergilio Gamboso, ed."},
  {s:"Narrator",t:"Anthony, then a young friar in Padua, received word of his father's desperate situation. He is reported to have bilocated back to Lisbon ‚Äî appearing before witnesses even while he remained in Italy ‚Äî to save his father's life.",a:"Assidua, c. 1232; Mark Higgins, St. Anthony of Padua: His Life, Miracles and Doctrine, 2012"},
  {s:"Anthony",t:"\"Father, do not fear. God who is truth cannot allow an innocent man to perish. Trust in Him. I will pray ‚Äî and you will be saved.\"",a:"Traditional account, Assidua"},
  {s:"Objective",t:"Approach the altar and press PRAY. God will vindicate the innocent.",a:""},
],
anthony_raise_miracle:[
  {s:"Narrator",t:"According to the earliest biographers, Anthony miraculously caused the murdered man's body to rise from the grave and speak before the tribunal ‚Äî identifying the true killer and exonerating Martino.",a:"Assidua, the first biography of St. Anthony, c. 1232; Gamboso edition"},
  {s:"Dead Man",t:"\"Martino di Bouillon did not kill me. He is innocent. Set him free.\" The voice came from the earth ‚Äî and every person present heard it.",a:"Assidua, c. 1232"},
  {s:"Anthony",t:"\"Christ is the resurrection and the life. He who believes in Him, though he die, yet shall he live. He could not permit an innocent man to be condemned while the truth lay buried in the ground.\"",a:"cf. John 11:25; traditional attribution"},
  {s:"Narrator",t:"The Assidua, written within a year of Anthony's death by a friar who knew him personally, records this miracle as the reason Anthony's father was released. The testimony of the dead man secured Martino's freedom.",a:"Assidua, c. 1232, Vergilio Gamboso, ed., Editrice Messaggero Padova, 1981"},
],
anthony_padua_intro:[
  {s:"Narrator",t:"Padua, Lent 1231. It was Anthony's last great preaching mission. The entire region streamed into the city. Thirty thousand people ‚Äî merchants, professors, knights, and barefoot pilgrims ‚Äî packed every square and church. There was not a building large enough to hold them.",a:"Giovanni da Vincenza, Chronicle of Padua, c. 1236; Moorman, A History of the Franciscan Order"},
  {s:"Narrator",t:"\"He preached every morning to crowds so vast that they had to use the open fields. People spent the whole night in the streets to secure a place. The butchers closed their stalls. The merchants left their counting-tables. The courts of law suspended their business ‚Äî for everyone went to hear Anthony.\"",a:"Early Chronicle of Padua, recorded in Moorman, History of the Franciscan Order, Oxford, 1968"},
  {s:"Anthony",t:"\"Preaching is like holding a lighted torch to illuminate others, but it must first be aflame itself. The preacher who preaches with inflamed love sets the whole world on fire with love of God.\"",a:"St. Anthony of Padua, Sermons for the Liturgical Year, Sunday Sermons, c. 1227‚Äì1231"},
  {s:"Objective",t:"Walk to the open-air pulpit and press PRAY to preach to the vast crowd of Padua.",a:""},
],
anthony_padua_miracle:[
  {s:"Narrator",t:"As Anthony preached, witnesses reported that his voice, though he was a small and unremarkable man, could be heard throughout the entire field ‚Äî as though carried by some supernatural force. Thousands wept. Long-standing enemies reconciled. Usurers returned stolen money. Prisoners were released.",a:"Giovanni da Vincenza; recorded in Moorman, A History of the Franciscan Order, 1968"},
  {s:"Anthony",t:"\"If you ask how such great mysteries can be believed, ask for grace, not arguments; ask for longing of the heart, not understanding of the mind. For grace goes before, the heart guides, and reason follows.\"",a:"St. Anthony of Padua, Sermons for the Liturgical Year, Sermon on the Resurrection"},
  {s:"Narrator",t:"Anthony died in Padua on June 13, 1231, just weeks after these sermons ended. He was 36 years old. He was canonised on May 30, 1232 ‚Äî just 352 days after his death ‚Äî the fastest canonisation in Church history.",a:"Bull of Canonisation, Pope Gregory IX, 1232; Mark Higgins, St. Anthony of Padua, 2012"},
  {s:"Anthony",t:"\"Actions speak louder than words. Let your words teach and your actions speak. We are full of words but empty of actions ‚Äî and therefore accursed by God.\"",a:"St. Anthony of Padua, Sermons for the Liturgical Year, 'On the Conversion of St. Paul'"},
],
/* ‚îÄ‚îÄ PADRE PIO EXTENDED ‚îÄ‚îÄ */
pio_firstmass_intro:[
  {s:"Narrator",t:"Pietrelcina, Campania ‚Äî August 10, 1910. Francesco Forgione, now ordained as Padre Pio, prepared to celebrate his first solemn Mass in his home village. He was 23 years old. From his earliest childhood he had experienced mystical phenomena ‚Äî visions, ecstasies, and battles with demons that left him bruised and bleeding.",a:"Padre Pio: The True Story, C. Bernard Ruffin, Our Sunday Visitor, 1991; revised 2018"},
  {s:"Narrator",t:"Padre Pio later described his inner life in letters to his spiritual director, Padre Benedetto: 'I see myself surrounded by so many enemies. I feel my soul at the mercy of a thousand assaults, each one worse than the last. Yet I know that the Lord will not abandon me, for I am nothing without Him.'",a:"Padre Pio, Letter to Padre Benedetto, c. 1912, in Letters of Padre Pio, vol. I"},
  {s:"Pio",t:"\"I have said my first Mass... I cannot find words to tell you what passed between Jesus and me during this solemn meeting. I felt an extraordinary peace, a peace which I do not know how to express. It seemed to me that time had stopped.\"",a:"Padre Pio, letter to his spiritual director, August 1910"},
  {s:"Objective",t:"Approach the altar in your home chapel. Press PRAY to celebrate your first Mass.",a:""},
],
pio_firstmass_miracle:[
  {s:"Narrator",t:"According to those present, Padre Pio's first Mass lasted far longer than normal ‚Äî he seemed lost in an ecstasy that none could interrupt. His face was transformed. People who attended later said they had never witnessed such an expression of joy and suffering simultaneously on a human face.",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991"},
  {s:"Pio",t:"\"My Mass is not finished at the altar. It continues all day. Every moment of my life is, in a sense, a Mass ‚Äî an offering of everything to God. This is what it means to be a priest: to be consumed by love as Christ was consumed on the Cross.\"",a:"Padre Pio, as recorded by his spiritual director, Agostino of San Marco in Lamis"},
  {s:"Narrator",t:"Padre Pio celebrated Mass every day for over fifty years. Toward the end of his life, his Masses lasted up to five hours. Thousands came to Foggia simply to attend. He offered every Mass not for himself but, as he said, 'for the whole world, for sinners, and for the souls in purgatory.'",a:"C. Bernard Ruffin, Padre Pio: The True Story; Fr. Alessio Parente, Send Me Your Guardian Angel, 1984"},
],
pio_confessional_intro:[
  {s:"Narrator",t:"San Giovanni Rotondo, 1920s‚Äì1960s. Padre Pio's confessional became one of the most sought-after in the world. He heard confessions for fifteen to eighteen hours a day. People waited in line for days ‚Äî sometimes weeks. He was known to read the souls of penitents, naming sins they had not yet confessed or even remembered.",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991"},
  {s:"Narrator",t:"One penitent recalled: 'I had prepared my confession very carefully. But before I said a word, he looked at me and said quietly: You have forgotten something. You have not confessed what you did on the twenty-third of October, nineteen forty-two. And he told me what it was. I had deliberately left it out of shame.'",a:"Testimony of a penitent, recorded in Ruffin, Padre Pio: The True Story, ch. 18"},
  {s:"Penitent",t:"\"Father, I have come a long way. I am not even certain I believe anymore. I came because my wife begged me.\"",a:"Composite of multiple documented testimonies of conversion in the confessional"},
  {s:"Objective",t:"Approach the confessional. Press PRAY to receive Padre Pio's absolution.",a:""},
],
pio_confessional_miracle:[
  {s:"Pio",t:"\"I see your soul as a doctor sees a body. I see the illness ‚Äî and I see the remedy. God puts this knowledge in my heart only so that I can help you find your way back to Him. Not to judge you. To free you.\"",a:"Padre Pio, attributed in multiple conversion testimonies; Ruffin, The True Story"},
  {s:"Narrator",t:"A count who came to mock him left the confessional weeping and converted. An atheist philosopher who came to expose him as a fraud emerged speechless and spent the rest of his life writing in his defense. One woman who had committed a great sin and had not confessed it in forty years left the box and said, 'He already knew.'",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991, ch. 18‚Äì19"},
  {s:"Pio",t:"\"My dearest children, a single soul is worth more than all the riches of this world. Nothing in all of creation is worth the value of a human soul ‚Äî for the soul is destined for eternal union with God. This is why I am here. This is why I suffer. For souls.\"",a:"Padre Pio, quoted in Fr. Alessio Parente, Send Me Your Guardian Angel, 1984"},
  {s:"Narrator",t:"Padre Pio heard an estimated five million confessions during his ministry. The Vatican's Positio super virtutibus states that his knowledge of penitents' souls was regarded as a charism of the Holy Spirit ‚Äî not natural discernment but supernatural illumination.",a:"Positio super virtutibus, Sacred Congregation for the Causes of Saints, 1979"},
],
pio_bilocation_intro:[
  {s:"Narrator",t:"Various dates, 1905‚Äì1968. The phenomenon of bilocation ‚Äî the reported ability to appear in two places simultaneously ‚Äî was documented in Padre Pio's case by multiple independent witnesses across five decades. A 1905 letter from Bishop Damiani of Uruguay described Padre Pio appearing at his bedside in Montevideo while simultaneously being accounted for at the friary in Pietrelcina, Italy.",a:"C. Bernard Ruffin, Padre Pio: The True Story, ch. 14; Alberto D'Apolito, Padre Pio of Pietrelcina: Memories, Experiences, Testimonials, 1978"},
  {s:"Narrator",t:"General Luigi Cadorna, commander of the Italian army, testified that during a moment of suicidal despair during World War I, a brown-robed friar appeared in his tent, spoke to him, and convinced him not to take his life. He later identified the friar as Padre Pio ‚Äî a man he had never met and who was physically hundreds of miles away.",a:"Alberto D'Apolito, Padre Pio of Pietrelcina, 1978; Ruffin, ch. 14"},
  {s:"Pio",t:"\"I cannot explain these things. I go where God sends me. It does not feel like anything unusual to me ‚Äî I simply find myself present where the soul has need of me. God is not bound by space.\"",a:"Padre Pio, in conversation, recorded by Alberto D'Apolito, 1978"},
  {s:"Objective",t:"Kneel at your cell window. Press PRAY to allow God to send you where you are needed.",a:""},
],
pio_bilocation_miracle:[
  {s:"Narrator",t:"A woman in Padua lay dying and desperate. Her family had written to Padre Pio but received no reply. That night, she testified later, a friar in a brown habit appeared at her bedside, placed his wounded hand on her forehead, and whispered: 'Courage. Christ has not abandoned you. You will recover.' She recovered fully.",a:"Testimony compiled in D'Apolito, Padre Pio of Pietrelcina; Ruffin, The True Story, ch. 14"},
  {s:"Narrator",t:"When her daughter later traveled to San Giovanni Rotondo and described the event, Padre Pio said nothing ‚Äî but smiled. He neither confirmed nor denied. When pressed, he simply said: 'Pray and do not ask questions about what God does.'",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991"},
  {s:"Pio",t:"\"Do not weep for those who suffer. Weep only for sinners who refuse God's mercy. Suffering, when united to Christ's Passion, becomes a great grace ‚Äî it is the most intimate sharing in the life of God that a human being can experience this side of death.\"",a:"Padre Pio, letter to a spiritual daughter, recorded in Letters of Padre Pio, vol. II"},
],
pio_cancer_intro:[
  {s:"Narrator",t:"San Giovanni Rotondo, 1949. Giovanni Savino, a construction worker from the village, had suffered a severe accident: an explosion of dynamite had destroyed his right eye and severely damaged his left. Doctors declared him permanently and totally blind. His family brought him to Padre Pio.",a:"Documented case, Vatican Positio; C. Bernard Ruffin, Padre Pio: The True Story"},
  {s:"Savino",t:"\"Padre, they say there is nothing more to be done. I cannot see anything. I am in darkness. I have four children.\"",a:"Giovanni Savino testimony, documented in Vatican Positio"},
  {s:"Pio",t:"He held Savino's face in his wounded hands and prayed silently for a long time. Then he said: \"Do not lose heart. Be ready. Something is about to happen.\"",a:"Giovanni Savino testimony; Ruffin, The True Story"},
  {s:"Objective",t:"Approach Giovanni by the chapel steps. Press PRAY to lay hands on him.",a:""},
],
pio_cancer_miracle:[
  {s:"Narrator",t:"On the night of January 25, 1949, Giovanni Savino woke from sleep screaming ‚Äî not in pain, but in shock. His sight had returned. Medical examination confirmed: the destroyed eye had somehow been restored. There was no medical explanation. The Vatican's Positio includes the documentation of multiple physicians.",a:"Vatican Positio super virtutibus, Sacred Congregation for the Causes of Saints, 1979; Ruffin, ch. 15"},
  {s:"Savino",t:"\"I woke and I could see my wife's face. I could see the window. I could see the crucifix on the wall. I screamed because I thought I was dreaming ‚Äî but I was not dreaming. My eye had been given back to me.\"",a:"Giovanni Savino, testimony in Vatican Positio"},
  {s:"Pio",t:"\"Jesus does not need our medicine or our surgery. He needs only our faith. But we must never mistake faith for magic. Faith is not a claim on God ‚Äî it is surrender to God. It is saying: Whatever You will. And sometimes, what God wills is a miracle.\"",a:"Padre Pio, from conversations recorded by Fr. Alessio Parente"},
  {s:"Narrator",t:"Padre Pio was known to say: 'I am nothing. I am only a poor friar who prays.' Yet at his canonisation, Pope John Paul II said: 'The holiness of Padre Pio was above all measured by his extraordinary closeness to the cross, which he carried not as a burden but as a gift.'",a:"Pope John Paul II, Homily at Canonisation of Padre Pio, St. Peter's Square, June 16, 2002"},
],
pio_fragrance_intro:[
  {s:"Narrator",t:"Throughout his life, those who encountered Padre Pio ‚Äî in person, near his cell, or even after receiving a letter from him ‚Äî reported an inexplicable fragrance: the scent of roses, violets, incense, or fresh tobacco. It appeared and vanished without cause, sometimes preceding him into a room, sometimes lingering after he left.",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991; Alberto D'Apolito, Padre Pio of Pietrelcina"},
  {s:"Narrator",t:"Investigators sent by the Vatican to assess these phenomena ‚Äî including the hostile canonical inspector Monsignor Rossi in 1921 ‚Äî could not explain them. One theologian, Monsignor De Rossi, wrote in his report: 'The fragrance is real. It cannot be attributed to any natural perfume. It appears without any predictable cause and vanishes instantly.'",a:"Canonical investigation report, 1921; summarized in Ruffin, The True Story, ch. 8"},
  {s:"Soldier",t:"\"I was in the trenches in the First World War. Mud. Death. The smell of gunpowder and rot. And then ‚Äî suddenly ‚Äî I smelled roses. Just for a moment. I had never smelled anything so clean in my life. The man next to me smelled it too. We looked at each other. Neither of us spoke.\"",a:"Testimony of a soldier, recorded in D'Apolito, Padre Pio of Pietrelcina, 1978"},
  {s:"Objective",t:"Stand near Padre Pio's cell window at dawn. Press PRAY to experience the fragrance of grace.",a:""},
],
pio_fragrance_miracle:[
  {s:"Narrator",t:"Padre Pio spoke of the fragrance himself only reluctantly. He called it a 'grace-scent' ‚Äî a sign that his prayer was being heard by God and transmitted to the person in need. He sometimes told those who were ill: 'When you smell roses tonight, know that I am praying for you.'",a:"Alberto D'Apolito, Padre Pio of Pietrelcina: Memories, Experiences, Testimonials, 1978"},
  {s:"Pio",t:"\"Prayer is the best weapon we possess. It is the key that opens the heart of God. And God, when He opens His heart, sometimes leaves His fragrance on the threshold ‚Äî just as a flower, when opened, perfumes the room.\"",a:"Padre Pio, from letters and conversations; D'Apolito, 1978"},
  {s:"Narrator",t:"Maria Pyle, an American woman who lived near the friary for decades, wrote in her diary: 'Today again the perfume came ‚Äî at three in the morning. It filled my room for ten minutes and then was gone. Padre says nothing when I ask. He only smiles and says: Go to sleep, Maria.'",a:"Diary of Maria Pyle, c. 1940s; quoted in Ruffin, Padre Pio: The True Story"},
  {s:"Pio",t:"\"There is no soul who prays sincerely and is not heard. Prayer always reaches God. But God answers in His own time and in His own way ‚Äî not always as we wish, but always better than we could have imagined.\"",a:"Padre Pio, letter to Raffaelina Cerase, 1914, Letters of Padre Pio, vol. I"},
],
pio_agony_intro:[
  {s:"Narrator",t:"San Giovanni Rotondo, September 22‚Äì23, 1968. The day before he died, Padre Pio celebrated what would be his final Mass. It lasted two hours. He could barely stand. His stigmata wounds ‚Äî which had bled every day for fifty years ‚Äî had that morning completely healed and disappeared. His skin was clean.",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991, final chapters"},
  {s:"Narrator",t:"A witness wrote: 'He was so pale. So consumed. As though the fire of God had burned through the wood and only the flame remained. His hands were smooth ‚Äî the wounds gone. I understood that his work was finished. The offering was complete.'",a:"Testimony of a friar at San Giovanni Rotondo, September 1968; Ruffin, The True Story"},
  {s:"Pio",t:"\"I see two mothers. One is my own dear mother ‚Äî Maria Giuseppa. And the other is the Madonna.\" His last coherent words were spoken in confession: 'Jesus... Mary.'",a:"Last words of Padre Pio, September 23, 1968; recorded by attending friars, Ruffin, The True Story"},
  {s:"Objective",t:"Kneel beside Padre Pio's chair in the sacristy. Press PRAY to be present at the end.",a:""},
],
pio_agony_miracle:[
  {s:"Narrator",t:"Padre Pio died at 2:30 in the morning on September 23, 1968. He was eighty-one years old. He had spent fifty years carrying the wounds of Christ, hearing five million confessions, and building the Casa Sollievo della Sofferenza ‚Äî the House for the Relief of Suffering ‚Äî now one of Italy's largest hospitals.",a:"C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991"},
  {s:"Friar",t:"\"When he died, his face was like marble ‚Äî perfectly peaceful. The agony was over. His hands, which for fifty years had bled every Friday, were completely healed. The whole friary was full of silence and peace. Someone said: 'He is still praying. He has just changed rooms.'\"",a:"Testimony of a friar; C. Bernard Ruffin, Padre Pio: The True Story"},
  {s:"Pio",t:"\"After my death, I will do much more than I have done in this life. My real mission will begin when I die. I can do more for you from heaven than I could do for you here on earth.\"",a:"Padre Pio, to his spiritual daughters; recorded in Fr. Alessio Parente, Send Me Your Guardian Angel, 1984"},
  {s:"Narrator",t:"Over one hundred thousand people attended Padre Pio's funeral. Pope Paul VI later said of him: 'Look at what fame he had! What a worldwide following gathered around him! And why? Because he was a philosopher? Because he was wise? Because he had resources at his disposal? No ‚Äî because he said Mass humbly, heard confessions from morning until evening, and was ‚Äî it is not easy to say it ‚Äî a man of prayer and suffering.'",a:"Pope Paul VI, General Audience, February 20, 1971"},
],
}; /* ‚îÄ‚îÄ END DLG ‚îÄ‚îÄ */

/* ‚îÄ‚îÄ‚îÄ CUTSCENE DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
var CF=[
  {art:'‚õ™',title:'Stage I ‚Äî Young Francis of Assisi',text:'"He was a lover of music, and would often lead his companions through the streets at night singing songs. His manner was gentle, his liberality boundless, his bearing that of a prince... and yet, in the midst of all his joy, something was wanting."\n\n‚Äî Thomas of Celano, Vita Prima Sancti Francisci, c. 1228',key:'assisi',intro:'assisi_welcome'},
  {art:'üèó',title:'Stage II ‚Äî Rebuild My Church',text:'"Francis heard a voice from the crucifix saying: Go and repair my house, which, as you see, is falling into ruins. At this, Francis trembled and was greatly astonished."\n\n‚Äî Three Companions, Legenda Trium Sociorum, c. 1241',key:'sanDamiano',intro:'repair_intro'},
  {art:'üïä',title:'Stage III ‚Äî Preach to the Birds',text:'"Brother Francis left his companions on the road and ran eagerly towards the birds. And when he came close to them they did not fly away, but stayed to hear his sermon."\n\n‚Äî Thomas of Celano, Vita Prima, Ch. LVIII',key:'birds',intro:'birds_intro'},
  {art:'üê∫',title:'Stage IV ‚Äî The Wolf of Gubbio',text:'"This terrible wolf had not only devoured animals, but had attacked human beings. Saint Francis, having compassion on the people, decided to go out to the wolf."\n\n‚Äî The Little Flowers of St. Francis, Ch. XXI, 14th century',key:'wolf',intro:'wolf_intro'},
  {art:'‚õ∞',title:'Stage V ‚Äî The Holy Stigmata',text:'"The marks of the nails began to appear in his hands and feet, as he had seen them in the figure of the man crucified, pierced through the middle with nails."\n\n‚Äî Thomas of Celano, Vita Prima, Ch. III, c. 1228',key:'laverna',intro:'stigmata_intro'},
  {art:'‚òÄ',title:'Finale ‚Äî The Canticle of the Sun',text:'"In the beginning of his conversion Francis had a great tenderness for lepers. He came upon a leper one day and kissed his hand. When Francis looked back, he could see no one at all."\n\n‚Äî St. Bonaventure, Major Life of St. Francis, Ch. I, 1263',key:'canticle',intro:'canticle_scene'},
];
var CA=[
  {art:'üêü',title:'St. Anthony ‚Äî I. The Sermon to the Fish',text:'"Anthony turned to the sea and began to speak. Immediately a great multitude of fish came to the bank ‚Äî great ones and small and middle-sized ‚Äî and held their heads above the water in great peace and tranquillity, their mouths above the surface, gazing attentively at Anthony\'s face."\n\n‚Äî The Little Flowers of St. Francis, Ch. XL, 14th century',key:'anthony_fish',intro:'anthony_fish_intro'},
  {art:'üë∂',title:'St. Anthony ‚Äî II. The Christ Child Vision',text:'"The nobleman saw the blessed Anthony holding in his arms a child of marvellous beauty. The child was lovingly embracing Anthony\'s neck, and Anthony was holding the child with the greatest joy and delight. The nobleman called his wife, and together they beheld the vision until dawn."\n\n‚Äî Fra Rigaldo de Reggio, Life of St. Anthony, c. 1232',key:'anthony_child',intro:'anthony_child_intro'},
  {art:'üê¥',title:'St. Anthony ‚Äî III. The Miracle of the Mule',text:'"Anthony accepted the challenge of the heretic who denied the Real Presence: that his starving mule, driven by three days of hunger, would choose oats over the Eucharist. Every eye was fixed on the animal. It walked past the oats. It knelt before the monstrance."\n\n‚Äî Liber Miraculorum, 13th century; John Moorman, A History of the Franciscan Order, 1968',key:'anthony_mule',intro:'anthony_mule_intro'},
  {art:'‚öñ',title:'St. Anthony ‚Äî IV. The Raising of the Dead',text:'"Anthony\'s father stood accused of murder. A man lay dead in Lisbon. Anthony prayed ‚Äî and according to witnesses on both sides of the Alps, appeared simultaneously in Italy and in Portugal. The dead man spoke. The innocent man went free."\n\n‚Äî Assidua, the first biography of St. Anthony, c. 1232',key:'anthony_raise',intro:'anthony_raise_intro'},
  {art:'üïä',title:'St. Anthony ‚Äî V. The Great Lenten Sermons of Padua',text:'"Thirty thousand people came to hear him preach. The courts suspended their hearings. The markets closed. People slept in the squares overnight to secure a place. He was a small, unremarkable man ‚Äî yet his voice carried across the entire field."\n\n‚Äî Chronicle of Padua, c. 1231; John Moorman, A History of the Franciscan Order, Oxford, 1968',key:'anthony_padua',intro:'anthony_padua_intro'},
];
var CC=[
  {art:'üïØ',title:'St. Clare ‚Äî Repelling the Saracens',text:'"Clare had herself carried to the door, and commanded that the pyx containing the Body of Christ be brought. Prostrating herself before the Lord, she prayed. A voice like a child\'s was heard: I will always protect you."\n\n‚Äî Acts of the Process of Canonization of St. Clare, 1253',key:'clare_saracen',intro:'clare_saracen_intro'},
  {art:'üåü',title:'St. Clare ‚Äî The Christmas Vision',text:'"The entire ceremony of the church appeared to her sight. She saw the manger of the Lord, the crib, the holy child wrapped in swaddling cloths, and the friars singing their praises."\n\n‚Äî Thomas of Celano, Life of St. Clare, c. 1255',key:'clare_christmas',intro:'clare_christmas_intro'},
];
var CB=[
  {art:'üìñ',title:'St. Bonaventure ‚Äî The Mystical Vision',text:'"Stirred by the example of our most blessed father Francis, I was seeking this peace with panting soul. Then, struck with wonder at the manner of so high a contemplation, I wrote this book."\n\n‚Äî St. Bonaventure, Itinerarium Mentis in Deum, Prologue, 1259',key:'bonaventure',intro:'bona_vision_intro'},
];
var CPio=[
  {art:'‚õ™',title:'Padre Pio ‚Äî I. The First Solemn Mass',text:'"I cannot find words to tell you what passed between Jesus and me during this solemn meeting. It seemed that time had stopped. I felt a peace so profound, a joy so complete, that I wished never to return from it."\n\n‚Äî Padre Pio, letter to his spiritual director, August 10, 1910',key:'pio_firstmass',intro:'pio_firstmass_intro'},
  {art:'üôè',title:'Padre Pio ‚Äî II. The Permanent Stigmata',text:'"On the morning of September 20, 1918, while Padre Pio was making his thanksgiving after Mass, he fell into a prolonged ecstasy. When he came to himself, he saw that his hands, feet, and side were pierced and bleeding ‚Äî the five wounds of the Passion of Christ, which would remain visible and painful for the next fifty years."\n\n‚Äî C. Bernard Ruffin, Padre Pio: The True Story, Our Sunday Visitor, 1991',key:'pio_stigmata',intro:'pio_stigmata_intro'},
  {art:'üïØ',title:'Padre Pio ‚Äî III. The Ministry of the Confessional',text:'"He heard confessions for fifteen to eighteen hours a day. He was known to name sins that penitents had not yet spoken ‚Äî sins hidden in shame for decades. One by one, they came away weeping. One by one, they came away free."\n\n‚Äî C. Bernard Ruffin, Padre Pio: The True Story; Vatican Positio super virtutibus, 1979',key:'pio_confessional',intro:'pio_confessional_intro'},
  {art:'‚úà',title:'Padre Pio ‚Äî IV. The Gift of Bilocation',text:'"General Luigi Cadorna testified that a Franciscan friar appeared in his command tent during the darkest night of the Great War and turned him from the brink of suicide. He later identified this friar as Padre Pio ‚Äî a man he had never met, who was physically hundreds of miles away."\n\n‚Äî Alberto D\'Apolito, Padre Pio of Pietrelcina: Memories, Experiences, Testimonials, 1978',key:'pio_bilocation',intro:'pio_bilocation_intro'},
  {art:'üëÅ',title:'Padre Pio ‚Äî V. The Healing of the Blind',text:'"Gemma di Giorgi was born without pupils ‚Äî confirmed by every physician who examined her. He prayed over her eyes with his wounded hands. She saw. The Vatican\'s formal inquiry could offer no medical explanation."\n\n‚Äî Testimony of Gemma di Giorgi, Vatican deposition, 1995',key:'pio_healing',intro:'pio_healing_intro'},
  {art:'‚úã',title:'Padre Pio ‚Äî VI. The Restoration of Sight',text:'"Giovanni Savino was declared permanently and totally blind after a dynamite explosion destroyed his right eye. He was brought to Padre Pio. On the night of January 25, 1949, he woke screaming ‚Äî not in pain, but in awe. His eye had been restored. Multiple physicians confirmed what they could not explain."\n\n‚Äî Vatican Positio super virtutibus, 1979; C. Bernard Ruffin, Padre Pio: The True Story',key:'pio_cancer',intro:'pio_cancer_intro'},
  {art:'üåπ',title:'Padre Pio ‚Äî VII. The Fragrance of Grace',text:'"Those who received his letters, those who stood near his confessional, those who had never met him but prayed to him in distant countries ‚Äî all reported the same thing: an inexplicable fragrance of roses, violets, or incense, appearing without cause and vanishing without explanation."\n\n‚Äî Alberto D\'Apolito, Padre Pio of Pietrelcina, 1978; Ruffin, The True Story',key:'pio_fragrance',intro:'pio_fragrance_intro'},
  {art:'üïä',title:'Padre Pio ‚Äî VIII. The Holy Death',text:'"The day before he died, his stigmata wounds ‚Äî which had bled every day for fifty years ‚Äî were found to be completely healed. His skin was clean and smooth. Those who witnessed it understood: the offering was complete. The sacrifice was finished. He died on September 23, 1968, whispering the names of Jesus and Mary."\n\n‚Äî C. Bernard Ruffin, Padre Pio: The True Story, final chapters',key:'pio_agony',intro:'pio_agony_intro'},
];
var CEliz=[
  {art:'üåπ',title:'St. Elizabeth ‚Äî The Miracle of the Roses',text:'"Elizabeth had been secretly distributing food to the poor. Her husband Ludwig stopped her at the castle gate and demanded to see what she carried. When he opened her cloak, he found only roses ‚Äî beautiful, fragrant roses in the dead of winter."\n\n‚Äî Life of St. Elizabeth, Dietrich von Apolda, c. 1289',key:'elizabeth_roses',intro:'elizabeth_roses_intro'},
  {art:'‚úù',title:'St. Elizabeth ‚Äî The Leper in the Bed',text:'"Elizabeth laid a grievously ill leper in her own marital bed. When her husband entered in fury and pulled back the covers, he did not see a leper ‚Äî he saw the face of Christ crucified, shining with unearthly light."\n\n‚Äî Thomas of Celano, Life of St. Elizabeth, c. 1232',key:'elizabeth_leper',intro:'elizabeth_leper_intro'},
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   THREE.JS CORE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initRenderer(){
  var cv=document.getElementById('gameCanvas');
  try{
    G.renderer=new THREE.WebGLRenderer({canvas:cv,antialias:true,powerPreference:'high-performance',precision:'highp',logarithmicDepthBuffer:false});
  }catch(e){
    try{G.renderer=new THREE.WebGLRenderer({canvas:cv,antialias:false});}
    catch(e2){console.error('WebGL not supported:',e2);return;}
  }
  G.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
  G.renderer.shadowMap.enabled=true;
  G.renderer.shadowMap.type=THREE.PCFSoftShadowMap;
  G.renderer.outputEncoding=THREE.sRGBEncoding;
  G.renderer.toneMapping=THREE.ACESFilmicToneMapping;
  G.renderer.toneMappingExposure=1.15;
  G.renderer.physicallyCorrectLights=true;
  G.scene=new THREE.Scene();
  G.camera=new THREE.PerspectiveCamera(62,1,0.1,400);
  doResize();
  try{new ResizeObserver(doResize).observe(document.body);}catch(e){}
  window.addEventListener('resize',doResize);
  window.addEventListener('orientationchange',function(){setTimeout(doResize,250);});
}
function doResize(){
  var w=window.innerWidth,h=window.innerHeight;
  if(!w||!h||!G.renderer)return;
  G.renderer.setSize(w,h,false);
  var cv=document.getElementById('gameCanvas');
  cv.style.width=w+'px';cv.style.height=h+'px';
  if(G.camera){G.camera.aspect=w/h;G.camera.updateProjectionMatrix();}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCENE HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function tagObj(o){o.userData._s=true;return o;}
function addS(o){tagObj(o);G.scene.add(o);if(o.isLight&&o.userData&&o.userData.glow)G.glowLights.push(o);return o;}
function clearStage(){
  if(G._typeTimer){clearInterval(G._typeTimer);G._typeTimer=null;}
  var rm=[];G.scene.traverse(function(o){if(o.userData&&o.userData._s)rm.push(o);});
  for(var i=0;i<rm.length;i++)G.scene.remove(rm[i]);
  G.interactables=[];G.churchPieces=[];G.fixedPieces=0;G.birds=[];G.particles3D=[];
  G.wolfGroup=null;G.wolfTail=null;G.wolfEyes=[];G.wolfTamed=false;
  G.birdsDone=false;G.stigmataDone=false;G.glowLights=[];G.totalPieces=0;G.ramps=[];G.py=0;G.walls=[];G.fishSpawned=false;
  G.childAppeared=false;G.saracensFled=false;G.christmasVision=false;G.bookDone=false;
  G.anthonyMuleDone=false;G.anthonyRaiseDone=false;G.anthonyPaduaDone=false;
  G.pioStigDone=false;G.pioFirstMassDone=false;G.pioConfessionalDone=false;
  G.pioBilocationDone=false;G.pioHealDone=false;G.pioCancerDone=false;
  G.pioFragranceDone=false;G.pioAgonyDone=false;
  G.elizRosesDone=false;G.elizLeperDone=false;
  G.nearTarget=null;G.rosaries=[];G.groundPeople=[];
  G.jesusGroup=null;G.holyGroup=null;G.godGroup=null;G.inHeaven=false;
}
function mkMat(c,ec,ei){var m=new THREE.MeshLambertMaterial({color:c});if(ec!=null){m.emissive=new THREE.Color(ec);m.emissiveIntensity=ei||0.6;}return m;}
function mkMatR(c,rough,metal,ec,ei){var m=new THREE.MeshStandardMaterial({color:c,roughness:rough!==undefined?rough:0.82,metalness:metal||0.05});if(ec!=null){m.emissive=new THREE.Color(ec);m.emissiveIntensity=ei||0.5;}return m;}
function mkMatStd(c,rough,metal){return new THREE.MeshStandardMaterial({color:c,roughness:rough||0.85,metalness:metal||0.05});}
function mkBox(w,h,d,c,x,y,z){var m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mkMat(c));m.position.set(x,y,z);m.castShadow=m.receiveShadow=true;return addS(m);}
function mkCone(r,h,s,c,x,y,z){var m=new THREE.Mesh(new THREE.ConeGeometry(r,h,s),mkMat(c));m.position.set(x,y,z);m.castShadow=true;return addS(m);}
function mkSph(r,ws,hs,c,x,y,z){var m=new THREE.Mesh(new THREE.SphereGeometry(r,ws,hs),mkMat(c));m.position.set(x,y,z);m.castShadow=true;return addS(m);}
function mkGnd(c,w,d){var m=new THREE.Mesh(new THREE.PlaneGeometry(w||90,d||90,16,16),mkMat(c));m.rotation.x=-Math.PI/2;m.receiveShadow=true;return addS(m);}
function mkAmb(c,i){return addS(new THREE.AmbientLight(c,i));}
function mkDir(c,i,px,py,pz){var l=new THREE.DirectionalLight(c,i);l.position.set(px,py,pz);l.castShadow=true;l.shadow.mapSize.set(2048,2048);l.shadow.camera.near=0.5;l.shadow.camera.far=250;l.shadow.camera.left=-50;l.shadow.camera.right=50;l.shadow.camera.top=50;l.shadow.camera.bottom=-50;l.shadow.bias=-0.0003;return addS(l);}
function mkFog(c,n,f){G.scene.background=new THREE.Color(c);G.scene.fog=new THREE.Fog(c,n,f);}
function mkHemi(sky,gnd,i){return addS(new THREE.HemisphereLight(sky,gnd,i||0.35));}
function mkNPC(c,x,y,z){addWall(x,z,.52); // NPC collision
  var g=new THREE.Group();
  var body=new THREE.Mesh(new THREE.CylinderGeometry(.3,.45,1.18,9),mkMat(c));body.position.y=.59;body.castShadow=true;body.receiveShadow=true;
  var head=new THREE.Mesh(new THREE.SphereGeometry(.28,12,9),mkMat(0xDEB887));head.position.y=1.38;head.castShadow=true;
  // Hair hint
  var hair=new THREE.Mesh(new THREE.SphereGeometry(.3,9,5,0,Math.PI*2,0,Math.PI*.45),mkMat(0x4a2a08));hair.position.y=1.48;g.add(hair);
  var armL=new THREE.Mesh(new THREE.CylinderGeometry(.1,.11,.68,7),mkMat(c));armL.position.set(-.44,.88,.0);armL.rotation.z=.3;armL.castShadow=true;
  var armR=armL.clone();armR.position.set(.44,.88,.0);armR.rotation.z=-.3;
  // Feet
  var fL=new THREE.Mesh(new THREE.BoxGeometry(.2,.09,.28),mkMat(0x6a4020));fL.position.set(-.12,.05,.1);
  var fR=fL.clone();fR.position.set(.12,.05,.1);
  g.add(body,head,armL,armR,fL,fR);
  g.userData.armL=armL;g.userData.armR=armR;
  g.position.set(x,y,z);g.castShadow=true;return addS(g);
}
function mkGlowBox(w,h,d,c,ec,ei,x,y,z){var m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mkMat(c,ec,ei));m.position.set(x,y,z);return addS(m);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PLAYER (GROUND)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function createPlayer(){
  if(G.playerGroup)G.scene.remove(G.playerGroup);
  var g=new THREE.Group();
  // Habit (robe) ‚Äî tapered, Franciscan brown
  var body=new THREE.Mesh(new THREE.CylinderGeometry(.36,.56,1.35,10),mkMat(0x7B4E28));body.position.y=.675;body.castShadow=true;body.receiveShadow=true;g.add(body);
  // Underskirt hem
  var hem=new THREE.Mesh(new THREE.CylinderGeometry(.56,.62,.12,10),mkMat(0x6B4020));hem.position.y=.06;g.add(hem);
  // Head
  var head=new THREE.Mesh(new THREE.SphereGeometry(.3,12,10),mkMat(0xDBA880));head.position.y=1.62;head.castShadow=true;g.add(head);
  // Tonsure circle (top of head, lighter skin)
  var tonsure=new THREE.Mesh(new THREE.CircleGeometry(.14,10),new THREE.MeshLambertMaterial({color:0xc8906a}));tonsure.rotation.x=-Math.PI/2;tonsure.position.set(0,1.92,0);g.add(tonsure);
  // Hood (capuche) over back
  var hood=new THREE.Mesh(new THREE.SphereGeometry(.33,10,6,0,Math.PI*2,0,Math.PI*.55),mkMat(0x6B3E18));hood.position.y=1.72;hood.rotation.x=.15;g.add(hood);
  // Rope belt (knotted cord ‚Äî symbol of the three vows)
  var belt=new THREE.Mesh(new THREE.TorusGeometry(.41,.045,8,20),mkMat(0xF5E8C0));belt.rotation.x=Math.PI/2;belt.position.y=.58;g.add(belt);
  // Three knots on rope belt (poverty, chastity, obedience)
  for(var k=0;k<3;k++){
    var kn=new THREE.Mesh(new THREE.SphereGeometry(.07,5,4),mkMat(0xE8D5A0));
    var ka=(k/3)*Math.PI*.8-Math.PI*.2;kn.position.set(Math.cos(ka)*.41,.5,Math.sin(ka)*.41);g.add(kn);
  }
  // Arms
  var armL=new THREE.Mesh(new THREE.CylinderGeometry(.1,.12,.65,7),mkMat(0x7B4E28));armL.position.set(-.42,.9,.0);armL.rotation.z=.28;g.add(armL);
  var armR=armL.clone();armR.position.set(.42,.9,.0);armR.rotation.z=-.28;g.add(armR);
  // Sandalled feet hints
  var fL=new THREE.Mesh(new THREE.BoxGeometry(.22,.1,.32),mkMat(0x5a3818));fL.position.set(-.14,.05,.08);g.add(fL);
  var fR=fL.clone();fR.position.set(.14,.05,.08);g.add(fR);
  // Halo ‚Äî golden, glowing
  var haloMat=new THREE.MeshLambertMaterial({color:0xFFD700,emissive:new THREE.Color(0xFFCC00),emissiveIntensity:1.1,transparent:true,opacity:.88});
  var halo=new THREE.Mesh(new THREE.TorusGeometry(.41,.04,7,28),haloMat);halo.position.y=1.98;g.add(halo);
  var haloLight=new THREE.PointLight(0xffd700,.7,4);haloLight.position.y=2;g.add(haloLight);
  G.playerGroup=g;G.scene.add(g);setPos(0,0);
}
function setPos(x,z){G.px=x;G.pz=z;G.py=getGroundY?getGroundY(x,z):0;if(G.playerGroup)G.playerGroup.position.set(x,G.py,z);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FLYING PLAYER (FLIGHT SIM)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function createFlyPlayer(){
  if(G.flyGroup){G.scene.remove(G.flyGroup);G.flyGroup=null;}
  var g=new THREE.Group();
  // Robe
  var body=new THREE.Mesh(new THREE.CylinderGeometry(.32,.46,1.2,6),mkMat(0x6B4226));body.position.y=0;g.add(body);
  var head=new THREE.Mesh(new THREE.SphereGeometry(.28,6,5),mkMat(0xDEB887));head.position.y=.88;g.add(head);
  var haloM=new THREE.MeshLambertMaterial({color:0xFFD700,emissive:new THREE.Color(0xFFD700),emissiveIntensity:.7});
  var halo=new THREE.Mesh(new THREE.TorusGeometry(.34,.04,4,12),haloM);halo.position.y=1.15;g.add(halo);
  // Wings ‚Äî pivot group so we can rotate them
  var wL=new THREE.Group();wL.position.set(-.5,0.2,0);
  var wLm=new THREE.Mesh(new THREE.ConeGeometry(.2,1.8,4),mkMat(0xffffff));wLm.rotation.z=Math.PI*.6;wLm.position.set(-.7,0,0);
  wL.add(wLm);g.add(wL);G.wingMeshL=wL;
  var wR=new THREE.Group();wR.position.set(.5,0.2,0);
  var wRm=new THREE.Mesh(new THREE.ConeGeometry(.2,1.8,4),mkMat(0xffffff));wRm.rotation.z=-Math.PI*.6;wRm.position.set(.7,0,0);
  wR.add(wRm);g.add(wR);G.wingMeshR=wR;
  G.flyGroup=g;
  G.scene.add(g);
  G.flyX=0;G.flyY=22;G.flyZ=50;G.flyYaw=Math.PI; // face toward people
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STAGE MANAGEMENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadFrancisStage(idx){
  G.stageIndex=idx;var cut=CF[idx];
  if(!cut){showFrancisEnd();return;}
  hideHUD();G.dlgActive=false;
  elHide('dialogueBox');elHide('interactPrompt');
  showCutscene(cut,function(){
    clearStage();createPlayer();
    if(cut.key==='assisi')bAssisi();
    else if(cut.key==='sanDamiano')bSanDamiano();
    else if(cut.key==='birds')bBirds();
    else if(cut.key==='wolf')bWolf();
    else if(cut.key==='laverna')bLaVerna();
    else if(cut.key==='canticle')bCanticle();
    showHUD(cut.title);
    if(cut.intro&&DLG[cut.intro])showDlg(DLG[cut.intro]);
  });
}
function advFrancis(){G.dlgActive=false;elHide('dialogueBox');loadFrancisStage(G.stageIndex+1);}

function advSaint(cuts,doneFn){G.dlgActive=false;elHide('dialogueBox');loadSaintStage(cuts,G.stageIndex+1,doneFn);}

/* ‚îÄ‚îÄ‚îÄ UNIFIED STAGE LOADER (all 5 saints) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function loadSaintStage(cuts,idx,doneFn){
  G.stageIndex=idx;var cut=cuts[idx];
  if(!cut){if(doneFn)doneFn();return;}
  hideHUD();G.dlgActive=false;elHide('dialogueBox');elHide('interactPrompt');
  showCutscene(cut,function(){
    clearStage();createPlayer();
    if(cut.key==='anthony_fish')bAnthonyFish();
    else if(cut.key==='anthony_child')bAnthonyChild();
    else if(cut.key==='anthony_mule')bAnthonyMule();
    else if(cut.key==='anthony_raise')bAnthonyRaise();
    else if(cut.key==='anthony_padua')bAnthonyPadua();
    else if(cut.key==='clare_saracen')bClareSaracen();
    else if(cut.key==='clare_christmas')bClareChristmas();
    else if(cut.key==='bonaventure')bBonaventure();
    else if(cut.key==='pio_stigmata')bPioStigmata();
    else if(cut.key==='pio_firstmass')bPioFirstMass();
    else if(cut.key==='pio_confessional')bPioConfessional();
    else if(cut.key==='pio_bilocation')bPioBilocation();
    else if(cut.key==='pio_healing')bPioHealing();
    else if(cut.key==='pio_cancer')bPioCancer();
    else if(cut.key==='pio_fragrance')bPioFragrance();
    else if(cut.key==='pio_agony')bPioAgony();
    else if(cut.key==='elizabeth_roses')bElizRoses();
    else if(cut.key==='elizabeth_leper')bElizLeper();
    showHUD(cut.title);
    if(cut.intro&&DLG[cut.intro])showDlg(DLG[cut.intro]);
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚îÄ‚îÄ FRANCIS STAGES ‚îÄ‚îÄ
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function bAssisi(){
  // Assisi, Umbria ‚Äî morning, c. 1205. Francis in his mid-twenties.
  mkFog(0x87ceeb,50,140);
  mkAmb(0xfff8e0,.7);mkHemi(0x88bbff,0x3a7a3a,.45);mkDir(0xfff0cc,1.6,20,40,14);
  var fill=new THREE.DirectionalLight(0x99ccff,.4);fill.position.set(-16,24,-6);addS(fill);
  mkGnd(0x5a8a3a,130,130);

  // ‚îÄ‚îÄ Umbrian hills ‚îÄ‚îÄ
  for(var h=0;h<10;h++){
    var ha=(h/10)*Math.PI*2,hr=40+Math.random()*14,hh=8+Math.random()*10;
    mkSph(hr,8,6,0x3d7a3a,Math.cos(ha)*hr,hh-hr+2,Math.sin(ha)*hr-8);
  }

  // ‚îÄ‚îÄ Piazza del Comune ‚îÄ‚îÄ
  var piazzaMat=new THREE.MeshLambertMaterial({color:0xc8b898});
  var piazza=new THREE.Mesh(new THREE.BoxGeometry(22,0.14,18),piazzaMat);piazza.position.set(0,.07,-10);addS(piazza);
  for(var pc=0;pc<4;pc++){var pcx=pc<2?-11:11;mkBox(.4,.25,18,0xb0a080,pcx,.14,-10);}

  // ‚îÄ‚îÄ Temple of Minerva ‚îÄ‚îÄ
  for(var col=0;col<6;col++){
    var cx=-7.5+col*3;
    mkBox(.55,8,.55,0xe8dcc0,cx,4,-22);
    mkBox(.9,.5,.9,0xddd0b0,cx,8.3,-22);
    mkBox(.7,.35,.7,0xddd0b0,cx,.18,-22);
    addWall(cx,-22,.55); // ‚Üê column collision (each column individually)
  }
  mkBox(18,1.2,.8,0xe0d4b0,0,8.8,-22);
  mkBox(16,4,.7,0xddd0b0,0,11.6,-22);
  mkBox(16,.4,.7,0xeee0c0,0,13.7,-22);
  mkBox(17,10,1.5,0xd8ccaa,0,5,-23.2);
  addWallLine(-9,-23.5,9,-23.5,1.0); // temple back wall
  mkBox(3.5,5.5,1,0x4a3520,0,2.75,-22.5);
  mkBox(3.5,.5,1,0xc0a870,0,5.52,-22.5);
  // Steps up to temple ‚Äî 4 wide steps
  for(var ts=0;ts<4;ts++) mkBox(20,.3,1.4,0xccc0a0,0,.15+ts*.32,-18+ts*1.4);
  addRamp(0,-18,0,-12.4,0,1.28,10);
  addRamp(0,-12.4,0,-24,1.28,1.28,8);
  var tglow=new THREE.PointLight(0xfff8cc,.9,28);tglow.position.set(0,10,-22);addS(tglow);

  // ‚îÄ‚îÄ Torre del Popolo ‚îÄ‚îÄ
  mkBox(4,20,4,0xc4b490,10,10,-18);
  mkBox(5,.8,5,0xb4a480,10,20.4,-18);
  for(var batt=0;batt<4;batt++){var bx=batt<2?9:11,bz2=batt%2===0?-17:-19;mkBox(1.4,1.8,1.4,0xb0a075,bx,21.5,bz2);}
  mkBox(1,.5,1,0xffee88,10,21.5,-18);
  addWall(10,-18,2.6); // ‚Üê tower collision
  var towerGlow=new THREE.PointLight(0xffcc44,.7,18);towerGlow.position.set(10,18,-18);towerGlow.userData.glow=true;addS(towerGlow);

  // ‚îÄ‚îÄ Palazzo del Capitano del Popolo ‚îÄ‚îÄ
  mkBox(9,7,5,0xd0c098,-12,3.5,-16);mkBox(9,1.8,5,0x9a3a2a,-12,7.5,-16);
  for(var arw=0;arw<3;arw++){mkBox(1.4,2.2,.3,0x7799bb,-15+arw*3,5,-13);mkBox(1.8,.3,.3,0x7799bb,-15+arw*3,7.1,-13);}
  mkBox(9.5,.6,5.5,0xc0b088,-12,7.15,-16);
  addWallLine(-16.5,-13,-7.5,-13,1.2); // ‚Üê palazzo front face
  addWallLine(-16.5,-18.5,-7.5,-18.5,1.2); // ‚Üê palazzo back

  // ‚îÄ‚îÄ Row of medieval houses ‚Äî east side ‚îÄ‚îÄ
  var houseH=[6,8,5,7,9,6];
  for(var hh2=0;hh2<6;hh2++){
    var hhx=-22+hh2*3.5,hhz=-14-hh2*.8; // deterministic z (no random)
    mkBox(3,houseH[hh2],3,0xc8b888+hh2*0x020100,hhx,houseH[hh2]/2,hhz);
    mkBox(3.3,.6,3.3,0xa09060,hhx,houseH[hh2]+.3,hhz);
    mkBox(1,.8,.3,0x6688aa,hhx,houseH[hh2]*.55,hhz-1.4);
    addWall(hhx,hhz,2.0); // ‚Üê house collision
  }

  // ‚îÄ‚îÄ Via San Francesco cobblestones ‚îÄ‚îÄ
  for(var cs=0;cs<20;cs++){
    var csz=-cs*1.8+6;
    mkBox(5+Math.random()*.5,.06+Math.random()*.04,1.5,0xaaa090+(cs%3)*8,0,.03+Math.random()*.02,csz);
  }
  mkBox(.3,.12,38,0x887766,-2.6,.06,-12);
  mkBox(.3,.12,38,0x887766,2.6,.06,-12);

  // ‚îÄ‚îÄ Fountain ‚îÄ‚îÄ
  mkBox(2,.5,2,0xbbaa88,6,.25,-8);
  var fMat=new THREE.MeshLambertMaterial({color:0x88aacc,transparent:true,opacity:.7});
  var fWater=new THREE.Mesh(new THREE.CylinderGeometry(.7,.7,.12,12),fMat);fWater.position.set(6,.56,-8);addS(fWater);
  mkBox(.12,1.2,.12,0xbbaa88,6,1,-8);
  var fLight=new THREE.PointLight(0x88aaff,.5,6);fLight.position.set(6,2,-8);addS(fLight);
  addWall(6,-8,1.4); // ‚Üê fountain collision

  // ‚îÄ‚îÄ Market stalls ‚Äî each stall gets a wall collider ‚îÄ‚îÄ
  var stallColors=[0xcc8822,0x8844aa,0xaa3322,0x226644,0xcc6622];
  for(var st=0;st<5;st++){
    var sx=-8+st*4,sz=-6;
    mkBox(3.2,.1,1.6,0xaa8833,sx,.82,sz);
    mkBox(3.2,.06,1.8,stallColors[st],sx,2.2,sz+.2);
    mkBox(.08,2.2,.08,0x885522,sx-1.5,1.1,sz+.8);
    mkBox(.08,2.2,.08,0x885522,sx+1.5,1.1,sz+.8);
    for(var g=0;g<3;g++) mkBox(.35+Math.random()*.2,.3+Math.random()*.2,.35,0xdd9944+g*0x101010,sx-1+g*.9,1.12,sz);
    addWall(sx,sz,1.8); // ‚Üê stall table collision
    addWall(sx-1.5,sz+.8,.3); // ‚Üê left pole
    addWall(sx+1.5,sz+.8,.3); // ‚Üê right pole
  }

  // ‚îÄ‚îÄ Cypress trees ‚Äî POSITIONED AWAY FROM CHURCH ENTRANCE ‚îÄ‚îÄ
  // Safe positions: flanking both sides, never within x=-5..5 near z<-18
  var cypressPos=[
    [-22,-14],[-28,-10],[-26,-20],[22,-14],[28,-10],[26,-20],[-24,-6]
  ];
  cypressPos.forEach(function(cp){
    var cyx=cp[0],cyz=cp[1];
    mkBox(.55,7,.55,0x4a2a10,cyx,3.5,cyz);
    mkCone(1.4,10,6,0x1a5015,cyx,12,cyz);
    addWall(cyx,cyz,.7); // ‚Üê cypress collision
  });

  // ‚îÄ‚îÄ Olive grove on hillside ‚Äî far enough from church ‚îÄ‚îÄ
  for(var ol=0;ol<8;ol++){
    var olx=(ol-3.5)*5.5,olz=-36+(ol%3)*.8; // deterministic, all z<-34
    mkBox(.4,3.5,.4,0x5a3a18,olx,1.75,olz);mkSph(2.8,7,5,0x4a7830,olx,5.5,olz);
    addWall(olx,olz,1.0); // ‚Üê olive tree collision
  }

  // ‚îÄ‚îÄ Townspeople ‚Äî spawn in piazza only, never blocking the main path ‚îÄ‚îÄ
  var npcCols=[0xaa7744,0x8866cc,0x6699aa,0x448844,0xcc6644,0xaa8822,0x557788];
  var npcSpots=[[-6,-4],[-8,-8],[6,-5],[8,-9],[-5,-11],[7,-11],[-9,-3],[5,-3]];
  npcSpots.forEach(function(sp,idx){
    mkNPC(npcCols[idx%7],sp[0],0,sp[1]); // addWall called inside mkNPC
  });
  // Pietro Bernardone ‚Äî Francis's father
  var padre=mkNPC(0x8866aa,-4,0,2);
  padre.userData.prompt='Speak with your father';padre.userData.dlgKey='assisi_welcome';
  G.interactables.push(padre);

  // ‚îÄ‚îÄ Cathedral zone entrance ‚îÄ‚îÄ
  G.interactables.push({zone:true,x:0,z:-20,r:5,prompt:'Enter the church and hear the voice of God',action:'dlgAdv',dlgKey:'voice_of_god'});
  setPos(0,2);setObj('Walk north through the Piazza del Comune to the church.');hideProgress();
}

function bSanDamiano(){
  // San Damiano chapel, just outside Assisi walls ‚Äî c. 1206. 
  // Francis has been commanded by the crucifix to rebuild God's house.
  mkFog(0x7ba3cc,32,95);mkAmb(0xfff2dd,.6);mkHemi(0x88aacc,0x4a5538,.38);mkDir(0xffeedd,1.25,15,32,10);
  // Ground ‚Äî earthy Umbrian soil
  var gndMat=new THREE.MeshLambertMaterial({color:0x7a6845});
  var gnd=new THREE.Mesh(new THREE.PlaneGeometry(95,95),gndMat);gnd.rotation.x=-Math.PI/2;gnd.receiveShadow=true;addS(gnd);

  // ‚îÄ‚îÄ Winding dirt path leading to chapel ‚îÄ‚îÄ
  for(var p=0;p<14;p++){
    var px2=(Math.sin(p*.4)*.8),pz2=p*2+3;
    mkBox(3.2+Math.random()*.5,.07,1.5,0x9a8868+(p%3)*0x040200,px2,.04,pz2);
  }
  // Path border grass tufts
  for(var tft=0;tft<12;tft++){
    var tftx=(tft%2===0?-2.2:2.2)+(Math.random()-.5)*.4;
    mkBox(.15,.4+Math.random()*.25,.15,0x3a6a1a,tftx,.2,tft*2.2+3);
  }
  // Path ascending ramp toward chapel door
  addRamp(0,22, 0,28, 0,.4, 2.5);

  // ‚îÄ‚îÄ Chapel exterior ‚Äî Romanesque, 12th century ‚îÄ‚îÄ
  // Front facade with entrance steps
  for(var es=0;es<3;es++){
    mkBox(10+es*.8,.32,1.2,0xc4b090+es*0x040400,0,.16+es*.32,6-es*1.2);
  }
  // Register entrance steps ramp
  addRamp(0,3.6, 0,6, 0, 3*.32, 4.5);

  // Main chapel walls ‚Äî partially ruined
  mkBox(14,.5,12,0xbbaa80,0,.28,0); // floor slab
  // Back apse wall (still standing)
  mkBox(14,6,.9,0xc6b58a,0,3,-6);
  // Left wall ‚Äî partial ruin, lower on far end
  mkBox(.9,7,12,0xc4b088,-7,3.5,0);
  // Right wall ‚Äî more ruined, crumbling top
  mkBox(.9,5,12,0xbfab82,7,2.5,0);
  // Ruined right wall top section (leaning)
  var rwMat=new THREE.MeshLambertMaterial({color:0xb4a07a});
  var rw=new THREE.Mesh(new THREE.BoxGeometry(.9,2.5,6),rwMat);rw.position.set(7,6.5,2);rw.rotation.z=-.08;addS(rw);

  // Front entrance arch ‚Äî Romanesque round arch
  mkBox(4,5,.7,0xc0a878,-3.1,2.5,6); // left jamb
  mkBox(4,5,.7,0xc0a878,3.1,2.5,6);  // right jamb
  mkBox(9,1.8,.7,0xb8a06a,0,5.6,6);  // lintel
  // Arch voussoirs (wedge blocks in arch)
  for(var av=0;av<7;av++){
    var aang=(av/6)*Math.PI,ar=4.5;
    var avx=Math.cos(aang)*ar,avy=Math.sin(aang)*ar+5.6;
    mkBox(1.4,.9,.7,0xb5a06a,avx,avy,6);
  }

  // ‚îÄ‚îÄ Byzantine San Damiano Cross ‚Äî the speaking crucifix ‚îÄ‚îÄ
  var woodMat=new THREE.MeshLambertMaterial({color:0x7a4e18,emissive:new THREE.Color(0x3a1800),emissiveIntensity:.2});
  // Cross background panel (painted wood, warm brown)
  var bgPanel=new THREE.Mesh(new THREE.BoxGeometry(2.6,4.2,.2),woodMat);bgPanel.position.set(0,4.5,-5.9);addS(bgPanel);
  // Golden border
  var borderMat=new THREE.MeshLambertMaterial({color:0xcc9922,emissive:new THREE.Color(0xaa7700),emissiveIntensity:.4});
  var border=new THREE.Mesh(new THREE.BoxGeometry(2.8,4.4,.18),borderMat);border.position.set(0,4.5,-5.8);addS(border);
  // Cross arms
  var goldCM=new THREE.MeshLambertMaterial({color:0xffd060,emissive:new THREE.Color(0xffaa00),emissiveIntensity:1.0});
  var vArm=new THREE.Mesh(new THREE.BoxGeometry(.28,3.8,.26),goldCM);vArm.position.set(0,4.8,-5.7);addS(vArm);
  var hArm=new THREE.Mesh(new THREE.BoxGeometry(2.0,.28,.26),goldCM);hArm.position.set(0,5.8,-5.7);addS(hArm);
  // Christ figure on cross
  var christMat=new THREE.MeshLambertMaterial({color:0xf0c080,emissive:new THREE.Color(0xcc8820),emissiveIntensity:.3});
  var christBody=new THREE.Mesh(new THREE.CylinderGeometry(.22,.28,.9,7),christMat);christBody.position.set(0,5.05,-5.65);addS(christBody);
  var christHead=new THREE.Mesh(new THREE.SphereGeometry(.2,8,7),christMat);christHead.position.set(0,5.65,-5.65);addS(christHead);
  // Radiating golden glow from cross
  var crossGlow1=new THREE.PointLight(0xffd700,2.8,16);crossGlow1.position.set(0,5.5,-5.5);crossGlow1.userData.glow=true;addS(crossGlow1);
  var crossGlow2=new THREE.PointLight(0xff8800,1.0,28);crossGlow2.position.set(0,4,-4);crossGlow2.userData.glow=true;addS(crossGlow2);

  // ‚îÄ‚îÄ Altar ‚îÄ‚îÄ
  mkBox(3.5,1.5,2,0xf0e8d0,0,.78,-4.8);
  mkBox(3.7,.3,2.2,0xe0d8c0,0,1.58,-4.8); // altar top slab
  // Altar cloth hint
  mkBox(3.4,.06,1.8,0xcc2222,0,1.6,-4.8);

  // ‚îÄ‚îÄ Five altar candles ‚îÄ‚îÄ
  for(var c=0;c<5;c++){
    var canx=-4+c*2;
    mkBox(.14,.9,.14,0xeeeebb,canx,.85,-4.2);
    mkSph(.11,5,4,0xffdd88,canx,1.8,-4.2);
    var cgl=new THREE.PointLight(0xffcc77,1.0,8);cgl.position.set(canx,2.2,-4.2);cgl.userData.glow=true;addS(cgl);
  }
  // Side candelabra
  for(var sc=0;sc<2;sc++){
    var sx=(sc===0)?-5.8:5.8;
    mkBox(.18,1.2,.18,0xbbaa44,sx,.85,0);
    var sgl=new THREE.PointLight(0xffbb55,.9,9);sgl.position.set(sx,2.3,0);sgl.userData.glow=true;addS(sgl);
  }

  // ‚îÄ‚îÄ Collapsed roof timbers ‚îÄ‚îÄ
  mkBox(14,.3,1.2,0x5a3818,0,.88,-1.5);
  var timMat=new THREE.MeshLambertMaterial({color:0x6a4520});
  var tim2=new THREE.Mesh(new THREE.BoxGeometry(1,.28,12),timMat);tim2.position.set(-5,.65,0);tim2.rotation.z=.12;addS(tim2);
  var tim3=new THREE.Mesh(new THREE.BoxGeometry(.8,.25,8),timMat);tim3.position.set(5,.55,-2);tim3.rotation.z=-.1;addS(tim3);

  // ‚îÄ‚îÄ Rubble and debris on floor ‚îÄ‚îÄ
  for(var rb=0;rb<20;rb++){
    var rbx=(Math.random()-.5)*13,rbz=(Math.random()-.5)*10;
    mkBox(.35+Math.random()*.55,.18+Math.random()*.28,.35+Math.random()*.55,
      0x998877+Math.floor(Math.random()*3)*0x080808,rbx,.24+Math.random()*.1,rbz);
  }

  // ‚îÄ‚îÄ Weeds and small bushes growing through cracks ‚îÄ‚îÄ
  for(var weed=0;weed<8;weed++){
    var wx=(Math.random()>.5?1:-1)*(2.5+Math.random()*4),wz=(Math.random()-.5)*8;
    if(Math.abs(wz)>3&&Math.abs(wx)<5)continue; // keep entrance clear
    mkBox(.12,.5+Math.random()*.3,.12,0x2a5a12,wx,.25,wz);
    if(weed%3===0)mkSph(.35+Math.random()*.2,5,4,0x3a7a1a,wx,.8+Math.random()*.2,wz);
  }

  // ‚îÄ‚îÄ Sunbeam ‚Äî light shaft through broken wall ‚îÄ‚îÄ
  var sbMat=new THREE.MeshBasicMaterial({color:0xfff8cc,transparent:true,opacity:.05,side:THREE.DoubleSide});
  var sb=new THREE.Mesh(new THREE.BoxGeometry(1.2,8,14),sbMat);sb.position.set(4,4,0);sb.rotation.z=.22;addS(sb);

  // ‚îÄ‚îÄ Olive trees outside chapel ‚îÄ‚îÄ
  for(var olt=0;olt<6;olt++){
    var oltx=(olt%3===0?-1:1)*(10+Math.random()*4),oltz=10+Math.floor(olt/3)*6;
    mkBox(.4,4,.4,0x5a3a18,oltx,2,oltz);mkSph(2.8,7,5,0x4a7830,oltx,5.8,oltz);
  }

  // Collision walls: chapel walls
  // bSanDamiano ‚Äî open walls (Francis can walk anywhere)
  // San Damiano collision

  // ‚îÄ‚îÄ Repair pieces ‚îÄ‚îÄ
  G.fixedPieces=0;G.totalPieces=5;
  addPiece(0xa09070,.85,3.4,12, 7,4.8,0,'Right Side Wall',0xd0c098);
  addPiece(0x998866,7,.8,.9,    0,6.9,-6,'Apse Arch',0xc0a870);
  addPiece(0x5577aa,2.8,2.8,.3, 0,4.4,-5.9,'Painted Cross',0xffd060);
  addPiece(0x999080,.65,4.8,.65,-5.5,2.4,0,'Stone Column',0xd4c4a0);
  addPiece(0x6a4a2a,14,.45,5.5, 0,7.8,2,'Roof Timbers',0x7B3A10);

  setPos(0,8);setObj('Repair all 5 broken sections of San Damiano (0/5).');showProgress('Repaired: 0/5');
}

function bBirds(){
  // Bevagna, Umbria ‚Äî c. 1213. A wide open field by the Via Flaminia.
  // Francis stops to preach to a vast flock of swallows, doves, and larks.
  mkFog(0x5b9fd4,42,115);mkAmb(0xfff8ee,.67);mkHemi(0x5599cc,0x3a7a3a,.44);mkDir(0xffeedd,1.4,22,38,14);
  var skyFill=new THREE.DirectionalLight(0x88aadd,.38);skyFill.position.set(-18,32,-6);addS(skyFill);
  mkGnd(0x4a9040,110,110);

  // ‚îÄ‚îÄ Rolling Umbrian hills in every direction ‚îÄ‚îÄ
  for(var h=0;h<10;h++){
    var ha=(h/10)*Math.PI*2,hr=38+Math.random()*14,hh=6+Math.random()*8;
    mkSph(hr,7,5,h%2===0?0x3d8a3a:0x2e6a2e,Math.cos(ha)*hr,hh-hr+1.5,Math.sin(ha)*hr-12);
  }

  // ‚îÄ‚îÄ Via Flaminia ‚Äî ancient Roman road (stone paved, raised) ‚îÄ‚îÄ
  mkBox(5,.22,80,0xaaa080,14,.11,-10); // road surface
  mkBox(.4,.3,80,0x888060,11,.15,-10); // left kerb
  mkBox(.4,.3,80,0x888060,17,.15,-10); // right kerb
  // Milestone marker
  mkBox(.5,1.4,.5,0xccbbaa,14,.7,6);
  mkBox(.8,.3,.8,0xbbaa99,14,1.6,6);
  addRamp(14,-40, 14,40, 0,.22, 2.2); // walkable road surface

  // ‚îÄ‚îÄ Open meadow field where Francis preaches ‚îÄ‚îÄ
  // Gentle rolling ground patches
  for(var gp=0;gp<6;gp++){
    var gpx=(Math.random()-.5)*22,gpz=-8+(Math.random()-.5)*14;
    mkSph(5+Math.random()*4,6,4,0x3a8a3a,gpx,-.8+Math.random()*.5,gpz);
  }

  // ‚îÄ‚îÄ Wildflowers carpet ‚îÄ‚îÄ
  var fc=[0xff6688,0xffee44,0xff9944,0xee44ff,0x44aaff,0xffffff,0xffbbcc,0xff8844];
  for(var fl=0;fl<55;fl++){
    var fx=(Math.random()-.5)*36,fz=(Math.random()-.5)*26-4;
    var fdx=fx,fdz=fz+12;if(fdx*fdx+fdz*fdz<64)continue; // keep bird zone clear
    mkBox(.1,.55+Math.random()*.3,.1,0x228822,fx,.28,fz);
    mkSph(.18+Math.random()*.08,4,3,fc[fl%8],fx,.88,fz);
  }

  // ‚îÄ‚îÄ Stone path from road to preaching spot ‚îÄ‚îÄ
  for(var pp=0;pp<10;pp++){
    var ppx=Math.sin(pp*.3)*1.2;
    mkBox(2.4+Math.random()*.4,.06,1.4,0xbbaa88+(pp%3)*0x060400,ppx,.03,-pp*2.2-1);
  }
  // Low stone wall bordering the field
  for(var sw=0;sw<12;sw++){
    mkBox(2.2+Math.random()*.3,.6+Math.random()*.3,1.2,0x998877,-28+sw*5,.3,-18);
  }

  // ‚îÄ‚îÄ Ancient olive grove ‚Äî gnarled old trees ‚îÄ‚îÄ
  var olivePos=[[-18,-24],[-12,-30],[-6,-26],[6,-28],[12,-24],[20,-26],[-20,-14],[18,-14]];
  olivePos.forEach(function(op){
    var ox=op[0],oz=op[1];
    mkBox(.5+Math.random()*.2,4.5+Math.random()*1.5,.5+Math.random()*.2,0x5a3a18,ox,2.2,oz);
    mkSph(3+Math.random()*.8,7,5,0x4a7830+Math.floor(Math.random()*3)*0x050200,ox,5.8+Math.random()*.5,oz);
  });

  // ‚îÄ‚îÄ Poplar trees lining the road ‚îÄ‚îÄ
  for(var pl=0;pl<8;pl++){
    var plz=-30+pl*8;
    mkBox(.45,9,.45,0x4a2a10,11,4.5,plz);
    mkSph(1.6,7,5,0x1a5a1a,11,11,plz);
    mkBox(.45,9,.45,0x4a2a10,17,4.5,plz);
    mkSph(1.6,7,5,0x1a5a1a,17,11,plz);
  }

  // ‚îÄ‚îÄ Distant Assisi on the hill ‚îÄ‚îÄ
  mkBox(4,8,2,0xddd0b0,-52,4,-65);
  mkBox(2,14,2,0xccbb99,-48,7,-65);
  mkBox(6,6,2,0xddd0b0,-56,3,-65);

  // ‚îÄ‚îÄ BIRDS ‚Äî a great mixed flock ‚îÄ‚îÄ
  // Birds sitting on the ground in a wide semicircle
  var birdCols=[0x884422,0x556677,0xaa8833,0x334455,0x663322,0x448866,0x996633,0x335566];
  var birdPositions=[];
  for(var bi=0;bi<32;bi++){
    var bangle=(bi/32)*Math.PI*2,bradius=5+Math.random()*5;
    var bx=Math.cos(bangle)*bradius,bz=Math.sin(bangle)*bradius-14;
    birdPositions.push([bx,bz]);
    // Bird body (cone pointing forward)
    var bMesh=new THREE.Mesh(new THREE.ConeGeometry(.25,.18,4),
      new THREE.MeshLambertMaterial({color:birdCols[bi%8]}));
    bMesh.position.set(bx,.55+Math.floor(bi/12)*.28,bz);
    bMesh.rotation.x=Math.PI/2;
    bMesh.userData={origY:.55+Math.floor(bi/12)*.28,phase:Math.random()*Math.PI*2,dancing:false};
    addS(bMesh);G.birds.push(bMesh);
  }
  // Birds perched in nearby branches
  for(var bb=0;bb<12;bb++){
    var bMesh2=new THREE.Mesh(new THREE.ConeGeometry(.22,.15,4),
      new THREE.MeshLambertMaterial({color:birdCols[bb%8]}));
    var bperchX=(Math.random()-.5)*20,bperchY=3+Math.random()*4,bperchZ=-22+Math.random()*6;
    bMesh2.position.set(bperchX,bperchY,bperchZ);
    bMesh2.rotation.x=Math.PI/2;
    bMesh2.userData={origY:bperchY,phase:Math.random()*Math.PI*2,dancing:false};
    addS(bMesh2);G.birds.push(bMesh2);
  }

  // ‚îÄ‚îÄ Companion friar walking with Francis ‚îÄ‚îÄ
  var friar=mkNPC(0x8B5A2B,-3,0,4);
  friar.userData.prompt='Talk with your companion friar';
  friar.userData.dlgKey='birds_intro';
  G.interactables.push(friar);
  // Stone field wall colliders
  addWallLine(-28,-18,28,-18,.8);
  // Road edges
  addWall(11,-10,.5);addWall(17,-10,.5);
  // Birds collision
  addWallLine(-28,-18,28,-18,.9); // stone field wall
  addWallLine(11,-10,11,-30,.6);addWallLine(17,-10,17,-30,.6); // road edges
  for(var _pt=0;_pt<4;_pt++) addWall(-10-_pt*3,-4+Math.sin(_pt)*.8*.01,.7); // palm trees
  G.interactables.push({zone:true,x:0,z:-12,r:5.5,prompt:'Raise your arms and preach to the birds',action:'birds'});
  setPos(0,6);setObj('Walk to the great flock of birds and preach to them.');hideProgress();
}

function bWolf(){
  // Gubbio, Umbria ‚Äî c. 1220. Night. A great wolf terrorises the city.
  // Francis walks out alone beyond the gate to make peace with the beast.
  mkFog(0x1a2535,20,70);mkAmb(0x223344,.42);mkHemi(0x0d1a28,0x060d06,.25);
  mkDir(0x8899cc,.55,-14,24,12);mkGnd(0x2a3a28,110,110);

  // ‚îÄ‚îÄ Night sky ‚Äî moon and stars ‚îÄ‚îÄ
  G.scene.background=new THREE.Color(0x060d1a);
  var moonLight=new THREE.DirectionalLight(0x99aacc,.45);moonLight.position.set(12,45,-8);addS(moonLight);
  // Moon disc
  var moonMesh=new THREE.Mesh(new THREE.CircleGeometry(2.8,16),
    new THREE.MeshBasicMaterial({color:0xe8e8cc,side:THREE.DoubleSide}));
  moonMesh.position.set(18,38,-60);moonMesh.rotation.y=.3;addS(moonMesh);
  // Stars
  var sv=[];for(var s=0;s<800;s++)sv.push((Math.random()-.5)*200,20+Math.random()*80,(Math.random()-.5)*200-30);
  var sg=new THREE.BufferGeometry();sg.setAttribute('position',new THREE.Float32BufferAttribute(sv,3));
  addS(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:.25,transparent:true,opacity:.85})));

  // ‚îÄ‚îÄ Dense ancient forest ‚Äî encircling the clearing ‚îÄ‚îÄ
  for(var i=0;i<24;i++){
    var a=(i/24)*Math.PI*2,r=26+Math.random()*12;
    var tx=Math.cos(a)*r,tz=Math.sin(a)*r;
    var th=10+Math.random()*8;
    mkBox(.7+Math.random()*.5,th,.7+Math.random()*.5,0x1a0e04,tx,th/2,tz);
    mkCone(3+Math.random()*2.5,th,5,0x071208,tx,th+th*.4,tz);
  }
  // Underbrush and ferns
  for(var ub=0;ub<22;ub++){
    var ubx=(Math.random()-.5)*30,ubz=(Math.random()-.5)*24;
    mkBox(.6+Math.random()*.5,.45,.6+Math.random()*.5,0x1a2a12,ubx,.22,ubz);
  }
  // Forest floor rocks
  for(var fr2=0;fr2<16;fr2++){
    var rx=(Math.random()-.5)*28,rz=(Math.random()-.5)*22;
    mkBox(.9+Math.random()*.9,.3+Math.random()*.5,.9+Math.random()*.9,0x445544,rx,.18,rz);
  }

  // ‚îÄ‚îÄ Ground mist ‚îÄ‚îÄ
  var mistMat=new THREE.MeshLambertMaterial({color:0x223344,transparent:true,opacity:.15,side:THREE.DoubleSide});
  var mist=new THREE.Mesh(new THREE.PlaneGeometry(90,90),mistMat);mist.rotation.x=-Math.PI/2;mist.position.y=.1;addS(mist);
  // Second mist layer
  var mist2=new THREE.Mesh(new THREE.PlaneGeometry(70,70),new THREE.MeshLambertMaterial({color:0x334455,transparent:true,opacity:.09}));
  mist2.rotation.x=-Math.PI/2;mist2.position.y=.4;addS(mist2);

  // ‚îÄ‚îÄ Gubbio city gate ‚Äî imposing medieval fortification ‚îÄ‚îÄ
  // Main gate towers
  mkBox(3.5,14,3.5,0x8a7a60,-7,7,-22);  // left tower
  mkBox(3.5,14,3.5,0x8a7a60,7,7,-22);   // right tower
  // Tower battlements
  for(var bt=0;bt<3;bt++){
    mkBox(1.2,1.8,1.2,0x7a6a50,-8.5+bt*1.4,14.5,-22);
    mkBox(1.2,1.8,1.2,0x7a6a50,5.5+bt*1.4,14.5,-22);
  }
  // Arch spanning the gate opening
  mkBox(14.5,3,1.4,0x9a8a70,0,12,-22); // gate arch lintel
  // Portcullis hints
  for(var pgr=0;pgr<5;pgr++){
    mkBox(.18,5.5,.3,0x3a3028,-4+pgr*2,7,-21.4);
  }
  // Gate flanking walls
  mkBox(12,.5,1.4,0x8a7a60,0,9.8,-22); // top of gate opening
  mkBox(30,9,1.4,0x8a7a60,-20,4.5,-22); // left extension wall
  mkBox(30,9,1.4,0x8a7a60,20,4.5,-22); // right extension wall
  // Wall crenellations
  for(var cr=0;cr<14;cr++){
    mkBox(1.8,1.6,1.4,0x857565,-28+cr*4.2,9.5,-22);
  }

  // Torches on gate towers ‚Äî warm fire glow
  for(var gt=0;gt<2;gt++){
    var gtx=(gt===0)?-5.5:5.5;
    mkBox(.2,.7,.2,0x9a6622,gtx,11,-21.5);
    mkSph(.18,5,4,0xff8822,gtx,11.75,-21.5);
    var tl=new THREE.PointLight(0xff9933,2.2,16);tl.position.set(gtx,12.5,-22);tl.userData.glow=true;addS(tl);
  }

  // ‚îÄ‚îÄ Frightened townspeople behind gate ‚îÄ‚îÄ
  for(var v=0;v<8;v++){
    var vx=-8+v*2.5,vz=-20;
    mkNPC(v%2===0?0x6a5040:0x8a7060,vx,0,vz);
  }

  // ‚îÄ‚îÄ Path from gate into the clearing ‚îÄ‚îÄ
  for(var gp=0;gp<8;gp++){
    mkBox(3.5,.07,1.5,0x4a5040+(gp%2)*0x080808,0,.04,-gp*2.2-2);
  }

  // ‚îÄ‚îÄ Dead tree ‚Äî atmosphere ‚îÄ‚îÄ
  mkBox(.5,5,.5,0x1a1206,-10,2.5,-8);
  for(var dt=0;dt<6;dt++){
    var da=(dt/6)*Math.PI-.5,dl=2+Math.random()*2;
    mkBox(dl,.25,.25,0x1a1206,-10+Math.cos(da)*dl*.5,5+Math.sin(da)*dl*.5,-8);
  }

  // ‚îÄ‚îÄ WOLF MESH (built inline) ‚îÄ‚îÄ
  G.wolfGroup=new THREE.Group();tagObj(G.wolfGroup);
  var wGrey=new THREE.MeshLambertMaterial({color:0x888888});
  var wDark=new THREE.MeshLambertMaterial({color:0x555555});
  // Body
  var wBody=new THREE.Mesh(new THREE.BoxGeometry(1.4,1.0,2.4),wGrey);wBody.position.y=1.1;G.wolfGroup.add(wBody);
  // Neck
  var wNeck=new THREE.Mesh(new THREE.BoxGeometry(.7,.7,.7),wGrey);wNeck.position.set(0,1.7,.9);G.wolfGroup.add(wNeck);
  // Head
  var wHead=new THREE.Mesh(new THREE.BoxGeometry(.9,.75,1.1),wGrey);wHead.position.set(0,1.8,1.5);G.wolfGroup.add(wHead);
  // Snout
  var wSnout=new THREE.Mesh(new THREE.BoxGeometry(.5,.4,.6),wDark);wSnout.position.set(0,1.62,2.05);G.wolfGroup.add(wSnout);
  // Ears
  var wEarL=new THREE.Mesh(new THREE.BoxGeometry(.22,.4,.18),wDark);wEarL.position.set(-.3,2.25,1.4);G.wolfGroup.add(wEarL);
  var wEarR=wEarL.clone();wEarR.position.set(.3,2.25,1.4);G.wolfGroup.add(wEarR);
  // Eyes ‚Äî red glow
  var eyeMat=new THREE.MeshLambertMaterial({color:0xff2200,emissive:new THREE.Color(0xff0000),emissiveIntensity:1.2});
  var wEyeL=new THREE.Mesh(new THREE.SphereGeometry(.1,6,5),eyeMat);wEyeL.position.set(-.22,1.9,1.98);G.wolfGroup.add(wEyeL);
  var wEyeR=wEyeL.clone();wEyeR.position.set(.22,1.9,1.98);G.wolfGroup.add(wEyeR);
  G.wolfEyes=[wEyeL,wEyeR];
  // Legs
  var legPos=[-.5,-.9,.5,-.9,-.5,.9,.5,.9]; // x,z pairs
  for(var wl=0;wl<4;wl++){
    var wLeg=new THREE.Mesh(new THREE.BoxGeometry(.35,1.0,.35),wGrey);
    wLeg.position.set(legPos[wl*2],.55,legPos[wl*2+1]);G.wolfGroup.add(wLeg);
  }
  // Tail
  G.wolfTail=new THREE.Mesh(new THREE.BoxGeometry(.2,.2,1.0),wDark);
  G.wolfTail.position.set(0,1.3,-1.1);G.wolfTail.rotation.x=-.5;G.wolfGroup.add(G.wolfTail);
  G.wolfGroup.position.set(0,0,-11);
  G.wolfGroup.rotation.y=Math.PI;
  G.wolfGroup.userData.prompt='Make peace with Brother Wolf ‚Äî PRAY';
  G.wolfGroup.userData.action='wolf';
  G.interactables.push(G.wolfGroup);
  G.scene.add(G.wolfGroup);
  // Wolf eye glow light
  var wGlow=new THREE.PointLight(0xff2200,.8,6);wGlow.position.set(0,2,-10);addS(wGlow);
  // Wall colliders ‚Äî forest ring + gate (no duplicate vars)
  for(var wfi=0;wfi<24;wfi++){
    var wfa=(wfi/24)*Math.PI*2;
    addWall(Math.cos(wfa)*28,Math.sin(wfa)*28,2.5);
  }
  addWallLine(-20,-22,20,-22,1.4);
  addWall(-10,-8,.6);addWall(10,-8,.6);
  addWall(7,-22,2.0);addWall(-7,-22,2.0); // gate towers
  setPos(0,5);setObj('Walk to Brother Wolf and bring peace between him and the people of Gubbio.');hideProgress();
}

function bLaVerna(){
  // La Verna, Tuscan Apennines ‚Äî September 14, 1224. The Feast of the Holy Cross.
  // Francis receives the stigmata on this rocky mountain peak at dawn.
  G.scene.background=new THREE.Color(0x080f24);
  G.scene.fog=new THREE.Fog(0x0c1530,20,80);
  mkAmb(0x1a2244,.4);mkHemi(0x0c1530,0x080808,.22);
  mkDir(0x7788cc,.7,-8,26,6);

  // ‚îÄ‚îÄ Pre-dawn sky ‚Äî fading from deep indigo to violet at horizon ‚îÄ‚îÄ
  var skyMat=new THREE.MeshBasicMaterial({
    color:0x100828,side:THREE.BackSide,transparent:true,opacity:.95
  });
  var skySphere=new THREE.Mesh(new THREE.SphereGeometry(180,16,12),skyMat);addS(skySphere);

  // ‚îÄ‚îÄ Stars ‚Äî dense Apennine sky ‚îÄ‚îÄ
  var sv=[];
  for(var s=0;s<1000;s++)sv.push((Math.random()-.5)*280,10+Math.random()*120,(Math.random()-.5)*280-20);
  var sg=new THREE.BufferGeometry();sg.setAttribute('position',new THREE.Float32BufferAttribute(sv,3));
  addS(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:.3,transparent:true,opacity:.95})));
  // Bright stars cluster
  for(var bs=0;bs<12;bs++){
    var bsMesh=new THREE.Mesh(new THREE.SphereGeometry(.18,4,3),
      new THREE.MeshBasicMaterial({color:0xfff8cc}));
    bsMesh.position.set((Math.random()-.5)*80,25+Math.random()*50,(Math.random()-.5)*80-20);
    addS(bsMesh);
  }

  // ‚îÄ‚îÄ Mountain ground ‚Äî dark Apennine rock ‚îÄ‚îÄ
  var gndMat=new THREE.MeshLambertMaterial({color:0x2a2018});
  var gnd=new THREE.Mesh(new THREE.PlaneGeometry(100,100),gndMat);
  gnd.rotation.x=-Math.PI/2;gnd.receiveShadow=true;addS(gnd);

  // ‚îÄ‚îÄ Rocky mountain terrain ‚Äî layered crags ‚îÄ‚îÄ
  var rc=[0x5a4a3a,0x4a3a2a,0x6a5a4a,0x7a6a5a,0x3a2a1a,0x8a7a6a,0x504030,0x6a5040];
  // Main summit mass (behind the cross)
  for(var i=0;i<8;i++){
    var ss=6+i*2.5,sOff=(i-3.5)*1.4;
    var sm=new THREE.Mesh(new THREE.ConeGeometry(ss,ss*1.8,7),new THREE.MeshLambertMaterial({color:rc[i%8]}));
    sm.position.set(sOff,ss*.9-1,-20-i*2.6);sm.castShadow=true;addS(sm);
  }
  // Side rock formations
  for(var sr=0;sr<10;sr++){
    var srx=(sr%2===0?-1:1)*(8+Math.random()*14),srz=-(sr*4)-2;
    var srr=new THREE.Mesh(new THREE.DodecahedronGeometry(1.5+Math.random()*2.5,0),
      new THREE.MeshLambertMaterial({color:rc[sr%6]}));
    srr.position.set(srx,.8+Math.random()*2,srz);
    srr.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);
    srr.castShadow=true;addS(srr);
  }
  // Foreground boulders
  for(var fb=0;fb<18;fb++){
    var fbx=(Math.random()-.5)*24,fbz=(Math.random()-.5)*18;
    if(Math.abs(fbx)<2&&fbz>-25&&fbz<2)continue; // keep ascending path clear
    var fbs=.5+Math.random()*1.4;
    var fbm=new THREE.Mesh(new THREE.DodecahedronGeometry(fbs,0),
      new THREE.MeshLambertMaterial({color:0x3a3020+Math.floor(Math.random()*4)*0x101008}));
    fbm.position.set(fbx,fbs*.45,fbz);
    fbm.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);
    addS(fbm);
  }

  // ‚îÄ‚îÄ Ascending stone path with WALKABLE STEPS ‚îÄ‚îÄ
  // 14 steps rising from z=2 toward z=-22, Y rising from 0 to 4.0
  for(var j=0;j<14;j++){
    var stepY=j*.30,stepZ=-j*2.0-1;
    var stepW=3.5-j*.1; // narrows as it climbs
    mkBox(stepW,.3,1.3,0x7a6a58+j*0x020200,0,stepY+.15,stepZ);
    // Side guard stones
    mkBox(.4,.5+Math.random()*.3,.4,0x554433,stepW*.5+.2,stepY+.4,stepZ);
    mkBox(.4,.5+Math.random()*.3,.4,0x554433,-stepW*.5-.2,stepY+.4,stepZ);
  }
  // Register walkable ramp for the ascending path
  addRamp(0, 2, 0, -27, 0, 4.2, 2.5);

  // ‚îÄ‚îÄ Chapel of the Stigmata ‚Äî small stone oratory ‚îÄ‚îÄ
  // Walls
  mkBox(6,.3,5,0x7a6a58,0,4.15,-20);   // chapel floor
  mkBox(6,4,.5,0x7a6a58,0,6.3,-22.4);  // back wall
  mkBox(.5,4,5,0x7a6a58,-3,6.3,-20);   // left wall
  mkBox(.5,4,5,0x7a6a58,3,6.3,-20);    // right wall
  // Doorway arch
  mkBox(2,3.5,.5,0x6a5a48,-1.5,5.8,-17.5);
  mkBox(2,3.5,.5,0x6a5a48,1.5,5.8,-17.5);
  mkBox(4,.8,.5,0x6a5a48,0,7.8,-17.5);
  // Chapel roof
  mkBox(7,.3,6,0x6a5a48,0,8.35,-20);
  var roofMat=new THREE.MeshLambertMaterial({color:0x5a4a38});
  var roofL=new THREE.Mesh(new THREE.BoxGeometry(7,.2,3),roofMat);roofL.position.set(0,8.55,-21.5);roofL.rotation.z=.35;addS(roofL);
  var roofR=new THREE.Mesh(new THREE.BoxGeometry(7,.2,3),roofMat);roofR.position.set(0,8.55,-18.5);roofR.rotation.z=-.35;addS(roofR);

  // ‚îÄ‚îÄ THE CROSS ‚Äî glowing summit cross, Francis's vision ‚îÄ‚îÄ
  var goldMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffcc00),emissiveIntensity:1.2});
  // Vertical beam
  var vCross=new THREE.Mesh(new THREE.BoxGeometry(.32,6,.32),goldMat);vCross.position.set(0,18,-20);addS(vCross);
  // Horizontal beam
  var hCross=new THREE.Mesh(new THREE.BoxGeometry(3.6,.32,.32),goldMat);hCross.position.set(0,20.4,-20);addS(hCross);
  // Radiant cross lights
  var gl1=new THREE.PointLight(0xffd700,4.0,28);gl1.position.set(0,20,-20);gl1.userData.glow=true;addS(gl1);
  var gl2=new THREE.PointLight(0xffaa00,1.8,45);gl2.position.set(0,16,-20);gl2.userData.glow=true;addS(gl2);
  var gl3=new THREE.PointLight(0xffffcc,1.0,60);gl3.position.set(0,20,-18);gl3.userData.glow=true;addS(gl3);

  // Altar stone at base of cross
  mkBox(4.5,.6,2.2,0x8a7a6a,0,4.45,-19);
  // Altar candle
  mkBox(.15,.8,.15,0xeeeebb,0,4.9,-19);
  mkSph(.12,5,4,0xffdd88,0,5.75,-19);
  var acl=new THREE.PointLight(0xffcc77,.8,6);acl.position.set(0,5.5,-19);acl.userData.glow=true;addS(acl);

  // ‚îÄ‚îÄ Moonlit clouds ‚îÄ‚îÄ
  var cloudMat=new THREE.MeshLambertMaterial({color:0x223366,transparent:true,opacity:.7});
  for(var cl=0;cl<5;cl++){
    var cm=new THREE.Mesh(new THREE.SphereGeometry(5+Math.random()*4,6,4),cloudMat);
    cm.scale.y=.35+Math.random()*.25;
    cm.position.set((Math.random()-.5)*80,30+Math.random()*20,(Math.random()-.5)*60-30);
    addS(cm);
  }

  // ‚îÄ‚îÄ Seraph vision hint ‚Äî faint glowing winged shape above cross ‚îÄ‚îÄ
  var seraphMat=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:.12});
  var seraphBody=new THREE.Mesh(new THREE.SphereGeometry(.8,8,6),seraphMat);seraphBody.position.set(0,24,-20);addS(seraphBody);
  var wingMat=new THREE.MeshBasicMaterial({color:0xffdd88,transparent:true,opacity:.08});
  var wL=new THREE.Mesh(new THREE.PlaneGeometry(4,3),wingMat);wL.position.set(-2.5,24,-20);wL.rotation.z=.4;addS(wL);
  var wR=new THREE.Mesh(new THREE.PlaneGeometry(4,3),wingMat);wR.position.set(2.5,24,-20);wR.rotation.z=-.4;addS(wR);
  var seraphGlow=new THREE.PointLight(0xffffff,1.2,20);seraphGlow.position.set(0,24,-20);seraphGlow.userData.glow=true;addS(seraphGlow);

  // Side rock wall colliders
  for(var _wr=0;_wr<10;_wr++){var _wrx=(_wr%2===0?-1:1)*(8+_wr%5*2.5),_wrz=-(_wr*4)-2;addWall(_wrx,_wrz,2.0);}
  // La Verna collision: rock formations on sides
  for(var _wr=0;_wr<10;_wr++){var _wrx=(_wr%2===0?1:-1)*(8+_wr%5*2.5),_wrz=-(_wr*4)-2;addWall(_wrx,_wrz,2.0);}
  addWallLine(-5,-22,5,-22,1.0); // chapel back
  G.interactables.push({zone:true,x:0,z:-18,r:4,prompt:'Kneel before the Cross and receive the Stigmata',action:'stigmata'});
  setPos(0,0);setObj('Ascend La Verna ‚Äî kneel before the golden Cross at the summit.');hideProgress();
}

function bCanticle(){
  // Assisi ‚Äî late afternoon, Autumn 1225. 
  // Francis, nearly blind and dying, composes the Canticle of Brother Sun.
  // He is at the Poor Clares' convent of San Damiano with Sister Clare.
  G.scene.background=new THREE.Color(0xff7820);
  G.scene.fog=new THREE.Fog(0xff6010,28,95);
  mkAmb(0xffddaa,.95);mkHemi(0xff9944,0x5a3a1a,.35);mkDir(0xff8844,1.7,-26,20,10);
  var rimLight=new THREE.DirectionalLight(0xff4400,.4);rimLight.position.set(-20,15,5);addS(rimLight);
  mkGnd(0x9a7848,100,100);

  // ‚îÄ‚îÄ Blaze of sunset light ‚Äî golden ground plane ‚îÄ‚îÄ
  var sunGndMat=new THREE.MeshLambertMaterial({color:0xcc8820,emissive:new THREE.Color(0xaa5500),emissiveIntensity:.12});
  var sunGnd=new THREE.Mesh(new THREE.PlaneGeometry(100,100),sunGndMat);
  sunGnd.rotation.x=-Math.PI/2;sunGnd.position.y=.01;addS(sunGnd);

  // ‚îÄ‚îÄ San Damiano chapel ‚Äî seen from the garden ‚îÄ‚îÄ
  // Main chapel block
  mkBox(14,8,2.5,0xd8c890,0,4,-20);
  // Upper chapel / bell turret
  mkBox(6,5,2.5,0xd4c48a,0,10.5,-20);
  mkBox(3,3,2.5,0xffe880,0,14.3,-20); // lit window
  // Chapel cross on peak
  var golMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffcc00),emissiveIntensity:.9});
  var vCr=new THREE.Mesh(new THREE.BoxGeometry(.24,3.2,.24),golMat);vCr.position.set(0,17.5,-20);addS(vCr);
  var hCr=new THREE.Mesh(new THREE.BoxGeometry(1.8,.24,.24),golMat);hCr.position.set(0,18.8,-20);addS(hCr);
  var chapGlow=new THREE.PointLight(0xffd700,1.4,24);chapGlow.position.set(0,16,-20);chapGlow.userData.glow=true;addS(chapGlow);

  // ‚îÄ‚îÄ Chapel steps with addRamp ‚îÄ‚îÄ
  for(var cs=0;cs<4;cs++){
    mkBox(10+cs*.4,.3,1.3,0xcfbf88,0,.15+cs*.3,-17+cs*1.3);
  }
  addRamp(0,-16.5, 0,-12, 0, 1.2, 4.5);

  // Chapel entrance arch
  mkBox(3.5,5.5,.6,0xc4b47a,-2,2.75,-17.5);
  mkBox(3.5,5.5,.6,0xc4b47a,2,2.75,-17.5);
  mkBox(7,1.6,.6,0xb8a870,0,5.8,-17.5);

  // Convent side wing
  mkBox(8,6,2,0xd0c088,-10,3,-17);
  for(var cw=0;cw<2;cw++)mkBox(1.2,1.6,.3,0x6688aa,-12+cw*4,4,-15.5);
  mkBox(8,1.4,2,0xc0b078,-10,6.7,-17);

  // ‚îÄ‚îÄ Garden of San Damiano ‚îÄ‚îÄ
  // Garden path ‚Äî golden evening light
  mkBox(3.5,.1,22,0xbb9a55,0,.05,-7);
  mkBox(.25,.18,22,0xa88840,-1.75,.09,-7);
  mkBox(.25,.18,22,0xa88840,1.75,.09,-7);

  // ‚îÄ‚îÄ The great setting sun disc ‚îÄ‚îÄ
  var sunMat=new THREE.MeshBasicMaterial({color:0xff8800,transparent:true,opacity:.8,side:THREE.DoubleSide});
  var sun=new THREE.Mesh(new THREE.CircleGeometry(12,24),sunMat);
  sun.position.set(-60,32,-75);sun.rotation.y=.5;addS(sun);
  // Sun corona rings
  for(var sc=0;sc<3;sc++){
    var scm=new THREE.Mesh(new THREE.RingGeometry(12+sc*3,12+sc*3+1.5,24),
      new THREE.MeshBasicMaterial({color:0xff6600,transparent:true,opacity:.25-sc*.07,side:THREE.DoubleSide}));
    scm.position.set(-60,32,-75);scm.rotation.y=.5;addS(scm);
  }
  var sunGlow=new THREE.PointLight(0xff8800,1.8,120);sunGlow.position.set(-50,30,-65);sunGlow.userData.glow=true;addS(sunGlow);

  // ‚îÄ‚îÄ Portiuncula chapel silhouette on horizon ‚îÄ‚îÄ
  mkBox(5,4,.5,0x4a2a00,25,2,-55);
  mkBox(3,2,.5,0x3a1a00,25,5.5,-55);
  var pCross=new THREE.Mesh(new THREE.BoxGeometry(.15,2,.15),
    new THREE.MeshBasicMaterial({color:0x3a1a00}));pCross.position.set(25,7.5,-55);addS(pCross);

  // ‚îÄ‚îÄ Wildflowers in the garden ‚îÄ‚îÄ
  var fc=[0xff4466,0xff8844,0xffee44,0xee44aa,0xff6688,0xffffff,0xffaa44];
  for(var fl=0;fl<28;fl++){
    var flx=(Math.random()-.5)*18,flz=(Math.random()-.5)*14-6;
    if(Math.abs(flx)<3.5&&flz<-13)continue; // keep chapel path clear
    mkBox(.1,.65+Math.random()*.25,.1,0x3a7a1a,flx,.33,flz);
    mkSph(.2+Math.random()*.08,4,3,fc[fl%7],flx,1,flz);
  }

  // ‚îÄ‚îÄ Olive trees ‚Äî casting long evening shadows ‚îÄ‚îÄ
  var olivePositions=[[-9,-5],[-6,-12],[-12,-10],[8,-7],[10,-14],[7,-3],[14,-5]];
  olivePositions.forEach(function(op){
    var ox=op[0],oz=op[1];
    mkBox(.45,4,.45,0x5a3a18,ox,2,oz);
    mkSph(2.8+Math.random()*.6,7,5,0x5a7a20+(Math.floor(Math.random()*3))*0x050500,ox,5.5,oz);
  });

  // ‚îÄ‚îÄ Cypress trees ‚îÄ‚îÄ
  for(var cy=0;cy<6;cy++){
    var cyx=-20+cy*8,cyz=-14;
    mkBox(.5,7,.5,0x3a1a08,cyx,3.5,cyz);
    mkCone(1.3,10,6,0x1a4a0a,cyx,12,cyz);
  }

  // ‚îÄ‚îÄ Francis's reed bed (he dictated the Canticle here when ill) ‚îÄ‚îÄ
  mkBox(2.5,.35,1.4,0x8a6a30,-3,.18,3); // simple pallet
  mkBox(2.5,.08,1.4,0x4a6a1a,-3,.42,3); // reed mat

  // ‚îÄ‚îÄ Birds ‚Äî floating in sunset sky (end-game joy) ‚îÄ‚îÄ
  for(var b=0;b<16;b++){
    var bm=new THREE.Mesh(new THREE.ConeGeometry(.3,.2,4),
      new THREE.MeshLambertMaterial({color:0x664422}));
    bm.position.set((Math.random()-.5)*24,7+Math.random()*8,(Math.random()-.5)*18-8);
    bm.userData={phase:Math.random()*Math.PI*2,origY:bm.position.y};addS(bm);G.birds.push(bm);
  }

  // ‚îÄ‚îÄ Sister Clare ‚Äî will speak with Francis ‚îÄ‚îÄ
  var clare=mkNPC(0x8899cc,5,0,1);
  clare.userData.prompt='Speak with Sister Clare';
  clare.userData.dlgKey='canticle_scene';
  G.interactables.push(clare);
  // Brother Leo ‚Äî faithful companion
  var leo=mkNPC(0x8B5A2B,-5,0,2);leo.userData.prompt='';
  // Convent wall colliders
  addWallLine(-14,-22,14,-22,1.2); // chapel back
  addWall(-10,-17,4); addWall(10,-17,4); // side wings
  // Canticle collision
  addWallLine(-7,-22,7,-22,1.2); // chapel back
  addWall(-10,-17,4);addWall(10,-17,4); // side wings
  for(var _cp=0;_cp<7;_cp++) addWall(-20+_cp*8,-14,.65); // cypress trees
  for(var _op=0;_op<7;_op++) addWall([-9,-5,-6,-12,-12,-10,8,-7,10,-14,7,-3,14,-5][_op*2],[-9,-5,-6,-12,-12,-10,8,-7,10,-14,7,-3,14,-5][_op*2+1],.7);
  G.interactables.push({zone:true,x:0,z:-17,r:5,prompt:'Enter San Damiano and sing the Canticle of the Sun',action:'francisEnd'});
  setPos(0,7);setObj('Approach the chapel and sing the Canticle of the Sun.');hideProgress();
}

function bAnthonyFish(){
  // Rimini, Adriatic coast ‚Äî 1221. Heretics refuse to hear Anthony preach.
  // He turns to the sea and commands the fish, who rise and bow their heads.
  mkFog(0x4488bb,35,100);mkAmb(0xaaccff,.58);mkHemi(0x4488bb,0x2a5a3a,.38);
  mkDir(0x88aaff,1.2,12,28,6);
  var rimLight=new THREE.DirectionalLight(0x66aadd,.35);rimLight.position.set(-14,20,-5);addS(rimLight);
  mkGnd(0x9a8a6a,100,100);
  // Sandy beach
  var beachMat=new THREE.MeshLambertMaterial({color:0xd4bc8a});
  var beach=new THREE.Mesh(new THREE.PlaneGeometry(60,16),beachMat);
  beach.rotation.x=-Math.PI/2;beach.position.set(0,.02,-22);addS(beach);
  // Adriatic sea
  var waterMat=new THREE.MeshLambertMaterial({color:0x1a66cc,emissive:new THREE.Color(0x001144),emissiveIntensity:.3,transparent:true,opacity:.88});
  var water=new THREE.Mesh(new THREE.PlaneGeometry(90,35,12,8),waterMat);
  water.rotation.x=-Math.PI/2;water.position.set(0,-.06,-36);addS(water);
  // Sea shimmer
  var shimMat=new THREE.MeshBasicMaterial({color:0x88ccff,transparent:true,opacity:.18});
  for(var sw=0;sw<8;sw++){
    var sm=new THREE.Mesh(new THREE.PlaneGeometry(4+Math.random()*3,1.2),shimMat);
    sm.rotation.x=-Math.PI/2;sm.position.set((Math.random()-.5)*50,.02,-30-Math.random()*10);addS(sm);
  }
  // Rocky cliffs on left ‚Äî away from player path
  for(var cl=0;cl<6;cl++){
    var chr=3+Math.random()*2.5;
    var cMesh=new THREE.Mesh(new THREE.DodecahedronGeometry(chr,0),
      new THREE.MeshLambertMaterial({color:0x887766-cl*0x040200}));
    cMesh.position.set(-18+cl*.5,(5+Math.random()*5)/2-1,-20-cl*2.5);
    cMesh.castShadow=true;addS(cMesh);
    addWall(-18+cl*.5,-20-cl*2.5,chr+.6);
  }
  // Stone dock
  mkBox(3,.4,12,0xaa9977,7,.2,-24);
  addWallLine(5.5,-18,5.5,-30,.6);addWallLine(8.5,-18,8.5,-30,.6);
  // Palm trees ‚Äî left side only, not blocking path
  for(var pt=0;pt<4;pt++){
    var ptx=-10-pt*3,ptz=-4+Math.sin(pt)*.8;
    var pth=4+Math.random()*1.5;
    mkBox(.35,pth,.35,0x5a3a18,ptx,pth/2,ptz);
    for(var pf=0;pf<4;pf++){
      var pfa=(pf/4)*Math.PI*2;
      mkCone(.8,2.5,4,0x2a7a1a,ptx+Math.cos(pfa)*1.2,pth+.8,ptz+Math.sin(pfa)*1.2);
    }
    addWall(ptx,ptz,.65);
  }
  // Distant Rimini roofline
  mkBox(10,6,2,0xd4c4a0,-28,3,-55);mkBox(4,10,2,0xd0c098,-26,5,-55);
  // Heretics (turning away, right side)
  for(var hc=0;hc<5;hc++) mkNPC(0x3355aa+hc*0x010100,6+hc*2,0,hc-1);
  // Anthony with raised arm
  var ant=new THREE.Group();tagObj(ant);
  var ab=new THREE.Mesh(new THREE.CylinderGeometry(.3,.42,1.1,8),mkMat(0x4a3a22));ab.position.y=.55;
  var ah=new THREE.Mesh(new THREE.SphereGeometry(.27,10,8),mkMat(0xDEB887));ah.position.y=1.35;
  var aArm=new THREE.Mesh(new THREE.BoxGeometry(.7,.18,.18),mkMat(0x4a3a22));aArm.position.set(-.6,.85+.8,.1);aArm.rotation.z=.6;
  ant.add(ab,ah,aArm);ant.position.set(0,0,-14);
  G.scene.add(ant);
  ant.userData={prompt:'Hear Anthony preach',dlgKey:'anthony_fish_intro'};
  G.interactables.push(ant);
  // Fish ‚Äî initially hidden under water
  var fishColors=[0xff6600,0x0088ff,0xff0088,0xffaa00,0x00aaff,0x88ff00,0xff4444,0x44ff88];
  for(var k=0;k<22;k++){
    var fm=new THREE.Mesh(new THREE.ConeGeometry(.28,.7,5),
      new THREE.MeshLambertMaterial({color:fishColors[k%8]}));
    fm.position.set((Math.random()-.5)*18,-.85,-22-Math.random()*10);
    fm.rotation.z=Math.PI/2;
    fm.userData={origY:-.85,phase:Math.random()*Math.PI*2,risen:false};
    addS(fm);G.birds.push(fm);
  }
  G.interactables.push({zone:true,x:0,z:-20,r:5,prompt:'Walk to the water\'s edge ‚Äî PRAY',action:'anthonyFish'});
  setPos(0,5);setObj('Walk to the shore and call to the fish.');hideProgress();
}

function bAnthonyChild(){
  // Padua, Anthony\'s cell ‚Äî night. The Christ Child appears while Anthony reads scripture.
  mkFog(0x0a0818,14,45);mkAmb(0x221144,.38);mkHemi(0x0a0818,0x040408,.18);
  mkDir(0x7766bb,.55,4,14,4);
  // Stone floor
  var sMat=new THREE.MeshLambertMaterial({color:0x5a4a3a});
  var fl=new THREE.Mesh(new THREE.PlaneGeometry(10,9),sMat);fl.rotation.x=-Math.PI/2;fl.position.y=.01;addS(fl);
  // Walls ‚Äî solid collision
  mkBox(.5,5,9,0x4a3a2a,-5,2.5,-.5);mkBox(.5,5,9,0x4a3a2a,5,2.5,-.5);
  mkBox(10,5,.5,0x4a3a2a,0,2.5,-4.5);
  addWallLine(-5,-4.5,5,-4.5,.8);addWallLine(-5,-4.5,-5,4.5,.8);addWallLine(5,-4.5,5,4.5,.8);
  // Stone vault ribs
  for(var vc=0;vc<3;vc++){
    var vRib=new THREE.Mesh(new THREE.BoxGeometry(10,.2,.2),new THREE.MeshLambertMaterial({color:0x3a2a1a}));
    vRib.position.set(0,4.8,-1.5+vc*1.5);addS(vRib);
  }
  // Wooden desk with scripture
  mkBox(2.8,.2,1.8,0x5a3a18,0,.9,-3);
  for(var dl=0;dl<4;dl++){
    var dlx=(dl%2===0?-1:1)*.95,dlz=(dl<2?-2.2:-3.8);
    mkBox(.18,.8,.18,0x4a2808,dlx,.5,dlz);
  }
  mkBox(1.4,.12,1.6,0xf0e0c0,0,1.08,-3); // open book
  mkBox(.25,.25,.25,0x2a1a08,1.2,1.08,-2.3); // inkwell
  addWall(0,-3,1.8);
  // Three candles
  for(var cc=0;cc<3;cc++){
    var ccx=-1+cc;
    mkBox(.12,.7,.12,0xeeeebb,ccx,.85,-2.1);
    mkSph(.1,5,4,0xffdd88,ccx,1.58,-2.1);
    var cgl=new THREE.PointLight(0xffcc77,1.2,7);cgl.position.set(ccx,2,-2.1);cgl.userData.glow=true;addS(cgl);
  }
  // Kneeler
  mkBox(1.8,.35,1,0x5a3a18,0,.18,1.2);mkBox(1.8,.25,.25,0x4a2808,0,.52,1.65);
  // Cross on wall
  mkBox(.12,2,.12,0x4a2808,0,3.5,-4.88);mkBox(1,.12,.12,0x4a2808,0,4.5,-4.88);
  // Moonlight window
  var winMat=new THREE.MeshBasicMaterial({color:0x8899cc,transparent:true,opacity:.35});
  var win=new THREE.Mesh(new THREE.PlaneGeometry(.9,.9),winMat);
  win.position.set(4.88,3.5,-1);win.rotation.y=-Math.PI/2;addS(win);
  var moonBeam=new THREE.PointLight(0x8899cc,.6,10);moonBeam.position.set(3.5,3,-1);addS(moonBeam);
  // Kneeling zone
  G.interactables.push({zone:true,x:0,z:1.2,r:2,prompt:'Kneel and open your heart in prayer',action:'anthonyChild'});
  setPos(0,4);setObj('Enter the cell and kneel in prayer.');hideProgress();
}

function bAnthonyMule(){
  // Bourges, France ‚Äî c.1220. The heretic Bononillo challenges Anthony.
  // A mule starved 3 days kneels before the Blessed Sacrament, ignoring oats.
  mkFog(0x9999bb,30,90);mkAmb(0xfff0dd,.62);mkHemi(0x99aacc,0x554433,.38);
  mkDir(0xffeedd,1.3,14,30,10);
  mkGnd(0x8b7355,80,80);
  // Paved square cobblestones
  for(var i=0;i<8;i++) for(var j=0;j<8;j++)
    mkBox(3+Math.random()*.2,.09,3,i+j%2===0?0x9a8870:0x8a7860,(i-3.5)*3.2,.02,(j-3.5)*3.2-5);
  // City Hall facade
  mkBox(18,10,2.5,0xc8b090,0,5,-24);mkBox(18,2.5,2.5,0x8b4513,0,11.25,-24);
  for(var ww=0;ww<5;ww++){
    mkBox(2,3.5,.4,0x4466aa,-8+ww*4,4.5,-23);
    mkBox(2.4,.4,.4,0x7799cc,-8+ww*4,7,-23);
  }
  mkBox(3.5,3.5,.4,0x2244aa,0,8,-23); // rose window
  // Towers
  for(var tw=0;tw<2;tw++){
    var twx=(tw===0?-8:8);
    mkBox(4,14,4,0xd0c0a0,twx,7,-22);addWall(twx,-22,2.5);
  }
  // Side buildings with collision
  mkBox(3,9,16,0xd4c4a0,-14,4.5,-16);mkBox(3,9,16,0xd4c4a0,14,4.5,-16);
  addWallLine(-15.5,-8,-15.5,-24,1.5);addWallLine(15.5,-8,15.5,-24,1.5);
  addWallLine(-15.5,-24,15.5,-24,1.5);
  // Fountain ‚Äî collision obstacle
  mkBox(3,.5,3,0xbbaa88,0,.25,-10);
  var fMat=new THREE.MeshLambertMaterial({color:0x66aacc,transparent:true,opacity:.75});
  var fw=new THREE.Mesh(new THREE.CylinderGeometry(.9,.9,.15,12),fMat);fw.position.set(0,.55,-10);addS(fw);
  mkBox(.18,1.2,.18,0xaaa088,0,.9,-10);
  var fLight=new THREE.PointLight(0x88aaff,.5,7);fLight.position.set(0,2,-10);addS(fLight);
  addWall(0,-10,1.8);
  // Debate platform
  mkBox(5.5,1.2,5.5,0x887766,0,.6,-13);mkBox(5.8,.3,5.8,0x998877,0,1.25,-13);
  mkBox(5.6,.15,.15,0x776655,0,1.95,-10.3);mkBox(5.6,.15,.15,0x776655,0,1.95,-15.7);
  for(var rp=0;rp<6;rp++){
    mkBox(.12,1.5,.12,0x776655,-2.5+rp,.7,-10.3);
    mkBox(.12,1.5,.12,0x776655,-2.5+rp,.7,-15.7);
  }
  addRamp(0,-14.5, 0,-11.5, 0, 1.2, 2.5);
  // Crowd ‚Äî no NPCs inside the clear zone (r~5 around 0,-12)
  var ccols=[0x445566,0x886644,0x664422,0x226644,0x554433,0x334455,0x775533,0x447755];
  for(var cn=0;cn<50;cn++){
    var cnx=(Math.random()-.5)*22,cnz=4+Math.random()*14;
    var npcM=new THREE.Mesh(new THREE.CylinderGeometry(.28,.38,.9,6),mkMat(ccols[cn%8]));
    npcM.position.set(cnx,.45,cnz);addS(npcM);
    var nh=new THREE.Mesh(new THREE.SphereGeometry(.22,6,5),mkMat(0xDEB887));
    nh.position.set(cnx,1.15,cnz);addS(nh);
  }
  // Heretic Bononillo
  var bon=mkNPC(0x222255,-5,0,-12);
  bon.userData.prompt="Listen to the heretic\'s challenge";bon.userData.dlgKey='anthony_mule_intro';
  G.interactables.push(bon);
  // Detailed mule
  var muleGrp=new THREE.Group();tagObj(muleGrp);
  var mbody=new THREE.Mesh(new THREE.BoxGeometry(2.2,.95,3.8),mkMat(0x887755));mbody.position.set(0,.95,0);
  var mneck=new THREE.Mesh(new THREE.BoxGeometry(.6,.9,.7),mkMat(0x776644));mneck.position.set(0,1.75,1.6);
  var mhead=new THREE.Mesh(new THREE.BoxGeometry(.55,.55,.95),mkMat(0x776644));mhead.position.set(0,1.45,2.1);
  var me1=new THREE.Mesh(new THREE.BoxGeometry(.12,.45,.12),mkMat(0x887755));me1.position.set(-.18,1.95,2.1);
  var me2=me1.clone();me2.position.set(.18,1.95,2.1);
  [[-0.7,-1.2],[-0.7,1.2],[0.7,-1.2],[0.7,1.2]].forEach(function(lp){
    var leg=new THREE.Mesh(new THREE.BoxGeometry(.32,.85,.32),mkMat(0x776644));leg.position.set(lp[0],.42,lp[1]);muleGrp.add(leg);
  });
  muleGrp.add(mbody,mneck,mhead,me1,me2);muleGrp.position.set(5,0,-14);
  G.scene.add(muleGrp);addWall(5,-14,1.5);
  mkBox(1.8,.18,1,0xcc9922,7,.09,-14); // oats ignored by mule
  // Monstrance ‚Äî radiating gold
  var monMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffbb00),emissiveIntensity:1.0});
  var monBase=new THREE.Mesh(new THREE.CylinderGeometry(.5,.6,.4,8),monMat);monBase.position.set(0,1.65,-13);addS(monBase);
  var monStem=new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,1.2,6),monMat);monStem.position.set(0,2.25,-13);addS(monStem);
  var monHead=new THREE.Mesh(new THREE.SphereGeometry(.45,8,8),monMat);monHead.position.set(0,2.9,-13);addS(monHead);
  var monVert=new THREE.Mesh(new THREE.BoxGeometry(.08,2,.08),monMat);monVert.position.set(0,1.65,-13);addS(monVert);
  var monGlow=new THREE.PointLight(0xffd700,2.8,16);monGlow.position.set(0,3.2,-13);monGlow.userData.glow=true;addS(monGlow);
  monHead.userData={prompt:'Hold up the Blessed Sacrament ‚Äî PRAY',action:'anthonyMule'};
  G.interactables.push(monHead);
  setPos(0,6);setObj('Hold up the Blessed Sacrament before the heretic\'s mule.');hideProgress();
}

function bAnthonyRaise(){
  // Lisbon, c.1218. Anthony raises a murder victim to testify for his accused father.
  mkFog(0x7799aa,28,85);mkAmb(0xaaccdd,.58);mkHemi(0x8899aa,0x334433,.32);
  mkDir(0x99bbcc,.95,10,24,8);
  mkGnd(0x5a7a60,80,80);
  // Cloister garth ‚Äî inner garden lawn
  mkBox(14,.15,14,0x4a8a40,0,.08,-7);
  // Cloister arcade columns ‚Äî solid collision
  var colPositions=[[-9,-2],[-5,-2],[-1,-2],[3,-2],[-9,-6],[-9,-10],[3,-6],[3,-10]];
  colPositions.forEach(function(ac){
    mkBox(.65,5.5,.65,0xd4c4a0,ac[0],2.75,ac[1]);
    mkBox(.9,.4,.9,0xccc0a0,ac[0],5.55,ac[1]);
    addWall(ac[0],ac[1],.6);
  });
  // Arches between columns
  for(var ar=0;ar<3;ar++) mkBox(3.8,.45,.45,0xd4c4a0,-7+ar*4,5.35,-2);
  // Cloister outer walls
  mkBox(.6,7,18,0xc8b890,-12,3.5,-6);mkBox(.6,7,18,0xc8b890,4,3.5,-6);
  mkBox(18,7,.6,0xc8b890,-4,3.5,-14);
  addWallLine(-12,-14,4,-14,1.2);addWallLine(-12,-14,-12,4,1.2);addWallLine(4,-14,4,4,1.2);
  // Garden well ‚Äî solid
  mkBox(1.6,.6,1.6,0xbbaa88,-3,.3,-7);
  var fMat2=new THREE.MeshLambertMaterial({color:0x66aacc,transparent:true,opacity:.7});
  var fw2=new THREE.Mesh(new THREE.CylinderGeometry(.6,.6,.15,10),fMat2);fw2.position.set(-3,.75,-7);addS(fw2);
  addWall(-3,-7,1.2);
  // Garden shrubs ‚Äî away from path and grave
  for(var gs=0;gs<10;gs++){
    var gsx=(Math.random()-.5)*9-3,gsz=-4+(Math.random()-.5)*8;
    if(Math.sqrt((gsx+3)*(gsx+3)+(gsz+7)*(gsz+7))<2.5) continue;
    if(Math.abs(gsx)<1.5&&gsz<-10) continue;
    mkBox(.25,.7+Math.random()*.3,.25,0x2a6a1a,gsx,.35,gsz);
  }
  // Grave mound and cross ‚Äî placed inside cloister garden
  mkBox(2,.35,3.8,0x6b5a40,0,.18,-11);
  mkBox(2.2,.06,4,0x4a3a28,0,.06,-11);
  mkBox(.15,1.5,.15,0x5a3a1a,0,1.08,-11);mkBox(.95,.15,.15,0x5a3a1a,0,1.72,-11);
  var graveGlow=new THREE.PointLight(0xffffcc,.5,10);graveGlow.position.set(0,1.6,-11);addS(graveGlow);
  // Tribunal bench ‚Äî moved inside cloister on right side
  mkBox(5.5,.85,1.8,0xaaaaaa,2,2,-6);mkBox(5.5,.3,1.8,0x999999,2,2.98,-6);
  for(var bg=0;bg<3;bg++) mkBox(1.5,3,.3,0x9a9090,.5+bg*1.5,1.5,-5.2);
  mkNPC(0x223355,1,0,-6);mkNPC(0x223355,3,0,-6);
  // Martino ‚Äî kneeling, bound wrists
  var martino=new THREE.Group();tagObj(martino);
  var mb2=new THREE.Mesh(new THREE.CylinderGeometry(.3,.42,1.1,7),mkMat(0x886644));mb2.position.y=.55;
  var mh2=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),mkMat(0xDEB887));mh2.position.y=1.35;
  var mbw=new THREE.Mesh(new THREE.BoxGeometry(.55,.12,.3),mkMat(0xaa9988));mbw.position.set(0,.95,.3);
  martino.add(mb2,mh2,mbw);martino.position.set(-2,0,-12);martino.rotation.x=.28;
  G.scene.add(martino);
  martino.userData={prompt:'Speak with Martino',dlgKey:'anthony_raise_intro'};
  G.interactables.push(martino);
  // Witnesses ‚Äî inside cloister, clear of walls
  var witPos=[[-7,-2],[-5,0],[-3,-4],[-1,2]];
  witPos.forEach(function(wp){mkNPC(0x334455,wp[0],0,wp[1]);});
  // Grave zone
  G.interactables.push({zone:true,x:0,z:-11,r:3.5,prompt:'Pray at the grave ‚Äî PRAY',action:'anthonyRaise'});
  setPos(0,5);setObj('Walk to the grave and call upon God to vindicate the innocent.');hideProgress();
}

function bAnthonyPadua(){
  // Padua, Prato della Valle ‚Äî June 13, 1231. Anthony\'s last great sermon.
  // 30,000 gathered beneath a blazing Italian sky.
  mkFog(0x88aacc,38,105);mkAmb(0xffeedd,.6);mkHemi(0x88aacc,0x3a5a3a,.42);
  mkDir(0xffd0aa,1.3,20,35,14);
  mkGnd(0x5a8040,110,110);
  // Padua Basilica on horizon ‚Äî Romanesque-Byzantine silhouette
  mkBox(20,10,3,0xd4c4a0,0,5,-58);mkBox(8,14,3,0xd4c4a0,0,7,-58);
  for(var pd=0;pd<3;pd++){
    var pdx=-8+pd*8;
    var dome=new THREE.Mesh(new THREE.SphereGeometry(3.5,8,6),
      new THREE.MeshLambertMaterial({color:0x2244aa}));
    dome.scale.y=.6;dome.position.set(pdx,14.5,-58);addS(dome);
  }
  mkBox(4,20,3,0xccc0a0,-12,10,-58);mkBox(4,20,3,0xccc0a0,12,10,-58);
  for(var dh=0;dh<6;dh++) mkSph(15+dh*2,6,4,0x3a6a30,(dh-2.5)*22,-8,-68);
  // Prato oval outline stones
  for(var pr=0;pr<16;pr++){
    var pra=(pr/16)*Math.PI*2;
    mkBox(.8,.5,.8,0x9a8a78,Math.cos(pra)*34,.25,Math.sin(pra)*34-18);
  }
  // Moat canal hint
  var canalMat=new THREE.MeshLambertMaterial({color:0x2266aa,transparent:true,opacity:.7});
  for(var cv=0;cv<20;cv++){
    var cva=(cv/20)*Math.PI*2,cvr=30;
    var csm=new THREE.Mesh(new THREE.BoxGeometry(3,.1,3),canalMat);
    csm.position.set(Math.cos(cva)*cvr,.05,Math.sin(cva)*cvr-18);addS(csm);
  }
  // Pulpit ‚Äî stone open-air ambo
  mkBox(4.5,1.5,4.5,0x887766,-10,.75,-5);mkBox(5,.35,5,0x998877,-10,1.55,-5);
  for(var rp=0;rp<4;rp++){
    mkBox(.12,1.6,.12,0x776655,-11.7+rp*.8,1.55,-2.8);
    mkBox(.12,1.6,.12,0x776655,-11.7+rp*.8,1.55,-7.2);
  }
  mkBox(3.6,.15,.15,0x776655,-10,3.0,-2.8);mkBox(3.6,.15,.15,0x776655,-10,3.0,-7.2);
  addRamp(-13,-3.5,-7,-3.5, 0, 1.55, 1.0);
  addWallLine(-13,-2.5,-7,-2.5,.8);addWallLine(-13,-7.5,-7,-7.5,.8);
  addWall(-10,-5,1.2);
  // Lectern
  mkBox(1,.05,.8,0x5a3818,-10,1.6,-3.5);mkBox(.08,1.2,.08,0x4a2808,-10,.95,-3.5);
  // Anthony on pulpit ‚Äî arms raised
  var anthony=new THREE.Group();tagObj(anthony);
  var ab2=new THREE.Mesh(new THREE.CylinderGeometry(.32,.44,1.15,8),mkMat(0x4a3a22));ab2.position.y=1.55+.575;
  var ah2=new THREE.Mesh(new THREE.SphereGeometry(.27,10,8),mkMat(0xDEB887));ah2.position.y=1.55+1.35;
  var arm1=new THREE.Mesh(new THREE.BoxGeometry(.8,.2,.2),mkMat(0x4a3a22));
  arm1.position.set(-.8,1.55+1.1,0);arm1.rotation.z=.7;
  var arm2=arm1.clone();arm2.position.set(.8,1.55+1.1,0);arm2.rotation.z=-.7;
  anthony.add(ab2,ah2,arm1,arm2);anthony.position.set(-10,0,-5);
  G.scene.add(anthony);
  // Vast crowd ‚Äî 80 cone stand-ins + 8 NPCs
  var ccols=[0x556677,0x886644,0x664422,0x226644,0x554433,0x334455,0x775533,0x447755];
  for(var n=0;n<80;n++){
    var nx=(Math.random()-.5)*55,nz=5+Math.random()*32;
    var npcM=new THREE.Mesh(new THREE.CylinderGeometry(.25+Math.random()*.08,.35,.85+Math.random()*.2,5),mkMat(ccols[n%8]));
    npcM.position.set(nx,.42,nz);addS(npcM);
    if(n%4===0){var nh=new THREE.Mesh(new THREE.SphereGeometry(.2,5,4),mkMat(0xDEB887));nh.position.set(nx,1.1,nz);addS(nh);}
  }
  for(var fm2=0;fm2<8;fm2++) mkNPC(ccols[fm2%8],-6+fm2*2.5,0,5);
  // Market stalls (pilgrims)
  for(var st=0;st<4;st++){
    var stx=-14+st*9,stz=-2;
    mkBox(3,.1,1.5,0xaa8833,stx,.82,stz);
    mkBox(3,.06,1.8,0x884422+st*0x110000,stx,2.1,stz+.2);
    mkBox(.08,2.2,.08,0x885522,stx-1.4,1.1,stz+.8);mkBox(.08,2.2,.08,0x885522,stx+1.4,1.1,stz+.8);
    addWall(stx,stz,.9);
  }
  G.interactables.push({zone:true,x:-10,z:-3,r:4.5,prompt:'Ascend to the pulpit ‚Äî PRAY',action:'anthonyPadua'});
  setPos(0,7);setObj('Walk to the pulpit and preach to the thirty thousand.');hideProgress();
}

function bClareSaracen(){
  // San Damiano, Assisi ‚Äî 1240. Frederick II\'s Saracen mercenaries scale the walls.
  // Clare, ill and feeble, rises from her sickbed and carries the Blessed Sacrament to the gate.
  mkFog(0x223344,22,75);mkAmb(0x556677,.45);mkHemi(0x223344,0x0a1a0a,.25);
  mkDir(0x99aacc,.75,-10,22,8);
  mkGnd(0x6a6050,90,90);
  // Night sky
  G.scene.background=new THREE.Color(0x0a0f1e);
  var sv2=[];for(var ss=0;ss<500;ss++)sv2.push((Math.random()-.5)*180,18+Math.random()*60,(Math.random()-.5)*180);
  var sg2=new THREE.BufferGeometry();sg2.setAttribute('position',new THREE.Float32BufferAttribute(sv2,3));
  addS(new THREE.Points(sg2,new THREE.PointsMaterial({color:0xffffff,size:.22,transparent:true,opacity:.8})));
  // Monastery walls ‚Äî solid
  mkBox(30,8,.8,0xc8b89a,0,4,-20);
  mkBox(.8,8,22,0xc8b89a,-15,4,-9);mkBox(.8,8,22,0xc8b89a,15,4,-9);
  addWallLine(-15,-20,15,-20,1.2);addWallLine(-15,-20,-15,2,1.2);addWallLine(15,-20,15,2,1.2);
  // Gate arch
  mkBox(3,7,.8,0xb8a880,-4.5,3.5,-20);mkBox(3,7,.8,0xb8a880,4.5,3.5,-20);
  mkBox(10,2,.8,0xa09870,0,7.5,-20);
  // Wall torches
  for(var wt=0;wt<4;wt++){
    var wtx=-12+wt*8;
    mkBox(.2,.7,.2,0x9a6622,wtx,6.5,-19.5);mkSph(.17,5,4,0xff8822,wtx,7.2,-19.5);
    var wtl=new THREE.PointLight(0xff9933,1.8,12);wtl.position.set(wtx,8,-20);wtl.userData.glow=true;addS(wtl);
  }
  // Saracen soldiers ‚Äî threatening at the wall
  for(var i=0;i<10;i++){
    var sx=-18+i*4;
    mkNPC(0x992222+Math.floor(Math.random()*3)*0x001100,sx,0,-22);
  }
  // Stones/debris at base of wall ‚Äî AWAY from the action path
  for(var j=0;j<8;j++){
    var jx=(Math.random()-.5)*24,jz=(Math.random()-.5)*8-16;
    if(Math.abs(jx)<4&&jz>-18) continue;
    mkBox(1+Math.random(),.8,1+Math.random(),0x888877,jx,0.4,jz);
  }
  // Inner courtyard ‚Äî nuns watching
  for(var n2=0;n2<5;n2++) mkNPC(0x5566aa,-8+n2*4,0,-12);
  // Golden Monstrance on a stone plinth ‚Äî the weapon of Clare
  mkBox(1.2,.6,1.2,0xaaa088,0,.3,-6);
  var pMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffaa00),emissiveIntensity:.9});
  var pBase=new THREE.Mesh(new THREE.CylinderGeometry(.4,.5,.5,8),pMat);pBase.position.set(0,.9,-6);addS(pBase);
  var pStem=new THREE.Mesh(new THREE.CylinderGeometry(.1,.1,1,6),pMat);pStem.position.set(0,1.4,-6);addS(pStem);
  var pHead=new THREE.Mesh(new THREE.SphereGeometry(.4,8,8),pMat);pHead.position.set(0,2,-6);addS(pHead);
  var pGlow=new THREE.PointLight(0xffd700,2.5,12);pGlow.position.set(0,2.5,-6);pGlow.userData.glow=true;addS(pGlow);
  // Interaction zone ‚Äî walk to gate
  G.interactables.push({zone:true,x:0,z:-17,r:4,prompt:'Carry the Sacrament to the gate ‚Äî PRAY',action:'clareSaracen'});
  setPos(0,4);setObj('Carry the Blessed Sacrament to the gate and face the Saracens.');hideProgress();
}

function bClareChristmas(){
  // Assisi, San Damiano ‚Äî Christmas 1252. Clare is bedridden, too ill to attend Mass.
  // She miraculously sees and hears the Mass at Santa Maria degli Angeli miles away.
  mkFog(0x050810,10,35);mkAmb(0x112244,.35);mkHemi(0x050810,0x050505,.15);
  mkDir(0x4466aa,.5,3,12,3);
  // Stone floor ‚Äî convent bedroom
  var sMat=new THREE.MeshLambertMaterial({color:0x4a3a2a});
  var fl=new THREE.Mesh(new THREE.PlaneGeometry(14,12),sMat);fl.rotation.x=-Math.PI/2;fl.position.y=.01;addS(fl);
  mkBox(.5,5,12,0x3a2a1a,-7,2.5,0);mkBox(.5,5,12,0x3a2a1a,7,2.5,0);
  mkBox(14,5,.5,0x3a2a1a,0,2.5,-6);
  // Stone ceiling arch hints
  for(var ca=0;ca<3;ca++){
    var cArc=new THREE.Mesh(new THREE.BoxGeometry(14,.2,.2),new THREE.MeshLambertMaterial({color:0x2a1a0a}));
    cArc.position.set(0,4.8,-2+ca*2);addS(cArc);
  }
  // Clare\'s sickbed ‚Äî ornate for a princess-turned-nun
  mkBox(5,.5,2.8,0x5a3a6a,-3,.75,2);    // bedframe
  mkBox(5,.8,2.8,0x8855aa,-3,1.3,2);    // mattress
  mkBox(5,1.5,.3,0x6644aa,-3,2.1,3.2);  // headboard
  mkBox(5,.3,2.8,0x4433aa,-3,1.0,.5);   // footboard
  mkBox(2,.35,1.2,0xeeddff,-4.8,1.88,2.4); // pillow
  mkBox(2,.35,1.2,0xeeddff,-2.2,1.88,2.4);
  // Candle on bedside table
  mkBox(1.4,.4,1,0x5a3a18,1.8,.45,3);
  mkBox(.12,.7,.12,0xeeeebb,1.8,.85,3);mkSph(.1,5,4,0xffdd88,1.8,1.58,3);
  var cl2=new THREE.PointLight(0xffddaa,.9,8);cl2.position.set(1.8,2,3);cl2.userData.glow=true;addS(cl2);
  // Small altar opposite the bed
  mkBox(3,.8,1.5,0xd4c090,0,.65,-4.5);mkBox(3,.25,1.5,0xd0bc88,0,1.05,-4.5);
  // Cross on altar
  mkGlowBox(.15,2,.15,0xffd700,0xffdd00,.7, 0,1.8,-4.8);mkGlowBox(.9,.15,.15,0xffd700,0xffdd00,.7, 0,2.4,-4.8);
  var altGlow=new THREE.PointLight(0xffcc44,.8,7);altGlow.position.set(0,2.5,-4.8);altGlow.userData.glow=true;addS(altGlow);
  // Moonlight/frost through narrow window
  var winMat=new THREE.MeshBasicMaterial({color:0x8899cc,transparent:true,opacity:.4});
  var win=new THREE.Mesh(new THREE.PlaneGeometry(.7,1.2),winMat);win.position.set(-6.88,3.5,-1);win.rotation.y=Math.PI/2;addS(win);
  var moonL=new THREE.PointLight(0x99aacc,.5,10);moonL.position.set(-5,3,-1);addS(moonL);
  // Snow on window sill hint
  mkBox(.25,.15,1,0xeeeeff,-6.8,3,.8);
  // Praying zone ‚Äî beside the bed
  G.interactables.push({zone:true,x:-3,z:2,r:2.5,prompt:'Kneel and pray for the vision',action:'clareChristmas'});
  setPos(0,4);setObj('Kneel at the sickbed and pray for the Christmas vision.');hideProgress();
}

function bBonaventure(){
  // La Verna, Tuscan Apennines ‚Äî 1259. Bonaventure retreats to La Verna
  // where Francis received the Stigmata, seeking divine illumination for the Itinerarium.
  G.scene.background=new THREE.Color(0x080f28);
  G.scene.fog=new THREE.Fog(0x0c1535,22,85);
  mkAmb(0x1a2244,.42);mkHemi(0x0c1535,0x080808,.22);mkDir(0x8899cc,.7,-8,26,6);
  // Pre-dawn sky
  var sv3=[];for(var k=0;k<600;k++)sv3.push((Math.random()-.5)*220,15+Math.random()*90,(Math.random()-.5)*220);
  var sg3=new THREE.BufferGeometry();sg3.setAttribute('position',new THREE.Float32BufferAttribute(sv3,3));
  addS(new THREE.Points(sg3,new THREE.PointsMaterial({color:0xffffff,size:.28,transparent:true,opacity:.9})));
  // Moon
  var moonM=new THREE.Mesh(new THREE.CircleGeometry(2.2,14),new THREE.MeshBasicMaterial({color:0xe8e8cc,side:THREE.DoubleSide}));
  moonM.position.set(22,38,-60);moonM.rotation.y=.3;addS(moonM);
  // Dark Apennine ground
  var gndM=new THREE.MeshLambertMaterial({color:0x1e1810});
  var gnd=new THREE.Mesh(new THREE.PlaneGeometry(100,100),gndM);gnd.rotation.x=-Math.PI/2;gnd.receiveShadow=true;addS(gnd);
  // Mountain crags ‚Äî different cone arrangement from bLaVerna
  var rc=[0x4a3a2a,0x5a4a3a,0x3a2a1a,0x6a5a4a,0x2a1a0a,0x7a6a5a];
  for(var i=0;i<7;i++){
    var sz=5+i*2.8,soff=(i-3)*1.6;
    var mm=new THREE.Mesh(new THREE.ConeGeometry(sz,sz*1.7,6),new THREE.MeshLambertMaterial({color:rc[i%6]}));
    mm.position.set(soff,sz*.85-1,-22-i*2.5);mm.castShadow=true;addS(mm);
  }
  // Side boulders ‚Äî keep path (|x|<2) clear
  for(var b2=0;b2<12;b2++){
    var bx2=(b2%2===0?1:-1)*(4+Math.random()*9),bz2=-(b2*3.5)-2;
    var bs2=.8+Math.random()*1.6;
    var bMesh2=new THREE.Mesh(new THREE.DodecahedronGeometry(bs2,0),new THREE.MeshLambertMaterial({color:0x3a2a18}));
    bMesh2.position.set(bx2,bs2*.5,bz2);bMesh2.rotation.set(Math.random(),Math.random(),Math.random());
    addS(bMesh2);addWall(bx2,bz2,bs2+.5);
  }
  // Ascending stone path with walkable ramp
  for(var j=0;j<12;j++){
    var stepY=j*.32,stepZ=-j*2.2-1;
    mkBox(3.5-j*.1,.3,1.3,0x7a6a58+j*0x020200,0,stepY+.15,stepZ);
  }
  addRamp(0,2, 0,-26, 0, 3.84, 2.5);
  // Bonaventure\'s cell ‚Äî small stone oratory
  mkBox(5,.3,4.5,0x7a6a58,0,3.84,-20);
  mkBox(5,4,.5,0x7a6a58,0,6,-22.4);
  mkBox(.5,4,4.5,0x7a6a58,-2.5,6,-20);mkBox(.5,4,4.5,0x7a6a58,2.5,6,-20);
  mkBox(.5,4,.5,0x6a5a48,-1.5,5.5,-17.7);mkBox(.5,4,.5,0x6a5a48,1.5,5.5,-17.7);
  mkBox(3,.8,.5,0x6a5a48,0,7.8,-17.7);
  // Writing desk inside cell
  mkBox(2,.18,1.4,0x5a3818,0,4,-20.5);mkBox(1.2,.1,1,0xf0e0c0,0,4.2,-20.5);
  var dkl=new THREE.PointLight(0xffcc77,.7,4);dkl.position.set(.5,5,-20);dkl.userData.glow=true;addS(dkl);
  // THE CROSS ‚Äî elevated and radiating
  var gMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffcc00),emissiveIntensity:1.2});
  var vCr=new THREE.Mesh(new THREE.BoxGeometry(.3,5.5,.3),gMat);vCr.position.set(0,18.5,-20);addS(vCr);
  var hCr=new THREE.Mesh(new THREE.BoxGeometry(3.4,.3,.3),gMat);hCr.position.set(0,20.6,-20);addS(hCr);
  var gl=new THREE.PointLight(0xffd700,3.5,24);gl.position.set(0,20,-20);gl.userData.glow=true;addS(gl);
  var gl2=new THREE.PointLight(0xffaa00,1.5,42);gl2.position.set(0,16,-20);gl2.userData.glow=true;addS(gl2);
  // Seraph emanating from cross (Itinerarium vision)
  var sfMat=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:.1});
  var sfBody=new THREE.Mesh(new THREE.SphereGeometry(.8,8,6),sfMat);sfBody.position.set(0,24,-20);addS(sfBody);
  var sfGlow=new THREE.PointLight(0xffffff,1.0,18);sfGlow.position.set(0,24,-20);sfGlow.userData.glow=true;addS(sfGlow);
  G.interactables.push({zone:true,x:0,z:-20,r:4,prompt:'Receive the mystical vision',action:'bonaVision'});
  setPos(0,5);setObj('Ascend La Verna and receive the mystical vision.');hideProgress();
}

function bElizRoses(){
  // Wartburg Castle, Thuringia ‚Äî winter 1226. Elizabeth secretly gives food to the poor.
  // Her husband Ludwig intercepts her at the gate. She opens her cloak: only roses.
  mkFog(0x99aabb,32,95);mkAmb(0xddeeff,.52);mkHemi(0x8899bb,0x3a5a3a,.36);
  mkDir(0xddeeff,1.0,10,24,8);
  mkGnd(0xffffff,95,95); // snow-covered ground
  // Snow texture on ground
  var snowMat=new THREE.MeshLambertMaterial({color:0xeeeeff});
  var snow=new THREE.Mesh(new THREE.PlaneGeometry(95,95),snowMat);snow.rotation.x=-Math.PI/2;snow.position.y=.02;addS(snow);
  // Snow drifts
  for(var sd=0;sd<10;sd++){
    var sds=new THREE.Mesh(new THREE.SphereGeometry(1.5+Math.random()*1.5,7,5),snowMat);
    sds.scale.y=.2+Math.random()*.15;
    sds.position.set((Math.random()-.5)*30,.1,(Math.random()-.5)*20);addS(sds);
  }
  // Castle walls ‚Äî Wartburg style Romanesque
  mkBox(26,10,.9,0xc8c0b0,0,5,-24); // back wall
  mkBox(.9,10,26,0xc8c0b0,-13,5,-11); // left wall
  mkBox(.9,10,26,0xc8c0b0,13,5,-11); // right wall
  addWallLine(-13,-24,13,-24,1.2);addWallLine(-13,-24,-13,2,1.2);addWallLine(13,-24,13,2,1.2);
  // Round towers at corners
  for(var tw=0;tw<2;tw++){
    var twx=(tw===0?-10:10);
    var tMesh=new THREE.Mesh(new THREE.CylinderGeometry(2.5,2.5,14,10),new THREE.MeshLambertMaterial({color:0xd0c8b8}));
    tMesh.position.set(twx,7,-22);addS(tMesh);addWall(twx,-22,2.8);
    // Tower cap (conical roof)
    mkCone(3,5,10,0x8b3a3a,twx,15.5,-22);
    // Arrow slit
    mkBox(.25,1.2,.3,0x555544,twx,7,-19.7);
  }
  // Gate arch ‚Äî portcullis
  mkBox(8,9,.9,0xc8c0b0,0,4.5,-24); // open gate space already cut
  mkBox(3,7,.9,0xb8b0a0,-4.5,3.5,-24);mkBox(3,7,.9,0xb8b0a0,4.5,3.5,-24);
  mkBox(10,2,.9,0xa8a090,0,8,-24);
  for(var pg=0;pg<5;pg++) mkBox(.18,6,.3,0x3a3028,-4+pg*2,5,-23.5);
  // Castle keep (main tower) in background
  mkBox(8,18,8,0xccc0a8,0,9,-30);mkBox(9,.6,9,0xbbb09a,0,18.3,-30);
  for(var bt2=0;bt2<4;bt2++){
    mkBox(1.5,2,1.5,0xbbb09a,(bt2<2?-3.8:3.8),19.5,(bt2%2===0?-26.2:-33.8));
  }
  // Castle hall windows with warm light
  for(var hw=0;hw<3;hw++) mkBox(1.4,2,.3,0xffd866+hw*0x001100,-4+hw*4,10,-22);
  var warmL=new THREE.PointLight(0xffaa44,.8,16);warmL.position.set(0,10,-22);addS(warmL);
  // Bare winter trees ‚Äî columns of snow-laden branches
  var treePos=[[-18,-8],[-16,-14],[-18,-18],[16,-6],[18,-12],[16,-18],[-8,-6],[8,-5]];
  treePos.forEach(function(tp){
    mkBox(.4,5,.4,0x3a2a14,tp[0],2.5,tp[1]);
    // Bare branches
    for(var br=0;br<4;br++){
      var ba=(br/4)*Math.PI*2,bl=2+Math.random()*1.5;
      mkBox(bl,.2,.2,0x3a2a14,tp[0]+Math.cos(ba)*bl*.5,5,tp[1]+Math.sin(ba)*bl*.5);
    }
    // Snow on branches
    mkSph(1.2+Math.random()*.4,6,4,0xeeeeff,tp[0],5.5,tp[1]);
    addWall(tp[0],tp[1],.65);
  });
  // Poor folk at the gate path ‚Äî receiving alms
  var pCols=[0x556677,0x665544,0x447766,0x334455,0x553322];
  for(var p=0;p<5;p++) mkNPC(pCols[p%5],(p-2)*4.5,0,-16);
  // Ludwig ‚Äî imposing, blocking the gate
  var ludwig=mkNPC(0x884422,0,0,-20);
  ludwig.userData.prompt='Ludwig blocks your way ‚Äî PRAY';
  ludwig.userData.action='elizRoses';
  G.interactables.push(ludwig);
  setPos(0,5);setObj('Carry your gift south to the gate. Face Ludwig and pray.');hideProgress();
}

function bElizLeper(){
  // Marburg, Thuringia ‚Äî c.1226. Elizabeth places a leper in her own marital bed.
  // Ludwig enters in fury, pulls back the covers: the face of Christ looks back at him.
  mkFog(0x0c0818,12,38);mkAmb(0x223344,.42);mkHemi(0x0c0818,0x050508,.18);
  mkDir(0x556688,.65,3,14,3);
  // Ornate stone floor ‚Äî Romanesque
  var fMat=new THREE.MeshLambertMaterial({color:0x4a3a2a});
  var fl=new THREE.Mesh(new THREE.PlaneGeometry(14,12),fMat);fl.rotation.x=-Math.PI/2;fl.position.y=.01;addS(fl);
  // Tile pattern suggestion
  for(var tp=0;tp<12;tp++) mkBox(2.2,.06,2.2,tp%2===0?0x5a4a3a:0x4a3a2a,(tp%4-1.5)*2.8,.04,(Math.floor(tp/4)-1)*2.8);
  // Stone walls ‚Äî solid, arched ceiling
  mkBox(.5,5.5,12,0x3a2a18,-7,2.75,0);mkBox(.5,5.5,12,0x3a2a18,7,2.75,0);
  mkBox(14,5.5,.5,0x3a2a18,0,2.75,-6);
  addWallLine(-7,-6,7,-6,.9);addWallLine(-7,-6,-7,6,.9);addWallLine(7,-6,7,6,.9);
  // Ceiling arch ‚Äî stone vault
  for(var ca=0;ca<3;ca++){
    var cArc2=new THREE.Mesh(new THREE.BoxGeometry(14,.2,.2),new THREE.MeshLambertMaterial({color:0x2a1a0a}));
    cArc2.position.set(0,5.2,-2+ca*2);addS(cArc2);
  }
  // Ornate marital bed ‚Äî royal colours
  mkBox(5.5,.5,3.5,0x5a3a5a,-1.5,.75,1.5);    // frame
  mkBox(5.5,.9,3.5,0x884488,-1.5,1.3,1.5);    // mattress
  mkBox(5.5,1.8,.3,0x662266,-1.5,2.1,3.2);    // headboard
  mkBox(5.5,.3,3.5,0x441144,-1.5,1.0,.5);     // footboard
  mkBox(2,.35,1.2,0xddc0ff,-3.2,1.88,2.5);    // pillow L
  mkBox(2,.35,1.2,0xddc0ff,-1.0,1.88,2.5);    // pillow R
  mkBox(5.5,.08,3.5,0x6633aa,-1.5,1.68,1.5);  // bed cover (purple)
  addWall(-1.5,1.5,3.2);
  // Leper figure in bed ‚Äî wrapped in linen
  var leper=new THREE.Group();
  var lbody=new THREE.Mesh(new THREE.BoxGeometry(4,.5,2),mkMat(0xccccbb));lbody.position.set(0,1.78,1.5);
  var lhead=new THREE.Mesh(new THREE.SphereGeometry(.28,8,7),mkMat(0xaa9988));lhead.position.set(-1.5,2.2,1.5);
  var lbandage=new THREE.Mesh(new THREE.BoxGeometry(.55,.15,.55),mkMat(0xddddcc));lbandage.position.set(-1.5,2.38,1.5);
  leper.add(lbody,lhead,lbandage);
  leper.userData.prompt='Tend to the sick man';leper.userData.action='elizLeper';
  addS(leper);G.interactables.push(leper);
  // Bedside table with candelabra
  mkBox(1.6,.45,1.2,0x5a3a18,3.5,.48,2.5);
  for(var cv=0;cv<2;cv++){
    var cvx=3.2+cv*.6;
    mkBox(.1,.8,.1,0xeeeebb,cvx,.9,2.5);mkSph(.09,5,4,0xffdd88,cvx,1.73,2.5);
    var cvl=new THREE.PointLight(0xffddaa,.9,8);cvl.position.set(cvx,2.2,2.5);cvl.userData.glow=true;addS(cvl);
  }
  // Tapestry on wall ‚Äî suggests wealth
  mkBox(4.5,3.5,.12,0x663366,-3.5,3.5,-5.85);
  mkBox(4.3,.2,.12,0x885588,-3.5,5.4,-5.85);
  // Small prie-dieu / prayer kneeler
  mkBox(1.8,.35,1,0x5a3a18,4,.18,-3);mkBox(1.8,.25,.25,0x4a2808,4,.52,-2.6);
  // Cross on wall
  mkBox(.12,2.2,.12,0x5a3a18,4.88,3.5,-1);mkBox(1.2,.12,.12,0x5a3a18,4.88,4.5,-1);
  var crossL=new THREE.PointLight(0xffcc44,.4,6);crossL.position.set(4.5,4,-1);addS(crossL);
  setPos(0,4);setObj('Approach the sick man and care for him in the name of Christ.');hideProgress();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚îÄ‚îÄ PADRE PIO EXTENDED STAGES ‚îÄ‚îÄ
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function bPioFirstMass(){
  // Pietrelcina, August 10 1910. Padre Pio celebrates his first solemn Mass
  // at the church of Sant'Anna. His family fills the pews. He falls into ecstasy.
  mkFog(0x332211,14,48);mkAmb(0xfff8e8,.62);mkHemi(0x442200,0x0a0505,.25);
  mkDir(0xffeecc,1.1,8,20,5);
  var sideLight=new THREE.DirectionalLight(0xff9944,.4);sideLight.position.set(7,12,2);addS(sideLight);
  mkGnd(0x5a4a38,32,32);
  // ‚îÄ‚îÄ Sant'Anna, Pietrelcina ‚Äî Romanesque village church ‚îÄ‚îÄ
  // Stone floor
  var flMat=new THREE.MeshLambertMaterial({color:0x6a5a4a});
  var fl=new THREE.Mesh(new THREE.PlaneGeometry(14,12),flMat);fl.rotation.x=-Math.PI/2;fl.position.y=.01;addS(fl);
  // Nave walls
  mkBox(.5,8,12,0xaa9988,-7,4,0);mkBox(.5,8,12,0xaa9988,7,4,0);
  mkBox(14,8,.5,0xaa9988,0,4,-6);mkBox(14,8,.5,0x998877,0,4,6);
  addWallLine(-7,-6,-7,6,1.0);addWallLine(7,-6,7,6,1.0);addWallLine(-7,-6,7,-6,1.0);
  // Stone barrel vault ‚Äî series of arches
  for(var vb=0;vb<5;vb++){
    var vRib=new THREE.Mesh(new THREE.BoxGeometry(14,.22,.22),new THREE.MeshLambertMaterial({color:0x887766}));
    vRib.position.set(0,7.8,-3+vb*2);addS(vRib);
  }
  // Painted apse semi-dome suggestion
  mkBox(10,6,1,0x9988cc,0,5.5,-5.6);
  var apseFresco=new THREE.MeshLambertMaterial({color:0x7788cc,emissive:new THREE.Color(0x112244),emissiveIntensity:.3});
  var apseSemi=new THREE.Mesh(new THREE.SphereGeometry(4.8,8,5,0,Math.PI),apseFresco);apseSemi.position.set(0,7,-5.6);addS(apseSemi);
  // ‚îÄ‚îÄ High Altar ‚Äî richly adorned ‚îÄ‚îÄ
  mkBox(5,.95,2,0xffffff,0,.47,-4.8);mkBox(5,.22,2,0xeeeef8,0,1.06,-4.8);
  // Altar frontal cloth (embroidered white/gold)
  mkBox(5,.8,.1,0xffe8aa,0,.45,-3.85);mkBox(5,.08,.1,0xffd700,0,.9,-3.85);
  // Altar candles ‚Äî 6 tall
  for(var ac=0;ac<6;ac++){
    var acx=-2.2+ac*.9;
    mkBox(.1,1.4,.1,0xffffff,acx,.78,-4.5);
    mkSph(.09,5,4,0xffee88,acx,2.22,-4.5);
    var acl=new THREE.PointLight(0xffdd88,.55,5);acl.position.set(acx,2.6,-4.5);addS(acl);
  }
  // Tabernacle ‚Äî golden box in centre
  var tabMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xaa8800),emissiveIntensity:.5});
  var tab=new THREE.Mesh(new THREE.BoxGeometry(.7,1,.5),tabMat);tab.position.set(0,1.7,-4.8);addS(tab);
  mkBox(.3,.3,.3,0xffd700,0,2.26,-4.8); // tabernacle top
  var tabGlow=new THREE.PointLight(0xffd700,1.5,8);tabGlow.position.set(0,2.2,-4.6);tabGlow.userData.glow=true;addS(tabGlow);
  // Crucifix above altar
  mkBox(.16,2.6,.16,0x6b4320,0,4.2,-5.3);mkBox(1.1,.16,.16,0x6b4320,0,5.5,-5.3);
  var corpus=new THREE.Mesh(new THREE.SphereGeometry(.18,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));corpus.position.set(0,5.5,-5.35);addS(corpus);
  // ‚îÄ‚îÄ Communion rail (Communion railing) ‚îÄ‚îÄ
  mkBox(10,.55,.2,0xd4c090,0,.28,-2.8);
  for(var rp=0;rp<8;rp++) mkBox(.1,1.4,.1,0xc4a870,-4.2+rp*1.2,.28,-2.8);
  // ‚îÄ‚îÄ Pews ‚Äî two rows ‚îÄ‚îÄ
  for(var pw=0;pw<4;pw++){
    mkBox(4.5,.45,1,0x7a4a2a,-2.5+pw%2*.2,.22,pw<2?-1.2+pw*.5:-.2+pw*.4);
    mkBox(4.5,.9,.18,0x6a3a1a,-2.5+pw%2*.2,1.02,pw<2?-.75+pw*.5:.2+pw*.4);
  }
  // ‚îÄ‚îÄ Family congregation ‚Äî seated ‚îÄ‚îÄ
  var famCols=[0x886644,0x664422,0x778866,0x557788,0x665533];
  var famPos=[[-3,1.5],[3,1.5],[-3,.5],[3,.5],[-2,2.5],[2,2.5],[0,3],[0,1.5]];
  famPos.forEach(function(fp,i){
    mkNPC(famCols[i%5],fp[0],0,fp[1]);
  });
  // ‚îÄ‚îÄ Side windows ‚Äî coloured glass effect ‚îÄ‚îÄ
  var glassColors=[0x2244cc,0x44aa22,0xcc4422,0x2299aa];
  for(var gw=0;gw<4;gw++){
    var gwx=(gw%2===0)?-6.88:6.88, gwz=-2+(gw>>1)*3;
    var wMat=new THREE.MeshBasicMaterial({color:glassColors[gw],transparent:true,opacity:.45});
    var wMesh=new THREE.Mesh(new THREE.PlaneGeometry(.7,1.4),wMat);wMesh.position.set(gwx,4.5,gwz);wMesh.rotation.y=(gw%2===0)?Math.PI/2:-Math.PI/2;addS(wMesh);
    var wLight=new THREE.PointLight(glassColors[gw],.4,7);wLight.position.set(gwx*.7,4.5,gwz);addS(wLight);
  }
  // Morning sunbeam (east side)
  var beamMat=new THREE.MeshBasicMaterial({color:0xffeecc,transparent:true,opacity:.07});
  var beam=new THREE.Mesh(new THREE.PlaneGeometry(2,6),beamMat);beam.position.set(5,3.5,-1);beam.rotation.y=-.4;beam.rotation.x=.2;addS(beam);
  // Incense thurible ‚Äî swinging chain hint
  mkBox(.25,.25,.25,0xaa9944,0,3.5,-4);
  var thuGlow=new THREE.PointLight(0x88cc88,.4,5);thuGlow.position.set(0,3.5,-4);addS(thuGlow);
  // Pio at altar
  var pioGrp=new THREE.Group();tagObj(pioGrp);
  var pioBod=new THREE.Mesh(new THREE.CylinderGeometry(.32,.44,1.1,8),new THREE.MeshLambertMaterial({color:0xffffff}));pioBod.position.y=.55;
  var pioHd=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));pioHd.position.y=1.38;
  pioGrp.add(pioBod,pioHd);pioGrp.position.set(0,0,-4.5);G.scene.add(pioGrp);addWall(0,-4.5,.6);
  // Altar zone
  G.interactables.push({zone:true,x:0,z:-2.8,r:2.2,prompt:'Approach the altar rail ‚Äî PRAY',action:'pioFirstMass'});
  setPos(0,4);setObj('Approach the altar for your first solemn Mass.');hideProgress();
}

function bPioStigmata(){
  // San Giovanni Rotondo, September 20 1918. The permanent stigmata.
  // Padre Pio alone in the choir loft before a crucifix after Mass.
  mkFog(0x080412,12,38);mkAmb(0x1a0a22,.4);mkHemi(0x080412,0x030204,.18);
  mkDir(0x6655aa,.55,4,14,3);
  G.scene.background=new THREE.Color(0x040208);
  mkGnd(0x2a1a0a,30,30);
  // ‚îÄ‚îÄ Choir loft ‚Äî stone, old, intimate ‚îÄ‚îÄ
  var flMat2=new THREE.MeshLambertMaterial({color:0x3a2a1a});
  var fl2=new THREE.Mesh(new THREE.PlaneGeometry(12,10),flMat2);fl2.rotation.x=-Math.PI/2;fl2.position.y=.01;addS(fl2);
  mkBox(.5,6,10,0x3a2a16,-6,3,0);mkBox(.5,6,10,0x3a2a16,6,3,0);
  mkBox(12,6,.5,0x3a2a16,0,3,-5);mkBox(12,6,.5,0x2a1a0a,0,3,5);
  addWallLine(-6,-5,-6,5,1.1);addWallLine(6,-5,6,5,1.1);addWallLine(-6,-5,6,-5,1.1);
  // Carved stone vault ribs
  for(var vb=0;vb<6;vb++){
    var ribMat=new THREE.MeshLambertMaterial({color:0x2a1a0c});
    var rib=new THREE.Mesh(new THREE.BoxGeometry(12,.2,.2),ribMat);rib.position.set(0,5.8,-4+vb*1.8);addS(rib);
  }
  // ‚îÄ‚îÄ The San Damiano-style crucifix Pio prayed before ‚îÄ‚îÄ
  // Painted wood panel background
  var panMat=new THREE.MeshLambertMaterial({color:0x5a2a08,emissive:new THREE.Color(0x1a0400),emissiveIntensity:.25});
  var panel=new THREE.Mesh(new THREE.BoxGeometry(3.2,5.2,.22),panMat);panel.position.set(0,5.8,-4.88);addS(panel);
  // Gold border
  var goldMat=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xaa6600),emissiveIntensity:.6});
  var borderH=new THREE.Mesh(new THREE.BoxGeometry(3.4,.18,.18),goldMat);borderH.position.set(0,8.45,-4.82);addS(borderH);
  var borderB=borderH.clone();borderB.position.set(0,3.15,-4.82);addS(borderB);
  var borderL=new THREE.Mesh(new THREE.BoxGeometry(.18,5.4,.18),goldMat);borderL.position.set(-1.72,5.8,-4.82);addS(borderL);
  var borderR=borderL.clone();borderR.position.set(1.72,5.8,-4.82);addS(borderR);
  // Cross beams
  var xMat=new THREE.MeshLambertMaterial({color:0x8b4a10,emissive:new THREE.Color(0x3a1400),emissiveIntensity:.2});
  var xVert=new THREE.Mesh(new THREE.BoxGeometry(.32,5,.32),xMat);xVert.position.set(0,5.8,-4.72);addS(xVert);
  var xHorz=new THREE.Mesh(new THREE.BoxGeometry(2.6,.32,.32),xMat);xHorz.position.set(0,7.2,-4.72);addS(xHorz);
  // Christ figure ‚Äî more detailed
  var cMat=new THREE.MeshLambertMaterial({color:0xf0c080,emissive:new THREE.Color(0xdd8820),emissiveIntensity:.35});
  var cBody=new THREE.Mesh(new THREE.CylinderGeometry(.24,.3,1.0,7),cMat);cBody.position.set(0,5.9,-4.62);addS(cBody);
  var cHead=new THREE.Mesh(new THREE.SphereGeometry(.22,8,7),cMat);cHead.position.set(0,6.72,-4.62);addS(cHead);
  var cArmL=new THREE.Mesh(new THREE.BoxGeometry(.8,.2,.18),cMat);cArmL.position.set(-.7,6.15,-4.62);cArmL.rotation.z=.15;addS(cArmL);
  var cArmR=cArmL.clone();cArmR.position.set(.7,6.15,-4.62);cArmR.rotation.z=-.15;addS(cArmR);
  // Supernatural light emanating from cross
  var cGl=new THREE.PointLight(0xffd700,3.2,20);cGl.position.set(0,6.8,-4.5);cGl.userData.glow=true;addS(cGl);
  var cGl2=new THREE.PointLight(0xff8800,1.2,32);cGl2.position.set(0,5.5,-3.5);cGl2.userData.glow=true;addS(cGl2);
  var cGl3=new THREE.PointLight(0xffffff,.5,12);cGl3.position.set(0,7.5,-4);addS(cGl3);
  // ‚îÄ‚îÄ Altar rail ‚îÄ‚îÄ
  mkBox(10,.55,.22,0x5a3818,0,.28,-3.2);
  for(var rp=0;rp<7;rp++) mkBox(.1,1.4,.1,0x4a2808,-3+rp,0.28,-3.2);
  // Choir stalls ‚Äî wooden benches along sides
  for(var cs2=0;cs2<3;cs2++){
    mkBox(1.2,2.4,.9,0x4a2a08,-5.5,.5,-1.5+cs2*1.5);
    mkBox(1.2,2.4,.9,0x4a2a08,5.5,.5,-1.5+cs2*1.5);
  }
  // Candles ‚Äî pair flanking cross
  for(var cc=0;cc<2;cc++){
    var ccx=(cc===0)?-3:3;
    mkBox(.14,1.2,.14,0xffffff,ccx,.85,-4.2);mkSph(.11,5,4,0xffee88,ccx,2.1,-4.2);
    var cgl3=new THREE.PointLight(0xffcc88,1.0,8);cgl3.position.set(ccx,2.5,-4.2);cgl3.userData.glow=true;addS(cgl3);
  }
  // Kneeler and prayer book
  mkBox(2.2,.38,1.2,0x3a1a08,0,.19,-1.8);mkBox(2.2,.22,.28,0x4a2a08,0,.5,-1.2);
  mkBox(.8,.1,.6,0xf0e0cc,0,.62,-1.8);
  // Incense smoke wisps
  for(var iw=0;iw<5;iw++){
    var iwm=new THREE.Mesh(new THREE.SphereGeometry(.06,4,3),new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:.14}));
    iwm.position.set(-1+iw*.5,3.5+iw*.3,-4);addS(iwm);
  }
  G.interactables.push({zone:true,x:0,z:-1.8,r:2.5,prompt:'Kneel before the Crucifix ‚Äî PRAY',action:'pioStigmata'});
  setPos(0,3);setObj('Approach the crucifix and kneel in prayer.');hideProgress();
}

function bPioConfessional(){
  // San Giovanni Rotondo ‚Äî the famous confessional corridor, 1920s-1960s.
  // People wait for hours, days. Pio's confessional is a place of transformation.
  mkFog(0x100810,10,38);mkAmb(0x222230,.48);mkHemi(0x100810,0x060308,.18);
  mkDir(0x8888aa,.6,5,16,4);
  mkGnd(0x4a3a2a,32,32);
  // ‚îÄ‚îÄ Long corridor of Santa Maria delle Grazie ‚îÄ‚îÄ
  var cflMat=new THREE.MeshLambertMaterial({color:0x5a4a3a});
  var cfl=new THREE.Mesh(new THREE.PlaneGeometry(9,20),cflMat);cfl.rotation.x=-Math.PI/2;cfl.position.y=.01;addS(cfl);
  mkBox(.5,6,20,0x6a5848,-4.5,3,0);mkBox(.5,6,20,0x6a5848,4.5,3,0);
  mkBox(9,6,.5,0x6a5848,0,3,-10);mkBox(9,6,.5,0x5a4838,0,3,10);
  addWallLine(-4.5,-10,-4.5,10,1.0);addWallLine(4.5,-10,4.5,10,1.0);addWallLine(-4.5,-10,4.5,-10,1.0);
  // Stone barrel vault
  for(var vb=0;vb<8;vb++){
    var rv=new THREE.Mesh(new THREE.BoxGeometry(9,.2,.2),new THREE.MeshLambertMaterial({color:0x3a2820}));
    rv.position.set(0,5.6,-7+vb*2);addS(rv);
  }
  // ‚îÄ‚îÄ The confessional ‚Äî three-panelled wooden structure ‚îÄ‚îÄ
  // Left kneeling compartment
  mkBox(1.6,4.8,1.5,0x3a1a04,-2.2,2.4,-7.5);
  // Centre priest's box (slightly taller)
  mkBox(1.6,5.5,1.5,0x2a1202,0,2.75,-7.5);
  // Right kneeling compartment
  mkBox(1.6,4.8,1.5,0x3a1a04,2.2,2.4,-7.5);
  // Top cornice
  mkBox(5.6,.4,1.6,0x2a1000,0,5.25,-7.5);
  // Cross atop confessional
  mkBox(.1,1,.1,0x5a3010,0,5.7,-7.4);mkBox(.55,.1,.1,0x5a3010,0,6.12,-7.4);
  // Mesh screen dividers (dark thin panels)
  mkBox(.06,3.2,1.2,0x150a00,-1.1,3.4,-8.1);mkBox(.06,3.2,1.2,0x150a00,1.1,3.4,-8.1);
  // Kneelers outside confessional
  mkBox(1.4,.28,.6,0x7a5030,2.2,.14,-6.4);mkBox(1.4,.28,.6,0x7a5030,-2.2,.14,-6.4);
  // Pio silhouette inside centre box
  var pioSil=mkNPC(0x1a0a02,0,0,-8);addWall(0,-7.5,.5);
  // ‚îÄ‚îÄ Long queue of waiting penitents ‚îÄ‚îÄ
  var pcols=[0x556677,0x774433,0x446633,0x665544,0x557755,0x443355,0x776644,0x445566,0x887744,0x554477];
  var queuePos=[[3.2,-7],[3.2,-5.5],[3.2,-4],[3.2,-2.5],[3.2,-1],[3.2,.5],[3.2,2],[3.2,3.5],[-3.2,2.5],[-3.2,1]];
  queuePos.forEach(function(qp,i){mkNPC(pcols[i%10],qp[0],0,qp[1]);});
  // ‚îÄ‚îÄ Candlelit atmosphere ‚Äî wall sconces ‚îÄ‚îÄ
  for(var wc=0;wc<6;wc++){
    var wcs=wc%2===0?-4.2:4.2,wcz=-6+wc*2.5;
    mkBox(.14,.55,.14,0xffffcc,wcs,.78+Math.random()*.1,wcz);
    mkSph(.1,5,4,0xffee88,wcs,1.4,wcz);
    var wl=new THREE.PointLight(0xffcc88,.7,8);wl.position.set(wcs,1.8,wcz);wl.userData.glow=true;addS(wl);
  }
  // Wall icons/paintings (rectangular placeholders)
  for(var ic=0;ic<4;ic++){
    mkBox(1.2,1.6,.1,0x8877aa+(ic*0x050000),(ic%2===0?-4.25:4.25),3.5,-4+ic*3);
    var icl=new THREE.PointLight(0xffeecc,.35,4);icl.position.set((ic%2===0?-3.8:3.8),3.5,-4+ic*3);addS(icl);
  }
  // Kneeling zone
  G.interactables.push({zone:true,x:2.2,z:-6.4,r:2,prompt:'Kneel at the confessional',action:'pioConfessional'});
  setPos(0,4);setObj('Join the queue and approach Padre Pio\'s confessional.');hideProgress();
}

function bPioBilocation(){
  // Armistice night, 1918. A military command tent near the front.
  // General Luigi Cadorna, dismissed in disgrace, is on the verge of suicide.
  // Padre Pio appears to him ‚Äî 500 miles away in San Giovanni Rotondo.
  mkFog(0x040610,8,30);mkAmb(0x0a1020,.42);mkHemi(0x040610,0x020204,.14);
  mkDir(0x3355aa,.5,4,14,2);
  G.scene.background=new THREE.Color(0x020408);
  mkGnd(0x3a3020,28,28);
  // ‚îÄ‚îÄ Military command tent ‚îÄ‚îÄ
  // Canvas floor panel
  mkBox(11,.18,9,0x4a4030,0,.09,0);
  // Tent walls ‚Äî slanting inward
  mkBox(11,5,.3,0x4a4030,0,2.5,-4.5);mkBox(11,5,.3,0x3a3020,0,2.5,4.5);
  mkBox(.3,5,9,0x4a4030,-5.5,2.5,0);mkBox(.3,5,9,0x4a4030,5.5,2.5,0);
  // Tent roof ridge
  mkBox(.18,1.5,.18,0x6a5a40,0,5.9,0);
  mkBox(11.2,.18,.18,0x5a4a30,0,5.5,-4.3);mkBox(11.2,.18,.18,0x5a4a30,0,5.5,4.3);
  // ‚îÄ‚îÄ Field command table ‚îÄ‚îÄ
  mkBox(3.2,.65,1.8,0x5a3a1a,0,.33,-1.5);mkBox(3.2,.07,1.8,0x7a5830,0,.67,-1.5);
  // Maps and papers
  mkBox(2.2,.06,1.3,0xf0e0c0,-.4,.7,-1.5);mkBox(1,.06,.8,0xeeddaa,.8,.7,-1.8);
  // Military insignia box
  mkBox(.4,.4,.3,0x4a3a20,1.2,.7,-.8);
  // Oil lamp ‚Äî warm guttering glow
  mkBox(.18,.5,.18,0xaa8833,0,1.0,-1.5);mkSph(.14,6,5,0xffcc44,0,1.55,-1.5);
  var lamp=new THREE.PointLight(0xff9944,2.2,12);lamp.position.set(0,2,-1.5);lamp.userData.glow=true;addS(lamp);
  // Table legs
  for(var tl=0;tl<4;tl++){mkBox(.12,.65,.12,0x4a2808,(tl<2?-1.4:1.4),.33,(tl%2===0?-.75:.75)-1.5);}
  // General's folding chair
  mkBox(1.2,.55,.9,0x4a2a0a,-1.5,.28,-1.5);mkBox(1.2,2,.14,0x3a1a00,-1.5,1.55,-1.0);
  mkBox(.18,2,.18,0x3a1a00,-2.1,1.55,-1.0);mkBox(.18,2,.18,0x3a1a00,-.9,1.55,-1.0);
  // ‚îÄ‚îÄ General Cadorna ‚Äî seated, head bowed in despair ‚îÄ‚îÄ
  var gen=new THREE.Group();tagObj(gen);
  var gbody=new THREE.Mesh(new THREE.CylinderGeometry(.32,.44,1.12,8),new THREE.MeshLambertMaterial({color:0x223355}));gbody.position.y=.55+.56;
  var ghead=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));ghead.position.y=.55+1.38;
  var ghat=new THREE.Mesh(new THREE.CylinderGeometry(.28,.3,.25,8),new THREE.MeshLambertMaterial({color:0x1a2233}));ghat.position.y=.55+1.72;
  gen.add(gbody,ghead,ghat);gen.position.set(-1.5,0,-1.5);gen.rotation.x=.35; // head bowed
  G.scene.add(gen);gen.userData={prompt:'Approach the General'};G.interactables.push(gen);
  // ‚îÄ‚îÄ Surrounding soldiers ‚Äî shadows ‚îÄ‚îÄ
  var solCols=[0x334455,0x223344,0x445566];
  for(var so=0;so<5;so++) mkNPC(solCols[so%3],-4+so*2,0,2+Math.sin(so)*.5);
  // ‚îÄ‚îÄ Stars visible through tent opening ‚îÄ‚îÄ
  for(var st3=0;st3<20;st3++){
    var sm=new THREE.Mesh(new THREE.SphereGeometry(.05,4,3),new THREE.MeshBasicMaterial({color:0xffffff}));
    sm.position.set((Math.random()-.5)*10,4.2+Math.random()*1.2,(Math.random()-.5)*6);addS(sm);
  }
  // Pio bilocation figure ‚Äî faint, translucent glow on far side of tent
  var bioMat=new THREE.MeshLambertMaterial({color:0xffeedd,emissive:new THREE.Color(0x886644),emissiveIntensity:.5,transparent:true,opacity:.65});
  var bioBody=new THREE.Mesh(new THREE.CylinderGeometry(.3,.4,.9,6),bioMat);bioBody.position.y=.45;
  var bioHead=new THREE.Mesh(new THREE.SphereGeometry(.24,7,6),bioMat);bioHead.position.y=1.12;
  var bioGrp=new THREE.Group();tagObj(bioGrp);bioGrp.add(bioBody,bioHead);bioGrp.position.set(2.5,0,-3.5);
  G.scene.add(bioGrp);
  var bioGlow=new THREE.PointLight(0xffeedd,.9,8);bioGlow.position.set(2.5,2,-3.5);bioGlow.userData.glow=true;addS(bioGlow);
  // Prayer zone
  G.interactables.push({zone:true,x:2,z:1,r:2.5,prompt:'Kneel and pray for the General ‚Äî PRAY',action:'pioBilocation'});
  setPos(0,4);setObj('Find General Cadorna and intercede for his soul.');hideProgress();
}

function bPioHealing(){
  // San Giovanni Rotondo, 1947. Seven-year-old Gemma di Giorgi ‚Äî born without pupils.
  // Her grandmother brings her to Padre Pio's Mass. He blesses her. She begins to see.
  mkFog(0x99aacc,30,90);mkAmb(0xfff8ee,.62);mkHemi(0x88aacc,0x3a5a3a,.4);
  mkDir(0xffeedd,1.25,16,32,10);
  var sideL=new THREE.DirectionalLight(0x99ccff,.35);sideL.position.set(-14,24,-6);addS(sideL);
  mkGnd(0x8a7a5a,90,90);
  // ‚îÄ‚îÄ Church of Santa Maria delle Grazie ‚Äî outdoor piazza ‚îÄ‚îÄ
  // Stone piazza floor (cobblestone pattern)
  for(var cp=0;cp<12;cp++)for(var cr2=0;cr2<8;cr2++){
    mkBox(1.8,.09,1.8,(cp+cr2)%2===0?0xaaa090:0x9a9080,(cp-5.5)*2,.045,(cr2-3.5)*2-5);
  }
  // Church facade ‚Äî Puglia Baroque style
  mkBox(18,11,2.8,0xddd0b0,0,5.5,-22);mkBox(8,6,2.8,0xd8cca8,0,12.5,-22);
  // Baroque facade decoration
  for(var fw=0;fw<5;fw++) mkBox(.4,8,.5,0xccc0a0,-8+fw*4,5.5,-20.4);
  for(var fw2=0;fw2<3;fw2++) mkBox(1.6,2.8,.4,0x4466aa,-4+fw2*4,4,-20.5);
  mkBox(3.5,3.5,.4,0x2244aa,0,9,-20.5); // rose window
  // Church door arch ‚Äî double
  mkBox(2.6,5.5,.5,0x9a8060,-2,2.75,-20);mkBox(2.6,5.5,.5,0x9a8060,2,2.75,-20);mkBox(5.5,1.5,.5,0xa09070,0,5.75,-20);
  // Carved tympanum
  mkBox(5.2,.4,.5,0xb0a080,0,7,-20);
  // Bell towers ‚Äî twin
  mkBox(4,20,4,0xd0c098,-12,10,-20);mkBox(4,20,4,0xd0c098,12,10,-20);
  for(var bt=0;bt<4;bt++){
    mkBox(1.2,1.8,1.2,0xc0b080,(bt<2?-13.5+bt*3:10.5+bt%2*3),(bt<2?20.5:20.5),-18+(bt%2)*4);
  }
  addWall(-12,-20,2.5);addWall(12,-20,2.5);
  // Church steps ‚Äî wide
  for(var cs=0;cs<4;cs++) mkBox(14,.3,1.2,0xcfbf90,0,.15+cs*.3,-18+cs*1.2);
  addRamp(0,-17.5,0,-14,0,1.2,6);
  // Courtyard walls
  addWallLine(-18,-26,18,-26,1.5);addWallLine(-18,-26,-18,5,1.5);addWallLine(18,-26,18,5,1.5);
  // ‚îÄ‚îÄ Crowd of pilgrims ‚Äî fixed positions away from interaction zone ‚îÄ‚îÄ
  var pCols=[0x556677,0x886644,0x664422,0x447766,0x885533];
  var pilgPos=[[-6,-4],[-8,-6],[6,-4],[8,-6],[-4,-10],[4,-10],[-6,-7],[6,-7],[-3,-5],[3,-5],[-8,-9],[8,-9],[-5,-12],[5,-12]];
  pilgPos.forEach(function(pp,i){mkNPC(pCols[i%5],pp[0],0,pp[1]);});
  // Friars near the door
  for(var fr=0;fr<3;fr++) mkNPC(0x2a1a08,-4+fr*4,0,-14);
  // ‚îÄ‚îÄ Gemma di Giorgi ‚Äî small child, eyes closed ‚îÄ‚îÄ
  var gemGrp=new THREE.Group();tagObj(gemGrp);
  var gemBod=new THREE.Mesh(new THREE.CylinderGeometry(.18,.26,.75,7),new THREE.MeshLambertMaterial({color:0xaabbcc}));gemBod.position.y=.38;
  var gemHd=new THREE.Mesh(new THREE.SphereGeometry(.18,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));gemHd.position.y=.98;
  gemGrp.add(gemBod,gemHd);gemGrp.position.set(-2,0,-7);
  G.scene.add(gemGrp);gemGrp.userData={prompt:'Pray for Gemma',dlgKey:'pio_healing_intro'};G.interactables.push(gemGrp);
  // Grandmother ‚Äî beside Gemma
  mkNPC(0x887766,-4,0,-7);
  // Padre Pio ‚Äî emerging from church after Mass, in white vestments
  var pioGrp2=new THREE.Group();tagObj(pioGrp2);
  var pioBod2=new THREE.Mesh(new THREE.CylinderGeometry(.3,.42,1.12,8),new THREE.MeshLambertMaterial({color:0xffffff}));pioBod2.position.y=.56;
  var pioHd2=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));pioHd2.position.y=1.38;
  // Mitts/gloves covering stigmata wounds
  var gloveMat=new THREE.MeshLambertMaterial({color:0x3a2808});
  var gloveL=new THREE.Mesh(new THREE.BoxGeometry(.22,.2,.35),gloveMat);gloveL.position.set(-.4,.55,.3);
  var gloveR=gloveL.clone();gloveR.position.set(.4,.55,.3);
  pioGrp2.add(pioBod2,pioHd2,gloveL,gloveR);pioGrp2.position.set(0,0,-14);
  G.scene.add(pioGrp2);addWall(0,-14,.8);
  // Healing zone
  G.interactables.push({zone:true,x:-2,z:-7,r:3,prompt:'Bring Gemma to Padre Pio ‚Äî PRAY',action:'pioHealing'});
  setPos(0,3);setObj('Bring the blind child Gemma to Padre Pio after Mass.');hideProgress();
}

function bPioCancer(){
  // San Giovanni Rotondo, Jan 25 1908. Giovanni Savino ‚Äî blind from cancer.
  // Padre Pio appears in a bilocation vision, lays his hands on Savino's eyes.
  mkFog(0x88aacc,30,95);mkAmb(0xffeedd,.62);mkHemi(0x88aacc,0x3a5a3a,.38);
  mkDir(0xffeecc,1.25,14,28,9);
  mkGnd(0x9a8a70,65,65);
  // ‚îÄ‚îÄ Church courtyard ‚Äî morning ‚îÄ‚îÄ
  // Cobbled plaza
  for(var pf=0;pf<8;pf++)for(var pr=0;pr<6;pr++)
    mkBox(2,.08,2,pf+pr%2===0?0xa09880:0x908870,(pf-3.5)*2,.04,(pr-2.5)*2-8);
  // Church facade
  mkBox(16,12,2.2,0xd4c4a0,0,6,-22);mkBox(8,4,2.2,0xccc0a0,0,14,-22);
  for(var cw=0;cw<2;cw++) mkBox(4,16,3,0xd0c0a0,(cw===0?-9:9),8,-20);
  // Windows + rose
  for(var cw2=0;cw2<3;cw2++) mkBox(1.6,2.8,.4,0x4466aa,-4+cw2*4,6,-20.2);
  mkBox(3.5,3.5,.4,0x2244aa,0,10.5,-20.2);
  // Church door
  mkBox(3.5,6,.5,0x6b4820,0,3,-20);mkBox(4,.55,.5,0xd4c4a0,0,6.3,-20);
  // Steps
  for(var s=0;s<4;s++) mkBox(7+s*.4,.28,1.1,0xccbb95,0,s*.28,-18.5+s*.9);
  addRamp(0,-18,0,-14.5,0,1.12,3.5);
  // Outer walls
  addWallLine(-18,-26,18,-26,1.4);addWallLine(-18,-26,-18,5,1.4);addWallLine(18,-26,18,5,1.4);
  // ‚îÄ‚îÄ Pilgrims at the church ‚Äî fixed positions ‚îÄ‚îÄ
  var pilgCols=[0x556677,0x778844,0x665533,0x447766,0x886644,0x334455,0x775544,0x447744];
  var pilgFixed=[[-7,-5],[-5,-8],[5,-5],[7,-8],[-6,-10],[6,-10],[-4,-4],[4,-4],[0,-11],[-8,-3],[8,-3],[-3,-6],[3,-6],[-9,-8],[9,-8]];
  pilgFixed.forEach(function(pp,i){mkNPC(pilgCols[i%8],pp[0],0,pp[1]);});
  // ‚îÄ‚îÄ Giovanni Savino ‚Äî bandaged eyes, on steps ‚îÄ‚îÄ
  var savino=new THREE.Group();tagObj(savino);
  var sbody=new THREE.Mesh(new THREE.CylinderGeometry(.3,.42,1.02,7),new THREE.MeshLambertMaterial({color:0x445566}));sbody.position.y=.51;
  var shead=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));shead.position.y=1.25;
  var sbandage=new THREE.Mesh(new THREE.BoxGeometry(.58,.14,.3),new THREE.MeshLambertMaterial({color:0xddddcc}));sbandage.position.set(0,1.3,.13);
  // Cane
  var cane=new THREE.Mesh(new THREE.BoxGeometry(.08,1.1,.08),new THREE.MeshLambertMaterial({color:0x5a3010}));cane.position.set(.4,.55,.2);
  savino.add(sbody,shead,sbandage,cane);savino.position.set(2,0,-16);
  G.scene.add(savino);
  savino.userData={prompt:'Lay hands on Giovanni Savino ‚Äî PRAY',action:'pioCancer'};G.interactables.push(savino);
  // Olive trees lining the piazza
  for(var ot=0;ot<5;ot++){
    var otx=-10+ot*5,otz=-5;
    mkBox(.4,3.5,.4,0x5a3a1a,otx,1.75,otz);mkSph(2.5,6,4,0x4a7030,otx,5,otz);
    addWall(otx,otz,.7);
  }
  setPos(0,3);setObj('Find Giovanni Savino on the church steps and pray over his eyes.');hideProgress();
}

function bPioFragrance(){
  // Pre-dawn, Capuchin friary cloister ‚Äî San Giovanni Rotondo, 1920s.
  // The fragrance of violets, roses, or tobacco precedes Pio's invisible presence.
  mkFog(0x040812,9,32);mkAmb(0x1a2234,.42);mkHemi(0x040812,0x020205,.12);
  mkDir(0x3a5588,.4,3,12,2);
  G.scene.background=new THREE.Color(0x020408);
  mkGnd(0x1a2018,32,32);
  // ‚îÄ‚îÄ Romanesque cloister ‚îÄ‚îÄ
  // Cloister garth (garden)
  var gMat=new THREE.MeshLambertMaterial({color:0x1a2812});
  var garth=new THREE.Mesh(new THREE.PlaneGeometry(16,16),gMat);garth.rotation.x=-Math.PI/2;garth.position.set(0,.01,-5);addS(garth);
  // Stone walk (ambulatory) surrounding the garden
  var walkMat=new THREE.MeshLambertMaterial({color:0x4a3a2a});
  var walkN=new THREE.Mesh(new THREE.PlaneGeometry(18,.9),walkMat);walkN.rotation.x=-Math.PI/2;walkN.position.set(0,.02,-13.5);addS(walkN);
  var walkS=walkN.clone();walkS.position.set(0,.02,3.5);addS(walkS);
  var walkE=new THREE.Mesh(new THREE.PlaneGeometry(18,.9),walkMat);walkE.rotation.x=-Math.PI/2;walkE.rotation.z=Math.PI/2;walkE.position.set(9,.02,-5);addS(walkE);
  var walkW=walkE.clone();walkW.position.set(-9,.02,-5);addS(walkW);
  // 12 Romanesque columns ‚Äî squat, rounded capitals
  for(var cp=0;cp<12;cp++){
    var ang=(cp/12)*Math.PI*2,rr=8.5;
    var cpx=Math.cos(ang)*rr,cpz=Math.sin(ang)*rr-5;
    mkBox(.52,5.5,.52,0x7a6a58,cpx,2.75,cpz);
    mkBox(.78,.52,.78,0x8a7a68,cpx,5.58,cpz);
    mkBox(.62,.38,.62,0x8a7a68,cpx,.19,cpz);
    addWall(cpx,cpz,.55);
  }
  // Arches between columns
  for(var ar=0;ar<12;ar++){
    var a1=(ar/12)*Math.PI*2,a2=((ar+1)/12)*Math.PI*2;
    var mx=(Math.cos(a1)+Math.cos(a2))/2*8.5,mz=(Math.sin(a1)+Math.sin(a2))/2*8.5-5;
    mkBox(4.6,.45,.38,0x7a6a58,mx,5.35,mz);
  }
  // Outer cloister walls
  mkBox(.5,7,18,0x6a5a48,-10.5,3.5,-5);mkBox(.5,7,18,0x6a5a48,10.5,3.5,-5);
  mkBox(22,7,.5,0x6a5a48,0,3.5,-14.5);mkBox(22,7,.5,0x5a4a38,0,3.5,4.5);
  // ‚îÄ‚îÄ Central garden ‚Äî formal layout ‚îÄ‚îÄ
  // Herb plots (long box partitions)
  for(var hb=0;hb<4;hb++){
    var hbx=(hb<2?-2.5:2.5),hbz=-3+hb%2*3.5;
    mkBox(4,.28,1.4,0x2a4a18,hbx,.14,hbz);
    // Low herbs/plants in each plot
    for(var hp=0;hp<4;hp++) mkBox(.25,.5+Math.random()*.2,.25,0x2a5a1a,hbx-1.5+hp,0.42,hbz);
  }
  // Stone cross in garden centre
  mkBox(.16,2,.16,0x7a6a58,0,1,-5);mkBox(1.2,.16,.16,0x7a6a58,0,1.82,-5);
  var crossGl=new THREE.PointLight(0x8899ff,.4,8);crossGl.position.set(0,2,-5);addS(crossGl);
  // Garden well
  mkBox(1.2,.9,1.2,0x8a7a60,4,.45,-5);mkBox(1.4,.22,1.4,0x9a8a70,4,1,-5);
  mkBox(.1,1.2,.1,0x5a3818,4,1.7,-5);mkBox(.7,.1,.12,0x5a3818,4,2.35,-5);
  addWall(4,-5,1.0);
  // ‚îÄ‚îÄ Stars ‚Äî dense pre-dawn sky ‚îÄ‚îÄ
  var sv4=[];for(var sk=0;sk<40;sk++)sv4.push((Math.random()-.5)*30,8+Math.random()*5,(Math.random()-.5)*30-5);
  var sg4=new THREE.BufferGeometry();sg4.setAttribute('position',new THREE.Float32BufferAttribute(sv4,3));
  addS(new THREE.Points(sg4,new THREE.PointsMaterial({color:0xffffff,size:.12,transparent:true,opacity:.9})));
  // ‚îÄ‚îÄ Padre Pio kneeling at stone prayer ledge ‚îÄ‚îÄ
  var pioFig=new THREE.Group();tagObj(pioFig);
  var pibody=new THREE.Mesh(new THREE.CylinderGeometry(.3,.4,.9,7),new THREE.MeshLambertMaterial({color:0x2a1a08}));pibody.position.y=.45;
  var pihead=new THREE.Mesh(new THREE.SphereGeometry(.24,7,6),new THREE.MeshLambertMaterial({color:0xDEB887}));pihead.position.y=1.1;
  pioFig.add(pibody,pihead);pioFig.position.set(-1,0,-7);pioFig.rotation.x=-.22;G.scene.add(pioFig);
  mkBox(2,.48,1.0,0x7a6a58,-1,.24,-8); // prayer ledge
  addWall(-1,-8,.7);
  // Faint warm light in a window (friary building)
  var winL=new THREE.PointLight(0xffcc77,.8,12);winL.position.set(9,4.5,2);addS(winL);
  var winM=new THREE.MeshBasicMaterial({color:0xffcc44,transparent:true,opacity:.3});
  var winMesh=new THREE.Mesh(new THREE.PlaneGeometry(.8,1.1),winM);winMesh.position.set(10.4,4.5,2);winMesh.rotation.y=-Math.PI/2;addS(winMesh);
  // Moonlight
  var moonL=new THREE.DirectionalLight(0x8899cc,.3);moonL.position.set(-8,30,-10);addS(moonL);
  var moonGl=new THREE.PointLight(0x8899cc,.2,30);moonGl.position.set(-8,18,-15);addS(moonGl);
  G.interactables.push({zone:true,x:0,z:-5,r:5.5,prompt:'Stand in the garden at dawn ‚Äî PRAY',action:'pioFragrance'});
  setPos(0,4);setObj('Enter the cloister garden and experience the fragrance of grace.');hideProgress();
}

function bPioAgony(){
  // San Giovanni Rotondo, September 22-23 1968. Padre Pio's last night.
  // He celebrates his last Mass, renews his vows, and dies peacefully in the sacristy.
  // On his deathbed the stigmata wounds have completely closed ‚Äî not even a scar.
  mkFog(0x060408,8,28);mkAmb(0x180a14,.5);mkHemi(0x060408,0x030203,.14);
  mkDir(0x3a2244,.42,2,12,2);
  G.scene.background=new THREE.Color(0x030206);
  mkGnd(0x2a1a1a,24,24);
  // ‚îÄ‚îÄ Sacristy of Santa Maria delle Grazie ‚îÄ‚îÄ
  var sflMat=new THREE.MeshLambertMaterial({color:0x2a1a18});
  var sfl=new THREE.Mesh(new THREE.PlaneGeometry(12,10),sflMat);sfl.rotation.x=-Math.PI/2;sfl.position.y=.01;addS(sfl);
  // Stone tile pattern
  for(var tp=0;tp<12;tp++) mkBox(2,.06,2,tp%2===0?0x3a2a1a:0x2a1a12,(tp%4-1.5)*2.4,.04,(Math.floor(tp/4)-1)*2.4);
  // Sacristy walls
  mkBox(.5,6.5,10,0x3a2818,-6,3.25,0);mkBox(.5,6.5,10,0x3a2818,6,3.25,0);
  mkBox(12,6.5,.5,0x3a2818,0,3.25,-5);mkBox(12,6.5,.5,0x2a1808,0,3.25,5);
  addWallLine(-6,-5,-6,5,1.0);addWallLine(6,-5,6,5,1.0);addWallLine(-6,-5,6,-5,1.0);
  // Vault ribs
  for(var vb=0;vb<4;vb++){
    var vrb=new THREE.Mesh(new THREE.BoxGeometry(12,.18,.18),new THREE.MeshLambertMaterial({color:0x241410}));
    vrb.position.set(0,6.2,-3.5+vb*2.2);addS(vrb);
  }
  // ‚îÄ‚îÄ Great sacristy crucifix ‚îÄ‚îÄ
  mkBox(.18,3.6,.18,0x3a1a00,0,4,-4.7);mkBox(1.8,.18,.18,0x3a1a00,0,5.9,-4.7);
  var crpFig=new THREE.Mesh(new THREE.SphereGeometry(.2,7,6),new THREE.MeshLambertMaterial({color:0xDEB887,emissive:new THREE.Color(0xffffff),emissiveIntensity:.18}));crpFig.position.set(0,5.88,-4.78);addS(crpFig);
  var crArm1=new THREE.Mesh(new THREE.BoxGeometry(.7,.18,.14),new THREE.MeshLambertMaterial({color:0xDEB887}));crArm1.position.set(-.55,5.65,-4.78);addS(crArm1);
  var crArm2=crArm1.clone();crArm2.position.set(.55,5.65,-4.78);addS(crArm2);
  // Red sanctuary lamps
  for(var rv=0;rv<3;rv++){
    var rvl=new THREE.PointLight(0xcc1100,.6,9);rvl.position.set(-2+rv*2,4.2,-3.8);addS(rvl);
    mkBox(.14,.4,.14,0x880000,-2+rv*2,3.9,-3.8);mkSph(.1,5,4,0xff2200,-2+rv*2,4.35,-3.8);
  }
  // Central sanctuary lamp
  var sancL=new THREE.PointLight(0xff3300,.5,5);sancL.position.set(0,4.5,-4.5);addS(sancL);
  // ‚îÄ‚îÄ Padre Pio's armchair ‚îÄ‚îÄ
  mkBox(1.4,.7,1.1,0x4a2808,-1,.35,-1.2);
  mkBox(.2,2.6,1.1,0x3a1800,-1.9,1.6,-1.2);
  mkBox(1.4,.24,.9,0x4a2808,-1,1.07,-.65);
  // Pio ‚Äî elderly, seated, face at peace
  var pioFig3=new THREE.Group();tagObj(pioFig3);
  var pb3=new THREE.Mesh(new THREE.CylinderGeometry(.33,.44,1.0,7),new THREE.MeshLambertMaterial({color:0x2a1a08}));pb3.position.y=.7+.5;
  var ph3=new THREE.Mesh(new THREE.SphereGeometry(.26,8,7),new THREE.MeshLambertMaterial({color:0xDEB887}));ph3.position.y=.7+1.22;
  // Beard
  var beard=new THREE.Mesh(new THREE.SphereGeometry(.14,6,5),new THREE.MeshLambertMaterial({color:0xaaaaaa}));beard.position.y=.7+.98;beard.position.z=.14;
  // Hands folded ‚Äî showing healed wounds
  var handMat=new THREE.MeshLambertMaterial({color:0xDEB887,emissive:new THREE.Color(0xffffff),emissiveIntensity:.15});
  var handL=new THREE.Mesh(new THREE.BoxGeometry(.28,.16,.35),handMat);handL.position.set(-.35,.7+.55,.3);
  var handR=handL.clone();handR.position.set(.35,.7+.55,.3);
  pioFig3.add(pb3,ph3,beard,handL,handR);pioFig3.position.set(-1,0,-1.2);
  G.scene.add(pioFig3);
  pioFig3.userData={prompt:'Kneel beside Padre Pio and pray',action:'pioAgony'};G.interactables.push(pioFig3);
  // Attending Capuchin friars
  mkNPC(0x2a1a08,-3.5,0,0);mkNPC(0x2a1a08,1.5,0,.5);mkNPC(0x2a1a08,-2,0,-3.5);
  // ‚îÄ‚îÄ A soft miraculous glow on Pio's hands (healed stigmata) ‚îÄ‚îÄ
  var handGlow=new THREE.PointLight(0xffffff,.45,4);handGlow.position.set(-1,1.8,-1.2);handGlow.userData.glow=true;addS(handGlow);
  // Candle on vestment press
  mkBox(1.5,1,1,0x5a3818,4,.5,-3.5);mkBox(.12,.7,.12,0xffffee,4,1.05,-3.5);
  var agonyCandle=new THREE.PointLight(0xffddaa,.8,8);agonyCandle.position.set(4,2,-3.5);agonyCandle.userData.glow=true;addS(agonyCandle);
  setPos(2,2);setObj('Walk to Padre Pio and kneel beside him on his last night.');hideProgress();
}



/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INTERACTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function checkNear(){
  if(!G.playerGroup&&!G.inHeaven)return;
  var px=G.px,pz=G.pz,best=null,bestD=Infinity;
  for(var i=0;i<G.interactables.length;i++){
    var obj=G.interactables[i];
    var ox,oz,orr;
    if(obj.isObject3D){ox=obj.position.x;oz=obj.position.z;orr=2.5;}
    else{ox=obj.x;oz=obj.z;orr=obj.r||2.5;}
    var d2=(px-ox)*(px-ox)+(pz-oz)*(pz-oz),thr=(orr+.8)*(orr+.8);
    if(d2<thr){
      var hasAction=(obj.action)||(obj.userData&&obj.userData.action);
      var bestHasAction=best&&(best.action||(best.userData&&best.userData.action));
      if(d2<bestD||(d2===bestD&&hasAction&&!bestHasAction)){bestD=d2;best=obj;}
    }
  }
  G.nearTarget=best;
  var ip=document.getElementById('interactPrompt');
  if(best){var lbl=(best.userData&&best.userData.prompt)||best.prompt||'Interact';ip.textContent='‚úù PRAY ‚Äî '+lbl;ip.style.display='block';}
  else ip.style.display='none';
}

function handleAct(){
  if(G.dlgActive){dlgNext();return;}
  // Flight sim: shoot rosary
  if(G.gameMode==='flight'&&!G.inHeaven){shootRosary();return;}
  if(!G.nearTarget)return;
  var obj=G.nearTarget;
  var action=(obj.userData&&obj.userData.action)||obj.action;
  // Francis
  if(action==='repair'){if(obj.userData&&obj.userData.broken)doRepair(obj);return;}
  if(action==='wolf'){doWolfMiracle();return;}
  if(action==='birds'){doBirdsMiracle();return;}
  if(action==='stigmata'){doStigmata();return;}
  if(action==='francisEnd'){var idx2=G.interactables.indexOf(obj);if(idx2!==-1)G.interactables.splice(idx2,1);showDlg(DLG.canticle_scene,function(){setTimeout(showFrancisEnd,500);});return;}
  if(action==='dlgAdv'){var k=obj.dlgKey||(obj.userData&&obj.userData.dlgKey);var idx=G.interactables.indexOf(obj);if(idx!==-1)G.interactables.splice(idx,1);if(k&&DLG[k])showDlg(DLG[k],advFrancis);else advFrancis();return;}
  // Anthony
  if(action==='anthonyFish'){doAnthonyFish();return;}
  if(action==='anthonyChild'){doAnthonyChild();return;}
  if(action==='anthonyMule'){doAnthonyMule();return;}
  if(action==='anthonyRaise'){doAnthonyRaise();return;}
  if(action==='anthonyPadua'){doAnthonyPadua();return;}
  // Clare
  if(action==='clareSaracen'){doClareSaracen();return;}
  if(action==='clareChristmas'){doClareChristmas();return;}
  // Bonaventure
  if(action==='bonaVision'){doBonaVision();return;}
  // Padre Pio
  if(action==='pioStigmata'){doPioStigmata();return;}
  if(action==='pioFirstMass'){doPioFirstMass();return;}
  if(action==='pioConfessional'){doPioConfessional();return;}
  if(action==='pioBilocation'){doPioBilocation();return;}
  if(action==='pioHealing'){doPioHealing();return;}
  if(action==='pioCancer'){doPioCancer();return;}
  if(action==='pioFragrance'){doPioFragrance();return;}
  if(action==='pioAgony'){doPioAgony();return;}
  // Elizabeth
  if(action==='elizRoses'){doElizRoses();return;}
  if(action==='elizLeper'){doElizLeper();return;}
  // Heaven
  if(action==='meetJesus'){doMeetJesus();return;}
  if(action==='meetHoly'){doMeetHoly();return;}
  if(action==='meetGod'){doMeetGod();return;}
  // NPC dialogue
  var dlgKey=(obj.userData&&obj.userData.dlgKey)||obj.dlgKey;
  if(dlgKey&&DLG[dlgKey])showDlg(DLG[dlgKey]);
  else if(dlgKey&&!DLG[dlgKey])console.warn('Missing DLG key:',dlgKey);
}

/* ‚îÄ‚îÄ‚îÄ REPAIR SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function addPiece(col,w,h,d,x,y,z,label,fixedCol){
  var m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),new THREE.MeshLambertMaterial({color:col}));
  m.position.set(x,y,z);m.rotation.z=(Math.random()-.5)*.32;m.rotation.x=(Math.random()-.5)*.1;
  m.castShadow=m.receiveShadow=true;
  m.userData={broken:true,fixedColor:fixedCol,prompt:'Repair '+label,action:'repair'};
  addS(m);G.interactables.push(m);G.churchPieces.push(m);
}
function doRepair(piece){
  if(!piece||!piece.userData||!piece.userData.broken)return;
  piece.userData.broken=false;piece.rotation.set(0,0,0);
  piece.material.color.setHex(piece.userData.fixedColor||0xd4c4a0);
  piece.material.emissive=new THREE.Color(0xffd700);piece.material.emissiveIntensity=.35;
  G.fixedPieces++;
  var idx=G.interactables.indexOf(piece);if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);spawnParts(piece.position,0xffd700,28);
  var p=piece;setTimeout(function(){if(p&&p.material)p.material.emissiveIntensity=0;},2200);
  showProgress('Repaired: '+G.fixedPieces+'/'+G.totalPieces);
  setObj('Repair all 5 broken sections ('+G.fixedPieces+'/5).');
  var rpEntry=[DLG.repair_piece[G.fixedPieces%DLG.repair_piece.length]];
  if(G.fixedPieces>=G.totalPieces){
    showDlg(rpEntry,function(){setTimeout(function(){showDlg(DLG.repair_complete,advFrancis);},400);});
  }else{
    showDlg(rpEntry);
  }
}

/* ‚îÄ‚îÄ‚îÄ MIRACLE HANDLERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function doBirdsMiracle(){
  if(G.birdsDone)return;G.birdsDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='birds';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);spawnParts(G.playerGroup.position.clone(),0xaaffff,55);
  for(var i=0;i<G.birds.length;i++){(function(b){b.userData.dancing=true;setTimeout(function(){if(b&&b.userData)b.userData.dancing=false;},5000);})(G.birds[i]);}
  showDlg(DLG.birds_miracle,advFrancis);
}
function doStigmata(){
  if(G.stigmataDone)return;G.stigmataDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='stigmata';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);spawnParts(G.playerGroup.position.clone(),0xffffff,80);spawnParts(G.playerGroup.position.clone(),0xffd700,60);
  showDlg(DLG.stigmata_miracle,advFrancis);
}
function doWolfMiracle(){
  if(G.wolfTamed)return;G.wolfTamed=true;
  var idx=G.interactables.indexOf(G.wolfGroup);if(idx!==-1)G.interactables.splice(idx,1);
  // Eyes shift from red/amber to calm green
  for(var i=0;i<G.wolfEyes.length;i++){
    var e=G.wolfEyes[i];
    e.material.color.setHex(0x88cc66);
    e.material.emissive.setHex(0x004400);
    e.material.emissiveIntensity=.3;
  }
  // Wolf turns, faces the gate peacefully
  if(G.wolfGroup)G.wolfGroup.rotation.y=0;
  flashMiracle(false);spawnParts(G.wolfGroup.position.clone(),0xaaffaa,55);
  showDlg(DLG.wolf_encounter,advFrancis);
}
function doAnthonyFish(){
  if(G.fishSpawned)return;G.fishSpawned=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='anthonyFish';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  // Animate fish rising
  for(var i=0;i<G.birds.length;i++){
    (function(fm,delay){setTimeout(function(){if(fm&&fm.userData){fm.userData.risen=true;spawnParts(fm.position.clone(),0x44aaff,8);}},delay);})(G.birds[i],i*80);
  }
  showDlg(DLG.anthony_fish_miracle,function(){advSaint(CA,function(){showSaintEnd('anthony');});});
}
function doAnthonyChild(){
  if(G.childAppeared)return;G.childAppeared=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='anthonyChild';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  // Spawn child figure ‚Äî properly tagged and centered at kneeling zone
  var cg=new THREE.Group();
  var cbody=new THREE.Mesh(new THREE.SphereGeometry(.22,6,5),mkMat(0xffffff,0xffffff,.5));cbody.position.y=.6;cg.add(cbody);
  var chead=new THREE.Mesh(new THREE.SphereGeometry(.18,6,5),mkMat(0xf0d090));chead.position.y=1;cg.add(chead);
  var chaloM=new THREE.MeshLambertMaterial({color:0xffd700,emissive:new THREE.Color(0xffd700),emissiveIntensity:.9});
  var chalo=new THREE.Mesh(new THREE.TorusGeometry(.22,.025,4,10),chaloM);chalo.position.set(0,1.18,0);cg.add(chalo);
  var cPL=new THREE.PointLight(0xfff5cc,2.5,8);cPL.position.set(0,1,0);cg.add(cPL);
  cg.position.set(.6,0,1);
  tagObj(cg);G.scene.add(cg); // tagged so clearStage removes it
  spawnParts(cg.position.clone(),0xffffff,40);spawnParts(cg.position.clone(),0xffd700,30);
  showDlg(DLG.anthony_child_miracle,function(){advSaint(CA,function(){showSaintEnd('anthony');});});
}
function doClareSaracen(){
  if(G.saracensFled)return;G.saracensFled=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='clareSaracen';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);spawnParts(G.playerGroup.position.clone(),0xffd700,60);
  showDlg(DLG.clare_saracen_miracle,function(){advSaint(CC,function(){showSaintEnd('clare');});});
}
function doClareChristmas(){
  if(G.christmasVision)return;G.christmasVision=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='clareChristmas';});if(idx!==-1)G.interactables.splice(idx,1);
  // Christmas star appears
  var star=new THREE.PointLight(0xffffcc,3,12);star.position.set(0,5,-4);addS(star);
  flashMiracle(false);spawnParts(new THREE.Vector3(0,3,-4),0xffffaa,50);
  showDlg(DLG.clare_christmas_miracle,function(){showSaintEnd('clare');});
}
function doBonaVision(){
  if(G.bookDone)return;G.bookDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='bonaVision';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);spawnParts(G.playerGroup.position.clone(),0xffffff,80);spawnParts(G.playerGroup.position.clone(),0xffd700,60);
  showDlg(DLG.bona_vision_miracle,function(){showSaintEnd('bonaventure');});
}
function doPioStigmata(){
  if(G.pioStigDone)return;G.pioStigDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='pioStigmata';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);spawnParts(G.playerGroup.position.clone(),0xffffff,80);spawnParts(G.playerGroup.position.clone(),0xff4400,60);
  showDlg(DLG.pio_stigmata_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioFirstMass(){
  if(G.pioFirstMassDone)return;G.pioFirstMassDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioFirstMass';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  spawnParts(G.playerGroup.position.clone(),0xffffcc,60);spawnParts(G.playerGroup.position.clone(),0xffd700,40);
  var glow2=new THREE.PointLight(0xffeeaa,3,14);glow2.position.set(0,3,-4);addS(glow2);
  showDlg(DLG.pio_firstmass_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioConfessional(){
  if(G.pioConfessionalDone)return;G.pioConfessionalDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioConfessional';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  var confGlow=new THREE.PointLight(0xffddaa,2.5,12);confGlow.position.set(0,3,-6);addS(confGlow);
  spawnParts(G.playerGroup.position.clone(),0xffd700,40);spawnParts(G.playerGroup.position.clone(),0xffffff,30);
  showDlg(DLG.pio_confessional_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioBilocation(){
  if(G.pioBilocationDone)return;G.pioBilocationDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioBilocation';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  spawnParts(G.playerGroup.position.clone(),0xaaddff,50);spawnParts(G.playerGroup.position.clone(),0xffffff,35);
  var biGlow=new THREE.PointLight(0xaaddff,2.5,14);biGlow.position.set(2,3,1);addS(biGlow);
  showDlg(DLG.pio_bilocation_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioHealing(){
  if(G.pioHealDone)return;G.pioHealDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='pioHealing';});if(idx!==-1)G.interactables.splice(idx,1);
  var glow=new THREE.PointLight(0xffffcc,3.5,9);glow.position.set(-2,3,-8);addS(glow);
  flashMiracle(false);spawnParts(new THREE.Vector3(-2,1.5,-8),0xffffff,55);spawnParts(new THREE.Vector3(-2,1.5,-8),0xffd700,35);
  showDlg(DLG.pio_healing_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioCancer(){
  if(G.pioCancerDone)return;G.pioCancerDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioCancer';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  var eyeGlow=new THREE.PointLight(0xffffff,4,10);eyeGlow.position.set(2,2.5,-16);addS(eyeGlow);
  spawnParts(new THREE.Vector3(2,1.8,-16),0xffffff,80);spawnParts(new THREE.Vector3(2,1.8,-16),0xffd700,50);
  showDlg(DLG.pio_cancer_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioFragrance(){
  if(G.pioFragranceDone)return;G.pioFragranceDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioFragrance';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  // Spawn rose-coloured particles as the fragrance
  spawnParts(new THREE.Vector3(0,2,-5),0xffaacc,55);spawnParts(new THREE.Vector3(0,2,-5),0xffffff,35);
  spawnParts(new THREE.Vector3(0,2,-5),0xff88aa,30);
  var roseGlow=new THREE.PointLight(0xffaacc,2,12);roseGlow.position.set(0,3,-5);addS(roseGlow);
  showDlg(DLG.pio_fragrance_miracle,function(){advSaint(CPio,function(){showSaintEnd('pio');});});
}
function doPioAgony(){
  if(G.pioAgonyDone)return;G.pioAgonyDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='pioAgony';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  // The white light of the clean hands ‚Äî healing of stigmata
  var deathGlow=new THREE.PointLight(0xffffff,5,20);deathGlow.position.set(-1,2,-1);addS(deathGlow);
  spawnParts(new THREE.Vector3(-1,1.5,-1),0xffffff,100);spawnParts(new THREE.Vector3(-1,1.5,-1),0xffd700,60);
  showDlg(DLG.pio_agony_miracle,function(){showSaintEnd('pio');});
}
// Anthony extended handlers
function doAnthonyMule(){
  if(G.anthonyMuleDone)return;G.anthonyMuleDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='anthonyMule';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  spawnParts(G.playerGroup.position.clone(),0xffd700,50);spawnParts(G.playerGroup.position.clone(),0xffffff,35);
  var mGlow=new THREE.PointLight(0xffd700,3,15);mGlow.position.set(0,3,-12);addS(mGlow);
  showDlg(DLG.anthony_mule_miracle,function(){advSaint(CA,function(){showSaintEnd('anthony');});});
}
function doAnthonyRaise(){
  if(G.anthonyRaiseDone)return;G.anthonyRaiseDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='anthonyRaise';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  // Earth glows where the grave is
  var graveGlow=new THREE.PointLight(0xffffff,4,12);graveGlow.position.set(0,1,-18);addS(graveGlow);
  spawnParts(new THREE.Vector3(0,1,-18),0xffffff,70);spawnParts(new THREE.Vector3(0,1,-18),0xffd700,45);
  showDlg(DLG.anthony_raise_miracle,function(){advSaint(CA,function(){showSaintEnd('anthony');});});
}
function doAnthonyPadua(){
  if(G.anthonyPaduaDone)return;G.anthonyPaduaDone=true;
  var idx=G.interactables.findIndex(function(o){var a=(o.userData&&o.userData.action)||o.action;return a==='anthonyPadua';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);
  spawnParts(G.playerGroup.position.clone(),0xffd700,60);spawnParts(G.playerGroup.position.clone(),0xffeecc,40);
  spawnParts(G.playerGroup.position.clone(),0xffffff,30);
  var pGlow=new THREE.PointLight(0xffeecc,2.5,18);pGlow.position.set(-10,5,0);addS(pGlow);
  showDlg(DLG.anthony_padua_miracle,function(){showSaintEnd('anthony');});
}
function doElizRoses(){
  if(G.elizRosesDone)return;G.elizRosesDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='elizRoses';});if(idx!==-1)G.interactables.splice(idx,1);
  // Spawn roses (red and white)
  for(var i=0;i<18;i++){
    var rc=i%2===0?0xff3355:0xffffff;
    var rp=new THREE.Mesh(new THREE.SphereGeometry(.22,5,4),new THREE.MeshLambertMaterial({color:rc,emissive:new THREE.Color(rc),emissiveIntensity:.35}));
    rp.position.set((Math.random()-.5)*4,1.5+Math.random()*2,(Math.random()-.5)*3-15);addS(rp);
  }
  flashMiracle(false);spawnParts(G.playerGroup.position.clone(),0xff3355,40);spawnParts(G.playerGroup.position.clone(),0xffffff,30);
  showDlg(DLG.elizabeth_roses_miracle,function(){advSaint(CEliz,function(){showSaintEnd('elizabeth');});});
}
function doElizLeper(){
  if(G.elizLeperDone)return;G.elizLeperDone=true;
  var idx=G.interactables.findIndex(function(o){return o.action==='elizLeper';});if(idx!==-1)G.interactables.splice(idx,1);
  // Christ vision flash ‚Äî white and gold
  var vis=new THREE.PointLight(0xffffcc,5,20);vis.position.set(-1.5,3,1.5);addS(vis);
  flashMiracle(true);spawnParts(new THREE.Vector3(-1.5,2,1.5),0xffffff,90);spawnParts(new THREE.Vector3(-1.5,2,1.5),0xffd700,60);
  showDlg(DLG.elizabeth_leper_miracle,function(){showSaintEnd('elizabeth');});
}

function doMeetJesus(){
  var idx=G.interactables.findIndex(function(o){return o.action==='meetJesus';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  spawnParts(G.playerGroup.position.clone(),0xffffff,60);spawnParts(G.playerGroup.position.clone(),0xffd700,40);
  showDlg(DLG.heaven_jesus,function(){
    setObj('Walk toward the Holy Spirit ‚Äî the golden dove of light.');
    G.interactables.push({zone:true,x:0,z:-48,r:5,prompt:'Approach the Holy Spirit',action:'meetHoly'});
    showHeavenMsg('Walk to the Holy Spirit',2000);
  });
}
function doMeetHoly(){
  var idx=G.interactables.findIndex(function(o){return o.action==='meetHoly';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(false);spawnParts(G.playerGroup.position.clone(),0xffffaa,80);
  if(G.holyGroup)G.holyGroup.userData.descending=true;
  showDlg(DLG.heaven_spirit,function(){
    setObj('Walk toward God the Father ‚Äî the great Pillar of Light.');
    G.interactables.push({zone:true,x:0,z:-76,r:6,prompt:'Approach God the Father',action:'meetGod'});
    showHeavenMsg('Walk to God the Father',2000);
  });
}
function doMeetGod(){
  var idx=G.interactables.findIndex(function(o){return o.action==='meetGod';});if(idx!==-1)G.interactables.splice(idx,1);
  flashMiracle(true);
  spawnParts(G.playerGroup.position.clone(),0xffffff,100);spawnParts(G.playerGroup.position.clone(),0xffd700,80);
  spawnParts(G.playerGroup.position.clone(),0xffffcc,60);
  showDlg(DLG.heaven_father,function(){setTimeout(showHeavenEnd,500);});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DIALOGUE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showDlg(lines,cb){
  if(!lines||!lines.length){if(cb)cb();return;}
  if(G._typeTimer){clearInterval(G._typeTimer);G._typeTimer=null;}
  G.dlgQueue=lines;G.dlgIdx=0;G.dlgCb=cb||null;G.dlgActive=true;
  renderDlg();document.getElementById('dialogueBox').style.display='flex';
}
function renderDlg(){
  if(G.dlgIdx>=G.dlgQueue.length){closeDlg();return;}
  var d=G.dlgQueue[G.dlgIdx];
  document.getElementById('dlgSpeaker').textContent=(d.s||'').toUpperCase();
  var tEl=document.getElementById('dlgText');tEl.textContent='';
  // Typewriter effect for immersion
  var txt=d.t||'',idx=0;
  if(G._typeTimer)clearInterval(G._typeTimer);
  G._typeTimer=setInterval(function(){
    if(idx>=txt.length){clearInterval(G._typeTimer);G._typeTimer=null;return;}
    tEl.textContent+=txt[idx++];
  },18);
  document.getElementById('dlgAttr').textContent=d.a?('‚Äî '+d.a):'';
  var _db=document.getElementById('dialogueBox');
  _db.style.animation='none';_db.getBoundingClientRect();_db.style.animation='dlgIn .28s ease-out';
  // Progress indicator
  var hint=document.querySelector('.dlg-hint');
  if(hint)hint.textContent='‚ñº '+(G.dlgIdx+1)+' / '+G.dlgQueue.length+' ‚Äî Tap or press SPACE to continue';
}
function dlgNext(){
  if(!G.dlgActive)return;
  // If typewriter still running, complete it first
  if(G._typeTimer){
    clearInterval(G._typeTimer);G._typeTimer=null;
    var d=G.dlgQueue[G.dlgIdx];
    if(d)document.getElementById('dlgText').textContent=d.t||'';
    return;
  }
  G.dlgIdx++;playDialogueTone();
  if(G.dlgIdx>=G.dlgQueue.length)closeDlg();else renderDlg();
}
function closeDlg(){
  if(G._typeTimer){clearInterval(G._typeTimer);G._typeTimer=null;}
  G.dlgActive=false;G.dlgIdx=0;G.dlgQueue=[];elHide('dialogueBox');
  var cb=G.dlgCb;G.dlgCb=null;if(cb)cb();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CUTSCENE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showCutscene(data,cb){
  G.cutCb=cb;
  document.getElementById('cutArt').textContent=data.art||'‚úù';
  document.getElementById('cutTitle').textContent=data.title||'';
  document.getElementById('cutText').textContent=data.text||'';
  document.getElementById('cutscene').style.display='flex';
}
function cutNext(){document.getElementById('cutscene').style.display='none';var cb=G.cutCb;G.cutCb=null;if(cb)cb();}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EFFECTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function flashMiracle(white){
  var fl=document.getElementById('miracleFlash');
  fl.classList.remove('on','white');fl.getBoundingClientRect();
  if(white)fl.classList.add('white');fl.classList.add('on');
  setTimeout(function(){fl.classList.remove('on','white');},800);
  playMiracleChord();
}
function spawnParts(pos,color,count){
  color=color||0xffd700;count=count||20;
  for(var i=0;i<count;i++){
    var size=.06+Math.random()*.1;
    var geo=Math.random()<.4?new THREE.BoxGeometry(size,size,size):new THREE.SphereGeometry(size,4,3);
    var mat=new THREE.MeshBasicMaterial({color:color,transparent:true,opacity:.95});
    var m=new THREE.Mesh(geo,mat);
    m.position.copy(pos).addScalar((Math.random()-.5)*.5);
    var speed=.14+Math.random()*.18;
    var angle=Math.random()*Math.PI*2,vx=Math.cos(angle)*speed,vz=Math.sin(angle)*speed;
    m.userData={
      vel:new THREE.Vector3(vx*(0.5+Math.random()),(.08+Math.random()*.22),vz*(0.5+Math.random())),
      life:1.2+Math.random()*.8,
      spin:new THREE.Vector3((Math.random()-.5)*.12,(Math.random()-.5)*.12,(Math.random()-.5)*.12)
    };
    tagObj(m);G.scene.add(m);G.particles3D.push(m);
  }
}
function updateParts(dt){
  for(var i=G.particles3D.length-1;i>=0;i--){
    var p=G.particles3D[i];
    p.userData.life-=dt*.9;
    p.position.addScaledVector(p.userData.vel,dt*60);
    p.userData.vel.y-=3.8*dt;
    if(p.userData.spin){p.rotation.x+=p.userData.spin.x;p.rotation.y+=p.userData.spin.y;p.rotation.z+=p.userData.spin.z;}
    if(p.material)p.material.opacity=Math.max(0,p.userData.life*.85);
    if(p.userData.life<=0){G.scene.remove(p);G.particles3D.splice(i,1);}
  }
}
var _partIv=setInterval(function(){
  if(!G.gameMode||G.gameMode==='none')return;
  var ov=document.getElementById('particleOverlay');
  if(!ov||ov.childNodes.length>18)return;
  var p=document.createElement('div');p.className='cssPart';
  var sz=2+Math.random()*5,dur=6+Math.random()*7;
  var cs=['#ffd700','#ff8c00','#fff5aa','#ffffff','#ffd060','#ffcc44'];
  p.style.cssText='width:'+sz+'px;height:'+sz+'px;left:'+(Math.random()*100)+'%;bottom:0;background:'+cs[Math.floor(Math.random()*6)]+';border-radius:50%;opacity:'+(0.25+Math.random()*.4)+';animation-duration:'+dur+'s;animation-delay:'+(Math.random()*1.5)+'s;';
  ov.appendChild(p);setTimeout(function(){if(p.parentNode)p.remove();},(dur+2)*1000);
},1100);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MOVEMENT + CAMERA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var SPEED=6.2,SPRINT=10.5,CAM_H=7.8,CAM_BACK=13.5;
function updateMovement(dt){
  if(G.dlgActive||!G.playerGroup)return;
  var mx=G.joy.ax,mz=G.joy.az;
  var up=G.keys.ArrowUp||G.keys.KeyW,dn=G.keys.ArrowDown||G.keys.KeyS;
  var lt=G.keys.ArrowLeft||G.keys.KeyA,rt=G.keys.ArrowRight||G.keys.KeyD;
  if(up&&lt){mx=-.707;mz=-.707;}else if(up&&rt){mx=.707;mz=-.707;}
  else if(dn&&lt){mx=-.707;mz=.707;}else if(dn&&rt){mx=.707;mz=.707;}
  else if(up)mz=-1;else if(dn)mz=1;else if(lt)mx=-1;else if(rt)mx=1;
  var len=Math.sqrt(mx*mx+mz*mz);
  var spd=(G.keys.ShiftLeft||G.keys.ShiftRight)?SPRINT:SPEED;
  // Always update terrain Y smoothly
  var groundY=getGroundY(G.px,G.pz);
  G.py=G.py==null?groundY:G.py+(groundY-G.py)*.22;
  if(len>.01){
    var nx=mx/len,nz=mz/len;
    G.px+=nx*spd*dt;G.pz+=nz*spd*dt;
    var groundY2=getGroundY(G.px,G.pz);
    G.py=G.py+(groundY2-G.py)*.22;
    var bob=Math.sin(Date.now()*.007)*Math.abs(Math.sin(Date.now()*.007))*.06;
    var _pc=pushCollision(G.px,G.pz);G.px=_pc.x;G.pz=_pc.z;
    G.playerGroup.position.set(G.px,G.py+bob,G.pz);
    var tgt=Math.atan2(nx,nz),cur=G.playerGroup.rotation.y;
    var diff=tgt-cur;if(diff>Math.PI)diff-=Math.PI*2;if(diff<-Math.PI)diff+=Math.PI*2;
    G.playerGroup.rotation.y+=diff*.2;
  }else{
    G.playerGroup.position.y=G.py;
  }
}
function updateCamera(){
  var tx=G.px,ty=CAM_H+G.py,tz=G.pz+CAM_BACK;
  var lf=.1;
  G.camera.position.x+=(tx-G.camera.position.x)*lf;
  G.camera.position.y+=(ty-G.camera.position.y)*lf;
  G.camera.position.z+=(tz-G.camera.position.z)*lf;
  G.camera.lookAt(G.px,1.4+G.py,G.pz-2);
}
function updateFlight(dt,t){
  if(!G.flyGroup)return;
  // Yaw: left/right joystick or keys
  var turnInput=G.joy.ax;
  if(G.keys.ArrowLeft||G.keys.KeyA)turnInput=-1;
  if(G.keys.ArrowRight||G.keys.KeyD)turnInput=1;
  G.flyYaw+=turnInput*1.8*dt;
  // Altitude: up/down joystick
  var altInput=-G.joy.az;
  if(G.keys.ArrowUp||G.keys.KeyW)altInput=1;
  if(G.keys.ArrowDown||G.keys.KeyS)altInput=-1;
  G.flyY+=altInput*5*dt;
  G.flyY=Math.max(8,Math.min(45,G.flyY));
  // Forward movement
  G.flyX+=Math.sin(G.flyYaw)*G.flySpeed*dt;
  G.flyZ-=Math.cos(G.flyYaw)*G.flySpeed*dt;
  G.flyGroup.position.set(G.flyX,G.flyY,G.flyZ);
  G.flyGroup.rotation.y=G.flyYaw;
  G.flyGroup.rotation.z=-turnInput*.28; // banking
  G.flyGroup.rotation.x=-altInput*.12;
  // Wing flap
  G.wingAngle+=dt*4;
  if(G.wingMeshL)G.wingMeshL.rotation.z=Math.sin(G.wingAngle)*.4-.3;
  if(G.wingMeshR)G.wingMeshR.rotation.z=-Math.sin(G.wingAngle)*.4+.3;
  // Camera: behind and above Francis
  var camBX=G.flyX-Math.sin(G.flyYaw)*16;
  var camBZ=G.flyZ+Math.cos(G.flyYaw)*16;
  G.camera.position.x+=(camBX-G.camera.position.x)*.07;
  G.camera.position.y+=(G.flyY+10-G.camera.position.y)*.07;
  G.camera.position.z+=(camBZ-G.camera.position.z)*.07;
  G.camera.lookAt(G.flyX,G.flyY,G.flyZ);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ENTITY ANIMATIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function animBirds(t){
  for(var i=0;i<G.birds.length;i++){
    var b=G.birds[i];if(!b||!b.userData)continue;
    var ph=b.userData.phase||0;
    if(b.userData.risen){// fish popping up
      var target=.5+Math.sin(t*2+ph)*.2;
      b.position.y+=(target-b.position.y)*.08;
      b.rotation.z=Math.sin(t*3+ph)*.3;
    }else if(b.userData.dancing){
      b.position.y=(b.userData.origY||1)+Math.sin(t*6+ph)*.6;b.rotation.z=Math.sin(t*9+ph)*.45;
    }else{
      b.position.y=(b.userData.origY||5)+Math.sin(t*1.4+ph)*.4;b.rotation.z=Math.sin(t*2+ph)*.18;
    }
  }
}
function animWolf(t){
  if(!G.wolfGroup)return;
  if(G.wolfTamed){if(G.wolfTail)G.wolfTail.rotation.y=Math.sin(t*8)*.4;G.wolfGroup.position.y=Math.sin(t*1.5)*.05;}
  else{G.wolfGroup.position.y=Math.abs(Math.sin(t*2.5))*.12;G.wolfGroup.rotation.y=Math.sin(t*.5)*.3+Math.PI*.5;}
}
function animGlows(t){
  for(var i=0;i<G.glowLights.length;i++){var gl=G.glowLights[i];if(gl)gl.intensity=1.8+Math.sin(t*2.8+i*.7)*.6;}
}
/* ‚îÄ‚îÄ TERRAIN HEIGHT SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
// addRamp: define a walkable incline (start‚Üíend X/Z, Y0‚ÜíY1, half-width)
function addRamp(x0,z0,x1,z1,y0,y1,hw){
  var dx=x1-x0,dz=z1-z0,len=Math.sqrt(dx*dx+dz*dz);
  if(len<.01)return;
  G.ramps.push({x0:x0,z0:z0,nx:dx/len,nz:dz/len,px:-dz/len,pz:dx/len,len:len,y0:y0,y1:y1,hw:hw});
}
function getGroundY(px,pz){
  var best=0;
  for(var i=0;i<G.ramps.length;i++){
    var r=G.ramps[i];
    var lx=px-r.x0,lz=pz-r.z0;
    var along=lx*r.nx+lz*r.nz;
    var perp=Math.abs(lx*r.px+lz*r.pz);
    if(perp<r.hw&&along>=-.5&&along<=r.len+.5){
      var t2=Math.max(0,Math.min(1,along/r.len));
      var y=r.y0+(r.y1-r.y0)*t2;
      if(y>best)best=y;
    }
  }
  return best;
}
// addWall: register a circular obstacle (x,z,radius)
function addWall(x,z,r){G.walls.push({x:x,z:z,r:r});}
// addWallLine: fill a wall with circles along a segment
function addWallLine(x0,z0,x1,z1,r){
  var dx=x1-x0,dz=z1-z0,len=Math.sqrt(dx*dx+dz*dz);
  if(len<.01)return;
  var steps=Math.ceil(len/(r*1.4))+1;
  for(var i=0;i<=steps;i++){var t=i/steps;addWall(x0+dx*t,z0+dz*t,r);}
}
// pushCollision: resolve player-circle overlaps, return corrected {x,z}
function pushCollision(px,pz){
  var PR=0.48; // player radius
  for(var i=0;i<G.walls.length;i++){
    var w=G.walls[i];
    var dx=px-w.x,dz=pz-w.z;
    var d2=dx*dx+dz*dz;
    var min=(w.r+PR);
    if(d2<min*min&&d2>.0001){
      var d=Math.sqrt(d2);
      var push=min-d;
      px+=(dx/d)*push;pz+=(dz/d)*push;
    }
  }
  return {x:px,z:pz};
}

/* ‚îÄ‚îÄ MINIMAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
var _mmCtx=null,_mmCv=null;
function initMinimap(){
  _mmCv=document.getElementById('minimapCanvas');
  if(!_mmCv)return;
  var mm=document.getElementById('minimap');
  var sz=mm.offsetWidth||80;
  _mmCv.width=sz;_mmCv.height=sz;
  _mmCtx=_mmCv.getContext('2d');
}
function updateMinimap(){
  if(!_mmCtx||!_mmCv)return;
  var sz=_mmCv.width,half=sz/2,scale=sz/80;
  _mmCtx.clearRect(0,0,sz,sz);
  // Background
  _mmCtx.fillStyle='rgba(0,0,0,.7)';_mmCtx.beginPath();_mmCtx.arc(half,half,half,0,Math.PI*2);_mmCtx.fill();
  // Interactables as dots
  _mmCtx.save();_mmCtx.translate(half,half);
  G.interactables.forEach(function(obj){
    var ox=obj.isObject3D?obj.position.x:obj.x;
    var oz=obj.isObject3D?obj.position.z:obj.z;
    var mx=ox*scale,mz=oz*scale;
    if(Math.abs(mx)>half||Math.abs(mz)>half)return;
    _mmCtx.beginPath();_mmCtx.arc(mx,mz,3.5,0,Math.PI*2);
    _mmCtx.fillStyle='#ffd700';_mmCtx.fill();
  });
  // Player dot
  if(G.playerGroup){
    var px=G.px*scale,pz=G.pz*scale;
    _mmCtx.beginPath();_mmCtx.arc(px,pz,5,0,Math.PI*2);
    _mmCtx.fillStyle='#fff';_mmCtx.fill();
    _mmCtx.beginPath();_mmCtx.arc(px,pz,4,0,Math.PI*2);
    _mmCtx.fillStyle='#4af';_mmCtx.fill();
  }
  _mmCtx.restore();
  // Border ring
  _mmCtx.strokeStyle='rgba(255,215,0,.3)';_mmCtx.lineWidth=1;
  _mmCtx.beginPath();_mmCtx.arc(half,half,half-1,0,Math.PI*2);_mmCtx.stroke();
}
function animHeaven(t){
  // Dove circles
  if(G.holyGroup&&!G.holyGroup.userData.descending){
    G.holyGroup.position.x=Math.cos(t*.4)*12;
    G.holyGroup.position.z=-50+Math.sin(t*.4)*8;
    G.holyGroup.position.y=12+Math.sin(t*.8)*2;
    G.holyGroup.rotation.y=t*.4+Math.PI/2;
  }else if(G.holyGroup&&G.holyGroup.userData.descending){
    G.holyGroup.position.y+=(4-G.holyGroup.position.y)*.03;
    G.holyGroup.position.x*=.99;
  }
  // God pillar flicker
  if(G.godGroup){G.godGroup.traverse(function(o){if(o.isLight&&o.userData&&o.userData.glow)o.intensity=1.5+Math.sin(t*2.5+o.position.y)*.4;});}
  // Jesus halo glow
  if(G.jesusGroup)G.jesusGroup.traverse(function(o){if(o.isLight)o.intensity=2+Math.sin(t*1.5)*.5;});
}
function animCelebrate(dt){
  for(var i=0;i<G.groundPeople.length;i++){
    var person=G.groundPeople[i];if(!person.celebrating)continue;
    person.celebTimer-=dt;
    if(person.celebTimer<0){person.celebrating=false;if(person.armL&&person.armR){person.armL.rotation.z=.3;person.armR.rotation.z=-.3;}}
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HUD / SCREENS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function elHide(id){var e=document.getElementById(id);if(e)e.style.display='none';}
function elShow(id,d){var e=document.getElementById(id);if(e)e.style.display=d||'block';}
function showHUD(title){
  document.getElementById('stageBanner').textContent=title;
  elShow('stageBanner');elShow('objectiveBar');elShow('joystickWrap');elShow('actionBtns','flex');
  var mm=document.getElementById('minimap');if(mm){mm.style.display='block';initMinimap();} // always reinit
}
function hideHUDMinimap(){var mm=document.getElementById('minimap');if(mm)mm.style.display='none';}
function hideHUD(){
  ['stageBanner','objectiveBar','stageProgress','joystickWrap','actionBtns','flightHUD','interactPrompt','crosshair','minimap'].forEach(function(id){elHide(id);});
}
function setObj(t){var e=document.getElementById('objText');if(e)e.textContent=t;}
function showProgress(t){var el=document.getElementById('stageProgress');if(el){el.textContent=t;el.style.display='block';}}
function hideProgress(){elHide('stageProgress');}
/* ‚îÄ‚îÄ‚îÄ MARATHON MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
var MARATHON_ORDER=[
  {cuts:null,     key:'francis',      label:'St. Francis of Assisi', icon:'‚õ™'},
  {cuts:null,     key:'anthony',      label:'St. Anthony of Padua',  icon:'üêü'},
  {cuts:null,     key:'clare',        label:'St. Clare of Assisi',   icon:'üïØ'},
  {cuts:null,     key:'bonaventure',  label:'St. Bonaventure',       icon:'üìñ'},
  {cuts:null,     key:'pio',          label:'Padre Pio',             icon:'üôè'},
  {cuts:null,     key:'elizabeth',    label:'St. Elizabeth of Hungary',icon:'üåπ'},
];
// Cuts set after arrays are defined (called once at init)
function initMarathonOrder(){
  MARATHON_ORDER[0].cuts=CF;
  MARATHON_ORDER[1].cuts=CA;MARATHON_ORDER[2].cuts=CC;
  MARATHON_ORDER[3].cuts=CB;MARATHON_ORDER[4].cuts=CPio;MARATHON_ORDER[5].cuts=CEliz;
}

function startMarathonMode(){
  elHide('modeSelect');
  G.marathonMode=true;G.marathonSaintIdx=0;G.marathonCompleted=[];
  initMarathonOrder();
  buildMarathonHUD();
  G.gameMode='francis';
  loadFrancisStage(0);
}

function buildMarathonHUD(){
  var dots=document.getElementById('marathonHUDDots');
  if(!dots)return;
  dots.innerHTML='';
  MARATHON_ORDER.forEach(function(s,i){
    var d=document.createElement('div');
    d.className='mhud-dot'+(i===0?' active':'');
    d.title=s.label;
    d.id='mdot'+i;
    dots.appendChild(d);
  });
  document.getElementById('marathonHUD').style.display='block';
  updateMarathonHUD();
}

function updateMarathonHUD(){
  var cur=G.marathonSaintIdx;
  var curS=MARATHON_ORDER[cur];
  if(!curS)return;
  document.getElementById('marathonHUDIcon').textContent=curS.icon;
  document.getElementById('marathonHUDText').textContent=curS.label+' ('+(cur+1)+'/'+MARATHON_ORDER.length+')';
  MARATHON_ORDER.forEach(function(s,i){
    var d=document.getElementById('mdot'+i);
    if(!d)return;
    if(i<cur)d.className='mhud-dot done';
    else if(i===cur)d.className='mhud-dot active';
    else d.className='mhud-dot';
  });
}

function marathonNextSaint(){
  G.marathonSaintIdx++;
  if(G.marathonSaintIdx>=MARATHON_ORDER.length){showMarathonEnd();return;}
  var s=MARATHON_ORDER[G.marathonSaintIdx];
  updateMarathonHUD();
  G.gameMode='saint';G.saintMode=s.key;
  loadSaintStage(s.cuts,0,function(){showSaintEnd(s.key);});
}

function showMarathonEnd(){
  hideHUD();elHide('dialogueBox');
  document.getElementById('marathonHUD').style.display='none';
  // Build saint badge list
  var list=document.getElementById('marathonSaintsList');
  var badgeIcons={francis:'‚õ™',anthony:'üêü',clare:'üïØ',bonaventure:'üìñ',pio:'üôè',elizabeth:'üåπ'};
  var badgeNames={francis:'St. Francis',anthony:'St. Anthony',clare:'St. Clare',bonaventure:'St. Bonaventure',pio:'Padre Pio',elizabeth:'St. Elizabeth'};
  if(list){
    list.innerHTML='';
    MARATHON_ORDER.forEach(function(s){
      var sp=document.createElement('span');
      sp.className='marathon-badge';
      sp.textContent=s.icon+' '+s.label;
      list.appendChild(sp);
    });
  }
  elShow('finalMarathon','flex');
}

function showFrancisEnd(){
  if(G.marathonMode){
    G.marathonCompleted.push('francis');
    marathonNextSaint();
    return;
  }
  hideHUD();elHide('dialogueBox');
  playCelebrationTones();
  elShow('finalFrancis','flex');
}

function showSaintEnd(saintKey){
  playCelebrationTones();
  if(G.marathonMode){
    G.marathonCompleted.push(saintKey);
    marathonNextSaint();
    return;
  }
  hideHUD();elHide('dialogueBox');
  var quotes={
    anthony:'"Actions speak louder than words; let your words teach and your actions speak. Wherever we are, whatever we do, we should think of God."\n‚Äî St. Anthony of Padua\n\nSt. Anthony was canonised on May 30, 1232 ‚Äî less than one year after his death. He is the patron saint of lost things, the poor, and expectant mothers.',
    clare:'"We become what we love and who we love shapes what we become. Go forth in peace, for you have followed the good road."\n‚Äî St. Clare of Assisi\n\nSt. Clare was canonised on August 15, 1255. She is the patron saint of television, goldsmiths, and the blind.',
    bonaventure:'"The soul, the image of God, journeys back to its origin when it is illumined by the light of knowledge and inflamed by love."\n‚Äî St. Bonaventure, Itinerarium, 1259\n\nSt. Bonaventure was declared a Doctor of the Church in 1587. He is known as the Seraphic Doctor.',
    pio:'"Pray, hope, and don\'t worry. Worry is useless. God is merciful and will hear your prayer. Suffering is a gift. In it is hidden the mercy of God."\n‚Äî Padre Pio of Pietrelcina\n\nPadre Pio bore the stigmata visibly for 50 years (1918‚Äì1968). He was canonised by Pope John Paul II on June 16, 2002. His grave at San Giovanni Rotondo draws millions of pilgrims each year.',
    elizabeth:'"It is not fitting, when one is in God\'s service, to have a gloomy face or a chilling look.\nFill your hearts with joy and love for Him!"\n‚Äî St. Elizabeth of Hungary\n\nSt. Elizabeth died November 17, 1231, aged just 24. She was canonised only four years later, on May 27, 1235, by Pope Gregory IX. She is patron of the poor, bakers, and the Franciscan Third Order.',
  };
  var bios={
    anthony:'Fernando Martins de Bulh√µes was born in Lisbon, Portugal, c. 1195, to a noble family. He entered the Augustinian Order at 15, then joined the Franciscans in 1220, inspired by the martyrdom of five Franciscan friars in Morocco. He sailed for Africa but illness turned him back to Europe, where a storm drove him to Sicily. He was "discovered" as a preacher at a priestly ordination in Forl√¨ in 1222 and thereafter became the most celebrated orator in Europe. His sermons drew tens of thousands; courts suspended hearings; markets closed. He died near Padua on June 13, 1231, aged 35 or 36. He was canonised by Gregory IX on May 30, 1232 ‚Äî less than one year after his death. He was declared a Doctor of the Church in 1946. He is the patron saint of lost things, the poor, pregnant women, and all who seek what has been taken from them.',
    clare:'Chiara di Favarone was born in Assisi on July 16, 1194, to a wealthy noble family. After hearing Francis preach during Lent of 1212, she fled her home on Palm Sunday night and took the habit of poverty at the Portiuncula. Francis cut her hair and veiled her. She became the first woman to write her own Rule of Life for a religious community ‚Äî a rule insisting on absolute poverty with no corporate property, which four popes tried to modify and she refused every time. She governed San Damiano for 42 years from her sickbed, performing documented miracles of healing and the multiplication of food. She died on August 11, 1253. Two days later, Pope Innocent IV attended her funeral. She was canonised on August 15, 1255. She is patron of television (because she once saw the Christmas Mass on the wall of her cell while too ill to attend), goldsmiths, and the blind.',
    bonaventure:'Giovanni di Fidanza was born c. 1221 in Bagnoregio, Tuscany. He is said to have been healed of a childhood illness through the intercession of Francis of Assisi, which led his mother to cry out "O bona ventura!" ‚Äî "O good fortune!" ‚Äî giving him his religious name. He studied in Paris under Alexander of Hales, joined the Franciscan Order c. 1243, and became Minister General of the order in 1257. He restored the order after a period of severe internal conflict. He was made Cardinal-Bishop of Albano in 1273. He wrote the official biography of St. Francis (Legenda Maior, 1263), which became so authoritative that the Chapter General ordered all earlier biographies burned. His masterwork, the Itinerarium Mentis in Deum (1259), was written on La Verna in a single sitting after mystical contemplation. He died on July 15, 1274, during the Second Council of Lyon. He was canonised in 1482 and declared a Doctor of the Church by Sixtus V in 1587.',
    pio:'Francesco Forgione was born on May 25, 1887, in Pietrelcina, a small town in Campania, southern Italy. He entered the Capuchin Order at 15, taking the name Pio. He bore the five wounds of Christ visibly and painfully from September 20, 1918 until his death on September 23, 1968 ‚Äî fifty years. During this time he heard confessions 15‚Äì18 hours a day. Pilgrims came from every continent. His spiritual children numbered in the millions. The Vatican twice investigated him (1921, 1960); both times the investigators could not explain what they witnessed. Pope Paul VI closed the investigations. He built the Casa Sollievo della Sofferenza (Home for the Relief of Suffering) hospital near San Giovanni Rotondo, which still operates today. He died whispering the names of Jesus and Mary. His stigmata wounds, which had bled every day for fifty years, were found completely healed on the morning of his death. He was canonised by Pope John Paul II on June 16, 2002, before 300,000 people in St. Peter\u2019s Square.',
    elizabeth:'Erzsbet Arpad was born on July 7, 1207, in Pressburg (modern Bratislava), daughter of King Andrew II of Hungary. At 14 she married Ludwig IV of Thuringia; they had three children and by all accounts a genuinely loving marriage. After Ludwig‚Äôs death on Crusade in 1227, Elizabeth was expelled from the castle by her brother-in-law, wandered the winter streets of Eisenach with her infant children, and founded a hospital at Marburg where she personally nursed the sick, washed lepers, and carried the dying on her back. She was 24 when she died on November 17, 1231. Pope Gregory IX canonised her on May 27, 1235 ‚Äî just four years later, one of the fastest canonisations in medieval history. She is patron of the Franciscan Third Order, bakers, beggars, the homeless, hospitals, and all who serve the poor.',
  };
  var titles={anthony:'‚úù Doctor Evangelicus ‚úù\nSt. Anthony of Padua',clare:'‚úù A Life of Radical Poverty ‚úù\nSt. Clare of Assisi',bonaventure:'‚úù The Seraphic Doctor ‚úù\nSt. Bonaventure',pio:'‚úù A Living Stigmatic ‚úù\nPadre Pio of Pietrelcina',elizabeth:'‚úù A Princess of the Poor ‚úù\nSt. Elizabeth of Hungary'};
  document.getElementById('saintFinalTitle').textContent=(titles[saintKey]||'‚úù A Life of Grace ‚úù').replace(/\n/g,'\n');
  document.getElementById('saintFinalQuote').innerHTML=(quotes[saintKey]||'').replace(/\n/g,'<br>');
  var bioEl=document.getElementById('saintFinalBio');
  if(bioEl)bioEl.textContent=bios[saintKey]||'';
  elShow('finalSaint','flex');
}
function showHeavenEnd(){hideHUD();elHide('dialogueBox');elHide('heavenMsg');elShow('finalHeaven','flex');}

function goToMenu(){
  if(G._typeTimer){clearInterval(G._typeTimer);G._typeTimer=null;}
  if(typeof _partIv!=='undefined')clearInterval(_partIv);
  ['finalFrancis','finalSaint','finalHeaven','finalMarathon','modeSelect','saintSelect','cutscene'].forEach(function(id){elHide(id);});
  clearStage();if(G.playerGroup){G.scene.remove(G.playerGroup);G.playerGroup=null;}
  if(G.flyGroup){G.scene.remove(G.flyGroup);G.flyGroup=null;}
  G.gameMode='none';G.stageIndex=0;hideHUD();elHide('flightHUD');elHide('dialogueBox');elHide('interactPrompt');
  elHide('goldenRing');elHide('heavenMsg');elHide('miracleFlash');
  // Reset marathon
  G.marathonMode=false;G.marathonSaintIdx=0;G.marathonCompleted=[];
  document.getElementById('marathonHUD').style.display='none';
  elShow('modeSelect','flex');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   JOYSTICK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setupJoystick(){
  var base=document.getElementById('joystickBase');
  var knob=document.getElementById('joystickKnob');
  var tid=null;
  function mr(){return base.offsetWidth*.38;}
  function gc(){var r=base.getBoundingClientRect();return{cx:r.left+r.width/2,cy:r.top+r.height/2};}
  function mv(tx,ty){var c=gc(),dx=tx-c.cx,dy=ty-c.cy,dist=Math.sqrt(dx*dx+dy*dy),m=mr(),a=Math.atan2(dy,dx),cl=Math.min(dist,m),kx=Math.cos(a)*cl,ky=Math.sin(a)*cl;
    knob.style.transform='translate(calc(-50% + '+kx+'px), calc(-50% + '+ky+'px))';
    var n=cl/m<.08?0:cl/m;G.joy.ax=Math.cos(a)*n;G.joy.az=Math.sin(a)*n;}
  function rst(){knob.style.transform='translate(-50%,-50%)';G.joy.ax=0;G.joy.az=0;}
  base.addEventListener('touchstart',function(e){e.preventDefault();if(tid!==null)return;var t=e.changedTouches[0];tid=t.identifier;mv(t.clientX,t.clientY);},{passive:false});
  base.addEventListener('touchmove',function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i];if(t.identifier===tid){mv(t.clientX,t.clientY);break;}}},{passive:false});
  function et(e){for(var i=0;i<e.changedTouches.length;i++){if(e.changedTouches[i].identifier===tid){tid=null;rst();break;}}}
  base.addEventListener('touchend',et,{passive:false});base.addEventListener('touchcancel',et,{passive:false});
  var md=false;
  base.addEventListener('mousedown',function(e){md=true;mv(e.clientX,e.clientY);});
  document.addEventListener('mousemove',function(e){if(md)mv(e.clientX,e.clientY);});
  document.addEventListener('mouseup',function(){if(md){md=false;rst();}});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INPUT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildTitleStars(){
  var el=document.getElementById('tStars');if(!el)return;
  var html2='';
  for(var i=0;i<90;i++){
    var x=(Math.random()*100).toFixed(1),y=(Math.random()*100).toFixed(1);
    var s=(Math.random()*2+.5).toFixed(1);
    var d=(2+Math.random()*5).toFixed(1),delay=(Math.random()*6).toFixed(1);
    var op=(Math.random()*.6+.2).toFixed(2);
    html2+='<div class="t-star" style="left:'+x+'%;top:'+y+'%;width:'+s+'px;height:'+s+'px;opacity:'+op+';--d:'+d+'s;--delay:'+delay+'s;"></div>';
  }
  el.innerHTML=html2;
}
function setupInput(){
  document.addEventListener('keydown',function(e){
    G.keys[e.code]=true;
    if(e.code==='Space'||e.code==='Enter'){if(G.dlgActive)dlgNext();else if(G.gameMode==='flight'&&!G.inHeaven)shootRosary();}
    if(e.code==='KeyE'||e.code==='KeyF'||e.code==='KeyX'){playInteractTone();handleAct();}
    if(e.code==='Escape')cutNext();
    if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space'].indexOf(e.key)!==-1)e.preventDefault();
  });
  document.addEventListener('keyup',function(e){G.keys[e.code]=false;});
  function addBtn(id,fn){
    var b=document.getElementById(id);if(!b)return;
    b.addEventListener('pointerdown',function(e){e.preventDefault();b.classList.add('pressed');fn();});
    b.addEventListener('pointerup',function(e){e.preventDefault();b.classList.remove('pressed');});
    b.addEventListener('pointercancel',function(){b.classList.remove('pressed');});
  }
  addBtn('btnAct',handleAct);
  addBtn('btnNext',function(){if(G.dlgActive)dlgNext();});
  document.getElementById('cutscene').addEventListener('pointerup',function(e){e.stopPropagation();cutNext();});
  document.getElementById('dialogueBox').addEventListener('pointerup',function(){if(G.dlgActive)dlgNext();});
  document.getElementById('startBtn').addEventListener('pointerup',function(e){e.preventDefault();showModeSelect();});
  // Mode select cards
  document.getElementById('cardFrancis').addEventListener('pointerup',function(e){e.stopPropagation();startFrancisMode();});
  document.getElementById('cardSaints').addEventListener('pointerup',function(e){e.stopPropagation();showSaintSelect();});
  document.getElementById('cardMarathon').addEventListener('pointerup',function(e){e.stopPropagation();startMarathonMode();});
  document.getElementById('cardFlight').addEventListener('pointerup',function(e){e.stopPropagation();startFlightMode();});
  document.getElementById('cardAnthony').addEventListener('pointerup',function(e){e.stopPropagation();startAnthonyMode();});
  document.getElementById('cardClare').addEventListener('pointerup',function(e){e.stopPropagation();startClareMode();});
  document.getElementById('cardBonaventure').addEventListener('pointerup',function(e){e.stopPropagation();startBonaventureMode();});
  document.getElementById('cardPio').addEventListener('pointerup',function(e){e.stopPropagation();startPioMode();});
  document.getElementById('cardElizabeth').addEventListener('pointerup',function(e){e.stopPropagation();startElizabethMode();});
  document.getElementById('saintBack').addEventListener('pointerup',function(e){e.stopPropagation();elHide('saintSelect');elShow('modeSelect','flex');});
  document.getElementById('btnFrancisMenu').addEventListener('pointerup',goToMenu);
  document.getElementById('btnSaintMenu').addEventListener('pointerup',goToMenu);
  document.getElementById('btnHeavenMenu').addEventListener('pointerup',goToMenu);
  document.getElementById('btnMarathonMenu').addEventListener('pointerup',goToMenu);
  // Tutorial overlay
  var tutEl=document.getElementById('tutorialOverlay');
  document.getElementById('tutClose').addEventListener('pointerup',function(){tutEl.style.display='none';});
  document.getElementById('showTutBtn').addEventListener('pointerup',function(){tutEl.style.display='flex';});
  // Star field on title
  buildTitleStars();
  setupJoystick();
}

/* ‚îÄ‚îÄ‚îÄ MODE STARTERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function showModeSelect(){elHide('titleScreen');elShow('modeSelect','flex');}
function showSaintSelect(){elHide('modeSelect');elShow('saintSelect','flex');}
function startFrancisMode(){elHide('modeSelect');G.gameMode='francis';loadFrancisStage(0);}
function startAnthonyMode(){elHide('saintSelect');G.gameMode='saint';G.saintMode='anthony';loadSaintStage(CA,0,function(){showSaintEnd('anthony');});}
function startClareMode(){elHide('saintSelect');G.gameMode='saint';G.saintMode='clare';loadSaintStage(CC,0,function(){showSaintEnd('clare');});}
function startBonaventureMode(){elHide('saintSelect');G.gameMode='saint';G.saintMode='bonaventure';loadSaintStage(CB,0,function(){showSaintEnd('bonaventure');});}
function startPioMode(){elHide('saintSelect');G.gameMode='saint';G.saintMode='pio';loadSaintStage(CPio,0,function(){showSaintEnd('pio');});}
function startElizabethMode(){elHide('saintSelect');G.gameMode='saint';G.saintMode='elizabeth';loadSaintStage(CEliz,0,function(){showSaintEnd('elizabeth');});}
function startFlightMode(){elHide('modeSelect');G.gameMode='flight';startFlightSim();}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WEB AUDIO ‚Äî subtle tonal feedback
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var _AC=null;
function getAC(){if(!_AC)try{_AC=new(window.AudioContext||window.webkitAudioContext)();}catch(e){}return _AC;}
function playTone(freq,dur,vol,type){
  var ac=getAC();if(!ac)return;
  if(ac.state==='suspended')ac.resume();
  var osc=ac.createOscillator(),gain=ac.createGain();
  osc.connect(gain);gain.connect(ac.destination);
  osc.type=type||'sine';osc.frequency.value=freq;
  gain.gain.setValueAtTime(0,ac.currentTime);
  gain.gain.linearRampToValueAtTime(vol||.12,ac.currentTime+.02);
  gain.gain.exponentialRampToValueAtTime(.001,ac.currentTime+dur);
  osc.start(ac.currentTime);osc.stop(ac.currentTime+dur);
}
function playMiracleChord(){
  [523,659,784,1047].forEach(function(f,i){setTimeout(function(){playTone(f,.8,.07+i*.01,'sine');},i*60);});
}
function playInteractTone(){playTone(880,.18,.08,'sine');playTone(1108,.25,.05,'sine');}
function playDialogueTone(){playTone(440,.12,.04,'triangle');}
function playCelebrationTones(){
  var notes=[523,587,659,698,784,880];
  notes.forEach(function(f,i){setTimeout(function(){playTone(f,.4,.06,'sine');},i*90);});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN LOOP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function mainLoop(ts){
  requestAnimationFrame(mainLoop);
  var elapsed=ts-G.lastFrame;
  if(elapsed<G.targetMs)return;
  G.lastFrame=ts;var dt=Math.min(elapsed/1000,.05),t=ts/1000;
  try{
    if(G.gameMode==='flight'&&!G.inHeaven){
      updateFlight(dt,t);updateRosaries(dt);animCelebrate(dt);updateFlightHUD();
    }else if(G.playerGroup&&G.scene&&G.camera&&G.gameMode!=='none'){
      updateMovement(dt);updateCamera();
    }
    updateParts(dt);
    if(G.gameMode!=='none'){animBirds(t);animWolf(t);animGlows(t);}
    if(G.inHeaven)animHeaven(t);
    if((G.gameMode!=='flight'||G.inHeaven)&&G.playerGroup)checkNear();
    if(G.renderer&&G.scene&&G.camera)G.renderer.render(G.scene,G.camera);
    if(G.gameMode!=='none'&&G.gameMode!=='flight')updateMinimap();
  }catch(e){/* absorb transient frame errors */}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('load',function(){
  initRenderer();setupInput();
  requestAnimationFrame(mainLoop);
  var fill=document.getElementById('loadingFill'),pct=0;
  var iv=setInterval(function(){
    pct=Math.min(100,pct+Math.random()*22);fill.style.width=pct+'%';
    if(pct>=100){clearInterval(iv);setTimeout(function(){elHide('loading');elShow('titleScreen','flex');},350);}
  },200);
});

</script>
</body>
</html>
